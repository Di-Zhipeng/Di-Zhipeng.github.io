<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>黑白棋AI</title>
      <link href="/article/3a5ee2c4.html"/>
      <url>/article/3a5ee2c4.html</url>
      
        <content type="html"><![CDATA[<h1 id="搜索-黑白棋-AI-算法"><a href="#搜索-黑白棋-AI-算法" class="headerlink" title="搜索 - 黑白棋 AI 算法"></a>搜索 - 黑白棋 AI 算法</h1><h3 id="一、实验背景"><a href="#一、实验背景" class="headerlink" title="一、实验背景"></a>一、实验背景</h3><p>黑白棋 (Reversi)，也叫苹果棋，翻转棋，是一个经典的策略性游戏。</p><p>一般棋子双面为黑白两色，故称“黑白棋”。因为行棋之时将对方棋子翻转，则变为己方棋子，故又称“翻转棋” (Reversi) 。<br>棋子双面为红、绿色的称为“苹果棋”。它使用 8x8 的棋盘，由两人执黑子和白子轮流下棋，最后子多方为胜方。<br>随着网络的普及，黑白棋作为一种最适合在网上玩的棋类游戏正在逐渐流行起来。<br>中国主要的黑白棋游戏站点有 Yahoo 游戏、中国游戏网、联众游戏等。</p><p><img src="https://i.loli.net/2020/05/11/guxw1MEXv2maZ47.jpg" alt="img"></p><h3 id="二、实验环境"><a href="#二、实验环境" class="headerlink" title="二、实验环境"></a>二、实验环境</h3><h4 id="1-Mo平台"><a href="#1-Mo平台" class="headerlink" title="1. Mo平台"></a>1. Mo平台</h4><p>Mo平台是一个人工智能平台，它允许初学者进行搭积木式的线上模型开发以及离线训练和简单部署，还可以进行多人协作共同开发和交互式在线学习，近期，Mo平台迁回浙大校内，得到了信息技术中心的大力支持，成为了ZJU AI课上必不可少的关键平台。</p><p><img src="https://i.loli.net/2020/05/11/bLfYPtMG4mWcizE.png" alt="image-20200429100417669"></p><h4 id="2-本机"><a href="#2-本机" class="headerlink" title="2. 本机"></a>2. 本机</h4><p>操作系统：Arch-Linux</p><p>CPU：Intel(R) CORE i7-8650U @ 1.9GHz</p><p>RAM: 16GB LPDDR3</p><p>Python版本：Python3.9</p><p>开发工具：PyCharm</p><h3 id="三、核心算法"><a href="#三、核心算法" class="headerlink" title="三、核心算法"></a>三、核心算法</h3><h4 id="1-Min-Max-算法"><a href="#1-Min-Max-算法" class="headerlink" title="1. Min-Max 算法"></a>1. Min-Max 算法</h4><p>在二人博弈问题中，为了从众多可供选择的行动方案中选出一个对自己最为有利的行动方案，就需要对当前的情况以及将要发生的情况进行分析，通过某搜索算法从中选出最优的走步。</p><p>基本想法是：</p><ol><li>设博弈的双方中一方为MAX，另一方为MIN。然后为其中的一方寻找一个最优行动方案。</li><li>为了找到当前的最优行动方案，需要对各个可能的方案所产生的后果进行比较,具体地说，就是要考虑每一方案实施后对方可能采取的所有行动，并计算可能的得分。</li><li>为计算得分，需要根据问题的特性信息定义一个评估函数，用来估算当前博弈树端节点的得分。此时估算出来的得分称为静态估值。</li><li>当端节点的估值计算出来后，再推算出父节点的得分，推算的方法是：对“或”节点，选其子节点中一个最大的得分作为父节点的得分，这是为了使自己在可供选择的方案中选一个对自己最有利的方案；对“与”节点，选其子节点中一个最小的得分作为父节点的得分，这是为了立足于最坏的情况。这样计算出的父节点的得分称为倒推值。</li><li>如果一个行动方案能获得较大的倒推值，则它就是当前最好的行动方案</li></ol><p><img src="https://i.loli.net/2020/05/11/YK4I1hdDum35pUc.png" alt="img"></p><p>下面是伪代码描述：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">minimax</span><span class="params">(node, depth)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">if</span> node is a terminal node <span class="keyword">or</span> depth </span>= <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> the heuristic value of node</span><br><span class="line">    <span class="keyword">if</span> the adversary is to play at node</span><br><span class="line">        let α := +∞</span><br><span class="line">        foreach child of node</span><br><span class="line">            α := <span class="built_in">min</span>(α, minimax(child, depth<span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">else</span> &#123;we are to play at node&#125;</span><br><span class="line">        let α := -∞</span><br><span class="line">        foreach child of node</span><br><span class="line">            α := <span class="built_in">max</span>(α, minimax(child, depth<span class="number">-1</span>))</span><br><span class="line">    <span class="keyword">return</span> α</span><br></pre></td></tr></table></figure><h4 id="2-Alpha-Beta剪枝算法"><a href="#2-Alpha-Beta剪枝算法" class="headerlink" title="2. Alpha-Beta剪枝算法"></a>2. Alpha-Beta剪枝算法</h4><p>​    <strong>Alpha-beta剪枝</strong>是一种搜索算法，用以减少极小化极大算法（Minimax算法）搜索树的节点数。这是一种对抗性搜索算法，主要应用于机器游玩的二人游戏。</p><p>Alpha-beta的优点是减少搜索树的分枝，将搜索时间用在“更有希望”的子树上，继而提升搜索深度。该算法和极小化极大算法一样，都是分支限界类算法。若节点搜索顺序达到最优化或近似最优化（将最佳选择排在各节点首位），则同样时间内搜索深度可达极小化极大算法的两倍多。</p><p>算法使用两个值alpha和beta，分别代表大分玩家放心的最高分，以及小分玩家放心的最低分。alpha和beta的初始值分别为正负无穷大，即双玩家都以可能的最低分开始游戏。在选择某节点的特定分枝后，可能发生小分玩家放心的最小分小于大分玩家放心的最大分（beta &lt;= alpha）。这种情况下，父节点不应选择这个节点，否则父节点分数会降低，因此该分枝的其他节点没有必要继续探索。</p><p><img src="https://i.loli.net/2020/05/11/gLiV4jG9KBWxUAN.png" alt="img"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">function <span class="title">alphabeta</span><span class="params">(node, depth, α, β, maximizingPlayer)</span> is</span></span><br><span class="line"><span class="function">    <span class="keyword">if</span> depth </span>= <span class="number">0</span> <span class="keyword">or</span> node is a terminal node then</span><br><span class="line">        <span class="keyword">return</span> the heuristic value of node</span><br><span class="line">    <span class="keyword">if</span> maximizingPlayer then</span><br><span class="line">        value := −∞</span><br><span class="line">        <span class="keyword">for</span> each child of node <span class="keyword">do</span></span><br><span class="line">            value := <span class="built_in">max</span>(value, alphabeta(child, depth − <span class="number">1</span>, α, β, FALSE))</span><br><span class="line">            α := <span class="built_in">max</span>(α, value)</span><br><span class="line">            <span class="keyword">if</span> α ≥ β then</span><br><span class="line">                <span class="keyword">break</span> (* β cut-off *)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        value := +∞</span><br><span class="line">        <span class="keyword">for</span> each child of node <span class="keyword">do</span></span><br><span class="line">            value := <span class="built_in">min</span>(value, alphabeta(child, depth − <span class="number">1</span>, α, β, TRUE))</span><br><span class="line">            β := <span class="built_in">min</span>(β, value)</span><br><span class="line">            <span class="keyword">if</span> α ≥ β then</span><br><span class="line">                <span class="keyword">break</span> (* α cut-off *)</span><br><span class="line">        <span class="keyword">return</span> value</span><br></pre></td></tr></table></figure><h4 id="3-遗传算法"><a href="#3-遗传算法" class="headerlink" title="3. 遗传算法"></a>3. 遗传算法</h4><p><strong>遗传算法</strong>是计算数学中用于解决最优化的搜索算法，是进化算法的一种。进化算法最初是借鉴了进化生物学中的一些现象而发展起来的，这些现象包括遗传、突变、自然选择以及杂交等。</p><p>遗传算法通常实现方式为一种计算机模拟。对于一个最优化问题，一定数量的候选解（称为个体）可抽象表示为染色体，使种群向更好的解进化。传统上，解用二进制表示（即0和1的串），但也可以用其他表示方法。进化从完全随机个体的种群开始，之后一代一代发生。在每一代中评价整个种群的适应度，从当前种群中随机地选择多个个体（基于它们的适应度），通过自然选择和突变产生新的生命种群，该种群在算法的下一次迭代中成为当前种群。</p><p>本次实验使用遗传算法主要是为了训练评估函数中各个子评估函数的权重</p><h3 id="四、评估函数"><a href="#四、评估函数" class="headerlink" title="四、评估函数"></a>四、评估函数</h3><p>我的评估函数由行动力、前沿子、棋子数目、地势、稳定性、占角、奇偶七个方面组成</p><h4 id="1-行动力"><a href="#1-行动力" class="headerlink" title="1. 行动力"></a>1. 行动力</h4><p>基于这样的假设: 在某局面中, 选择多, 则灵活主动, 而选择少, 则往往陷入被动。因此选择多少, 就成为了评估局面好坏的参考因素了。于是我们把面对某一局面, 可以落子的个数, 称之为行动力。</p><p>如果能够减少对方行动的选择性，诱导对方下到星位，自己可以快速入角，这就是行动力策略。从黑白棋上看，我们如果能够抢到四个角，每条边8颗棋子，四条边30颗子，随便在中间占几个位置就能够胜利。所以对于黑白棋来说，即使一开始处于劣势，后期也非常容易翻盘。</p><p>行动力是评估的重要的参考依据，这里的计算方法也很简单，计算一下两个玩家合法位置list长度，然后做差并标准化就可以了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evalMobility</span><span class="params">(self)</span>:</span></span><br><span class="line">    black_mobility = len(self.get_legal_actions(self.black))</span><br><span class="line">    white_mobility = len(self.get_legal_actions(self.white))</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span> * (black_mobility - white_mobility)</span><br></pre></td></tr></table></figure><h4 id="2-前沿子"><a href="#2-前沿子" class="headerlink" title="2. 前沿子"></a>2. 前沿子</h4><p>所谓前沿子，就是在外部的棋子，周围有空位可以下，最好能挨着对方的棋子。这样的棋子因为周围可以下子，所以他往往具有更大的价值，因此我们要多争取这样的棋子。</p><p>我的前沿子计算，就是判断一下八个方向有没有空位：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evalFrontier</span><span class="params">(self)</span>:</span></span><br><span class="line">    black_frontier = []</span><br><span class="line">    white_frontier = []</span><br><span class="line">    direction = [(<span class="number">-1</span>, <span class="number">0</span>), (<span class="number">-1</span>, <span class="number">1</span>), (<span class="number">0</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">1</span>), (<span class="number">1</span>, <span class="number">0</span>), (<span class="number">1</span>, <span class="number">-1</span>), (<span class="number">0</span>, <span class="number">-1</span>), (<span class="number">-1</span>, <span class="number">-1</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">if</span> self._board[i][j] == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">                    cur_position = (i, j) + direction[k]</span><br><span class="line">                    <span class="keyword">if</span> is_on_board(cur_position[<span class="number">0</span>], cur_position[<span class="number">1</span>]) <span class="keyword">and</span> \</span><br><span class="line">                    (self._board[cur_position[<span class="number">0</span>]][cur_position[<span class="number">1</span>]] == self.empty):</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> self._board[i][j] == self.black:</span><br><span class="line">                            black_frontier.append((i, j))</span><br><span class="line">                            <span class="keyword">else</span>:</span><br><span class="line">                                white_frontier.append((i, j))</span><br><span class="line">                                black_frontier = list(set(black_frontier))</span><br><span class="line">                                white_frontier = list(set(white_frontier))</span><br><span class="line">                                <span class="keyword">return</span> (len(black_frontier) - len(white_frontier)) / (len(black_frontier) + len(white_frontier) + <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="3-棋子数目"><a href="#3-棋子数目" class="headerlink" title="3.棋子数目"></a>3.棋子数目</h4><p>游戏终局的时候，棋子数目是最主要的胜负决定权，这时地势的作用会减弱，退化成棋子数目。所以我这里把棋子数目和地势分开写了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evalCount</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span> * (self.count(self.black) - self.count(self.white)) / (</span><br><span class="line">        self.count(self.black) + self.count(self.white) + <span class="number">1</span>)</span><br></pre></td></tr></table></figure><h4 id="4-地势"><a href="#4-地势" class="headerlink" title="4.地势"></a>4.地势</h4><p>棋盘上各个位置的权重显然是不一样的，占据角点或者边，都会给玩家带来极大的优势，所以这里根据棋盘上各个点的位置优劣给出了一个地势表（这个表是经验结果，他的效果很好）</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">terrain = np.array([</span><br><span class="line">    [<span class="number">100</span>, <span class="number">-10</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">-10</span>, <span class="number">100</span>],</span><br><span class="line">    [<span class="number">-10</span>, <span class="number">-25</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-25</span>, <span class="number">-10</span>],</span><br><span class="line">    [<span class="number">8</span>, <span class="number">-4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">-4</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">-4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">-4</span>, <span class="number">6</span>],</span><br><span class="line">    [<span class="number">6</span>, <span class="number">-4</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">-4</span>, <span class="number">6</span>],</span><br><span class="line">    [<span class="number">8</span>, <span class="number">-4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">-4</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">-10</span>, <span class="number">-25</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-4</span>, <span class="number">-25</span>, <span class="number">-10</span>],</span><br><span class="line">    [<span class="number">100</span>, <span class="number">-10</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">-10</span>, <span class="number">100</span>]</span><br><span class="line">])</span><br><span class="line"><span class="comment"># 根据地势评估</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evalTerrain</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="keyword">return</span> np.sum(self._board * terrain)</span><br></pre></td></tr></table></figure><h4 id="5-稳定性"><a href="#5-稳定性" class="headerlink" title="5.稳定性"></a>5.稳定性</h4><p>所谓稳定子，就是指那些无法被轻易翻转的棋子。稳定子在整个博弈期间都有很大的权重，因为一旦你拿到了大量稳定子，你就不可能输掉游戏的。稳定子的计算通常比较困难，这里采用的方法是计算角点、边、和八个方向都无空格的（如果计算的太复杂会比较慢，效果反而不好）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据稳定子个数评估</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evalStable</span><span class="params">(self)</span>:</span></span><br><span class="line">    black_stable = np.sum(self.getStableCount(self.black))</span><br><span class="line">    white_stable = np.sum(self.getStableCount(self.white))</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span> * (black_stable - white_stable) / (black_stable + white_stable + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getStableCount</span><span class="params">(self, color)</span>:</span></span><br><span class="line">    stable = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    <span class="comment"># 角, 边, 八个方向都无空格</span></span><br><span class="line">    cind1 = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">7</span>]</span><br><span class="line">    cind2 = [<span class="number">0</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">0</span>]</span><br><span class="line">    inc1 = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>]</span><br><span class="line">    inc2 = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>]</span><br><span class="line">    stop = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">if</span> self._board[cind1[i]][cind2[i]] == color:</span><br><span class="line">            stop[i] = <span class="number">1</span></span><br><span class="line">            stable[<span class="number">0</span>] += <span class="number">1</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">7</span>):</span><br><span class="line">                <span class="keyword">if</span> self._board[cind1[i] + inc1[i] * j][cind2[i] + inc2[i] * j] != color:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    stop[i] = j + <span class="number">1</span></span><br><span class="line">                    stable[<span class="number">1</span>] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">if</span> self._board[cind1[i]][cind2[i]] == color:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">7</span> - stop[i - <span class="number">1</span>]):</span><br><span class="line">                <span class="keyword">if</span> self._board[cind1[i] - inc1[i - <span class="number">1</span>] * j][cind2[i] - inc2[i - <span class="number">1</span>] * j] != color:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    stable[<span class="number">1</span>] += <span class="number">1</span></span><br><span class="line">    colfull = np.zeros((<span class="number">8</span>, <span class="number">8</span>), dtype=np.int)</span><br><span class="line">    colfull[:, np.sum(abs(self._board), axis=<span class="number">0</span>) == <span class="number">8</span>] = <span class="literal">True</span></span><br><span class="line">    rowfull = np.zeros((<span class="number">8</span>, <span class="number">8</span>), dtype=np.int)</span><br><span class="line">    rowfull[np.sum(abs(self._board), axis=<span class="number">1</span>) == <span class="number">8</span>, :] = <span class="literal">True</span></span><br><span class="line">    diag1full = np.zeros((<span class="number">8</span>, <span class="number">8</span>), dtype=np.int)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">        diagsum = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> i &lt;= <span class="number">7</span>:</span><br><span class="line">            sind1 = i</span><br><span class="line">            sind2 = <span class="number">0</span></span><br><span class="line">            jrange = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sind1 = <span class="number">7</span></span><br><span class="line">            sind2 = i - <span class="number">7</span></span><br><span class="line">            jrange = <span class="number">15</span> - i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(jrange):</span><br><span class="line">            diagsum += abs(self._board[sind1 - j][sind2 + j])</span><br><span class="line">        <span class="keyword">if</span> diagsum == jrange:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(jrange):</span><br><span class="line">                diag1full[sind1 - k][sind2 + k] = <span class="literal">True</span></span><br><span class="line">    diag2full = np.zeros((<span class="number">8</span>, <span class="number">8</span>), dtype=np.int)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">15</span>):</span><br><span class="line">        diagsum = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> i &lt;= <span class="number">7</span>:</span><br><span class="line">            sind1 = i</span><br><span class="line">            sind2 = <span class="number">7</span></span><br><span class="line">            jrange = i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sind1 = <span class="number">7</span></span><br><span class="line">            sind2 = <span class="number">14</span> - i</span><br><span class="line">            jrange = <span class="number">15</span> - i</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(jrange):</span><br><span class="line">            diagsum += abs(self._board[sind1 - j][sind2 - j])</span><br><span class="line">        <span class="keyword">if</span> diagsum == jrange:</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> range(jrange):</span><br><span class="line">                diag2full[sind1 - k][sind2 - k] = <span class="literal">True</span></span><br><span class="line">    stable[<span class="number">2</span>] = sum(</span><br><span class="line">        sum(np.logical_and(np.logical_and(np.logical_and(colfull, rowfull), diag1full), diag2full)))</span><br><span class="line">    <span class="keyword">return</span> stable</span><br></pre></td></tr></table></figure><h4 id="6-占角"><a href="#6-占角" class="headerlink" title="6. 占角"></a>6. 占角</h4><p>这里的占角是指后面是否能够捕获到角点，而不会计算已经占到的角点。角点是最重要的，所以无论何时，都会有很高的权重。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evalCorner</span><span class="params">(self)</span>:</span></span><br><span class="line">    legal_list = self.get_legal_actions(self.cur_color)</span><br><span class="line">    <span class="keyword">if</span> ((<span class="number">0</span>, <span class="number">0</span>) <span class="keyword">in</span> legal_list) <span class="keyword">or</span> ((<span class="number">0</span>, <span class="number">7</span>) <span class="keyword">in</span> legal_list) <span class="keyword">or</span> ((<span class="number">7</span>, <span class="number">0</span>) <span class="keyword">in</span> legal_list) <span class="keyword">or</span> ((<span class="number">7</span>, <span class="number">7</span>) <span class="keyword">in</span> legal_list):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span> <span class="keyword">if</span> self.cur_color == self.black <span class="keyword">else</span> <span class="number">-100</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h4 id="7-奇偶性"><a href="#7-奇偶性" class="headerlink" title="7.奇偶性"></a>7.奇偶性</h4><p>所谓奇偶性，就是说谁来下最后一手棋，因为最后下到的棋都是稳定子，所以这会带来一定的优势。受黑白棋的制度限制，如果一局中不出现违规情况，总由白旗下最后一子，所以如果能想办法让对方犯规，那就一定要努力做到。这项会在后期非常重要。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据终局奇偶性评估</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evalParity</span><span class="params">(self)</span>:</span></span><br><span class="line">    final = (<span class="number">64</span> - self.get_total_count()) % <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> final == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="五、优化改进"><a href="#五、优化改进" class="headerlink" title="五、优化改进"></a>五、优化改进</h3><h4 id="1-动态评估函数"><a href="#1-动态评估函数" class="headerlink" title="1. 动态评估函数"></a>1. 动态评估函数</h4><p> 我最终的评估函数，是上述评估函数的线性组合，这个权重表是由遗传算法获取的。但是，整盘游戏中的不同时期，每个子评估函数的权重应该是在不断变化的，所以就很有必要设计一个动态评估函数，根据当前棋盘的棋子个数进行改变。</p><p>我在设计中，选择了8个棋子数目，作为游戏进行的8个阶段，我分别对这几个阶段用遗传算法学习了权重表。拿到这几个权重后，再进行线性插值，就能得到65个（0-64）游戏阶段的权重。</p><h4 id="2-启发式搜索：节点排序"><a href="#2-启发式搜索：节点排序" class="headerlink" title="2. 启发式搜索：节点排序"></a>2. 启发式搜索：节点排序</h4><p>我改进了搜索算法，在进行搜索前，会先广搜一层，使用地势表作为评估函数，对节点进行排序，在进行排序后，再深搜6层，这样我们在深搜的时候，剪枝的概率就大大提高了。</p><h4 id="3-使用NumPy优化Python矩阵操作"><a href="#3-使用NumPy优化Python矩阵操作" class="headerlink" title="3. 使用NumPy优化Python矩阵操作"></a>3. 使用NumPy优化Python矩阵操作</h4><p>这个没什么好说的，就是尽可能用numpy矩阵操作代替python的list，因为python的list实在是性能低下，速度不行。</p><h4 id="4-使用Cython"><a href="#4-使用Cython" class="headerlink" title="4. 使用Cython"></a>4. 使用Cython</h4><p>为了达到更好的效果，python的速度已经成为了我的瓶颈。于是我学习了cython，把python编译成so库，然后再运行，这样的速度就会快很多。</p><p>不过由于我们的作业要求语言是python，所以我只是用cython编译了代码，而没有使用cython去改写python代码，把类型变成静态的（虽然效果的确会非常的好）。</p><p>经过我的实验，使用cython后，大概能多搜索一层。</p><h3 id="六、实验效果"><a href="#六、实验效果" class="headerlink" title="六、实验效果"></a>六、实验效果</h3><p>实验效果显然非常的好，我拿到了黑白棋比赛的亚军（自豪）：</p><p><img src="https://i.loli.net/2020/05/11/BZWJa2zCGlV1LET.png" alt="image-20200511193621587"></p><h3 id="七、总结"><a href="#七、总结" class="headerlink" title="七、总结"></a>七、总结</h3><p>这次能够拿到亚军我还是非常意外的，不过既然拿到了奖，当然是非常开心的，我其实还有很多优化改进能够做，但是由于时间没有来得及搞，比如MPC（呜呜呜其实我MPC都看了好多天论文了，就差没去服务器做统计学习了），但是能拿到6/7胜场这样的成绩我也很知足了，唯一遗憾的是没有机会和第一干一盘，下次我一定锤爆他的AI（玩笑）。</p><p>哦对了，推荐阅读论文《Experiments with Multi-ProbCut and a. New High-Quality Evaluation Function for Othello》</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 人工智能 </tag>
            
            <tag> AI </tag>
            
            <tag> 博弈 </tag>
            
            <tag> 强化学习 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ADS-动态规划</title>
      <link href="/article/50ca31b3.html"/>
      <url>/article/50ca31b3.html</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>ZJU大二下感觉课业压力还是非常大的，我现在每天疲于应付作业，ADS经常是我最头痛的一门课。今天看了一晚上算法导论，做一下笔记。</p><h1 id="动态规划的基本过程"><a href="#动态规划的基本过程" class="headerlink" title="动态规划的基本过程"></a>动态规划的基本过程</h1><p>动态规划（DP）与分治算法很像，都是通过子问题的组合来解决问题，不过动态规划会记录子问题的值，从而避免重复计算子问题，通常，这会极大的降低算法复杂度（指数降至多项式）。</p><p>动态规划通常用来求解<strong>最优化问题</strong>。</p><p>一个动态规划算法通常按以下四个步骤设计：</p><ol><li>刻画一个问题的最优解的结构特征</li><li>递归定义最优解求解方案</li><li>计算最优解的代价值，通常采用自顶向上（Bottom-up method）的方法</li><li>利用计算出的信息构造一个最优解</li></ol><p>其中，第四步某些时候并不是必须的，因为这时我们往往更关心解的代价值，而不是解本身。</p><p>比如，钢条分割问题，我们可能比较关心最优解的收益值，而不关心最优解的长度列表（给出分割后每段钢条的长度）。</p><p>但如果需要第四步，就需要在前几步做出一定的改动。    </p><h1 id="动态规划的两种等价形式"><a href="#动态规划的两种等价形式" class="headerlink" title="动态规划的两种等价形式"></a>动态规划的两种等价形式</h1><p>动态规划有两种形式，他们是等价的：</p><ol><li>带备忘的自顶向下法（top-down with memoization）</li><li>自顶向上法（bottom-up method）</li></ol><p>第一种方法，仍然按照正常的递归编写过程，但在这个过程中会保存每个子问题的解，当我们计算一个子问题的解时，首先先检查这个解是否曾经计算过，如果计算过就不需要重复计算了。这种操作是典型的空间换时间，但的确可以极大的改善算法复杂度。</p><p>第二种方法，一般需要恰当定义子问题的“规模”概念，使得任何子问题的求解都只依赖更小的子问题的求解，因此我们就可以将子问题按照规模排序，以从小到大的顺序逐个求解。当求解某个子问题时，它所依赖的全部子问题都已经求解完毕并保存，所以每个子问题都只需求解一次，我们每次求解时也都是第一次遇到这个子问题。</p><h1 id="子问题图"><a href="#子问题图" class="headerlink" title="子问题图"></a>子问题图</h1><p> 一般的，两种算法的渐进复杂度是相同的。但自顶向上法由于没有复杂的递归函数调用开销，通常具有更小的系数，所以我们更多采用自顶向上法。</p><p>在采用自顶向上法处理问题时，我们可以绘制一个子问题图：</p><p><img src="https://i.loli.net/2020/04/13/lt7FOZE9LJcv1TP.jpg" alt="IMG_20200413_195935"></p><p>子问题规模的排序，本质上是对子问题图的反向拓扑排序。</p><p>通常，子问题的求解时间与子问题的度成正比，子问题的数目等于子问题图的顶点数。因此一般来说，动态规划算法的运行时间与顶点和边的数量关系成正比。</p><h1 id="动态规划原理"><a href="#动态规划原理" class="headerlink" title="动态规划原理"></a>动态规划原理</h1><p>适合使用动态规划的问题往往有两个特征：<strong>最优子结构</strong>和<strong>子问题重叠</strong></p><h2 id="最优子结构"><a href="#最优子结构" class="headerlink" title="最优子结构"></a>最优子结构</h2><p>如果一个问题的最优解由相关子问题的最优解组合而成，并且这些子问题可以独立求解，我们就称这样的问题具有<strong>最优子结构</strong></p><p>寻找最优子结构大概有一个通用的模式：</p><ol><li>证明问题的第一个组成部分是做出一个“选择”，并且在做出选择后，会产生一个或多个待解决的子问题</li><li>对于一个给定的问题，在其可能的第一步选择中，我们假定已经知道哪种选择可以得到最优解，而不去关心这种选择是如何具体得到的</li><li>在给定可获得最优解的选择后，确定这次选择会产生哪些子问题，以及如何最好地刻画子问题空间。</li><li>使用“剪切-粘贴”（cut-and-paste）方法证明：构成原问题最优解的子问题的解就是这个子问题本身的最优解。</li></ol><p>步骤四的通用流程是使用反证法：假设当子问题构成了原问题的最优解时，这个子问题的解不是它自身的最优解，那么我们就可以从原问题最优解中“剪切”掉这个子问题的解，并把该子问题的最优解“粘贴”到原问题解中，从而尝试构成原问题的一个“更优解”。如果这个步骤成功了，那么我们新构建的“更优解”就与原假设的“最优解”形成了矛盾。因此原问题的最优解就是由子问题的最优解组合成的。</p><h2 id="重叠子问题"><a href="#重叠子问题" class="headerlink" title="重叠子问题"></a>重叠子问题</h2><p>适合动态规划方法的最优化问题具有的第二个特征应该是子问题具有<strong>重叠子问题 (overlapping subproblems)</strong> 特性。</p><p>这种问题应该具备足够小的子问题空间，换句话说，他的递归算法应该是不断重复求解相同的子问题，而不是不断生成新的子问题。</p><p>如果递归算法反复求解相同的子问题，我们就成这样的最优化问题具有重叠子问题性质。因为动态规划的主要优化就是在于能够避免重复计算，所以具有重叠子问题性质相当重要。</p><h1 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h1><p>我们可以通过子问题的个数和每个子问题需要考虑多少种选择的乘积作为时间复杂度的考察标准。</p><p>比如一个动态规划问题的子问题图中共存在M个顶点，每个子问题的度为N，那么时间复杂度就为O(M*N)</p>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动态规划 </tag>
            
            <tag> ADS </tag>
            
            <tag> 数据结构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ADS-回溯的模版写法</title>
      <link href="/article/62814ee6.html"/>
      <url>/article/62814ee6.html</url>
      
        <content type="html"><![CDATA[<p>我们需要寻找的问题的解是一个N-tuple $(X_1,X_2,…X_n)$</p><p>因此我们从一个empty tuple开始，把图中符合基本约束的点添加到我们的tuple中，然后如果能够找到一组这样的tuple，符合我们的全部约束条件，那就跳出循环，返回true，否则返回false。</p><p>回溯的关键点在于Undo和设计合适的Check</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Backtracking</span><span class="params">(<span class="keyword">int</span> i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Found = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(i &gt; N)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;<span class="comment">/*solved with (X1,X2,...,Xn)*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(each Xi in Si)&#123;</span><br><span class="line">        <span class="comment">/*check if satisfies the restriction R*/</span></span><br><span class="line">        OK = Check((X1,X2...,Xi), R); <span class="comment">/*pruning*/</span></span><br><span class="line">        <span class="keyword">if</span>(OK)&#123;</span><br><span class="line"><span class="function">Add Xi <span class="title">to</span> <span class="params">(X1,X2,...,Xi<span class="number">-1</span>)</span></span>;<span class="comment">/*Add*/</span></span><br><span class="line">            Found = Backtracking(i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(!Found)&#123;</span><br><span class="line">                Undo(i);<span class="comment">/*recover from (X1,...，Xi) to (X1,...,Xi-1)*/</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(Found) <span class="keyword">break</span>;<span class="comment">/*Found the Answer*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Found;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构与算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ADS </tag>
            
            <tag> 数据结构 </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arch下Clion无法在Debug下正常输出</title>
      <link href="/article/d1828b3a.html"/>
      <url>/article/d1828b3a.html</url>
      
        <content type="html"><![CDATA[<h1 id="Error-during-pretty-printers-setup-Error-while-executing-Python-code"><a href="#Error-during-pretty-printers-setup-Error-while-executing-Python-code" class="headerlink" title="Error during pretty printers setup: Error while executing Python code."></a>Error during pretty printers setup: Error while executing Python code.</h1><p>在Arch下使用Clion，发现在Debug下无法正常输出，提示错误信息：Error during pretty printers setup: Error while executing Python code. 百度没有找到很好的答案，于是去Google了一下，在Jetbrains的官方那边，发现了一些Idea用户遇到了同样的问题，有几个人都是Arch用户，他们反应clion出问题是因为Arch的工具链太新了，所以无法正常调试。</p><p>安装Clion-gdb、Clion-cmake以解决问题</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yay -S clion-gdb clion-cmake</span></span><br></pre></td></tr></table></figure><p>然后在Clion配置里面选择bundle GDB和bundle CMake就可以了</p>]]></content>
      
      
      <categories>
          
          <category> Arch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arch </tag>
            
            <tag> Clion </tag>
            
            <tag> Python </tag>
            
            <tag> JetBrains </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>让Typora自动使用图床</title>
      <link href="/article/777ec474.html"/>
      <url>/article/777ec474.html</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>Typora是一款非常优秀的markdown编写工具，也是我写博客的主力，但是最近在准备上传一个以前写的文档时我发现了问题，这个文档里面本地图片太多了，如果上传到博客上，会让我的博客变的非常臃肿，如何处理这个问题呢？</p><h1 id="使用图床"><a href="#使用图床" class="headerlink" title="使用图床"></a>使用图床</h1><p>最好的解决办法就是使用图床，国内比较好的图床有聚合图床、七牛等等，国外比较著名的有sm.ms等等，我这里采用的是sm.ms，因为他比较方便。</p><p>但是我碰到了一个问题，我的文档里面有55张图片，一个个上传修改链接，好像有点太麻烦了，我搜索了一下，发现Typora本身支持自动上传图片到图床，只需要安装一个名为picgo的神器就可以了。</p><p>###安装picgo:</p><p>正常情况下，直接在设置中点击下图的“下载或更新”，安装picgo-core就可以了：</p><p><img src="https://i.loli.net/2020/03/20/YJSofqkPCDKOHe3.png" alt="image-20200320135659055"></p><p>但是我这里非常慢，所以看了一下typora的文档，发现其实这个所谓picgo只不过是一个js的写的包，我们直接使用npm或者yarn全局安装他就可以了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yarn global add picgo</span><br></pre></td></tr></table></figure><p>然后找到他的安装目录，我这里是在“~/.yarn/bin/picgo”,于是在上传服务那个下拉菜单里面选择custom，然后填入“ ~/.yarn/bin/picgo upload”就可以了。</p><p>然后，打开picgo的配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim .picgo/config.json</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"picBed"</span>: &#123;</span><br><span class="line">    <span class="attr">"uploader"</span>: <span class="string">"smms"</span>, <span class="comment">// 代表当前的默认上传图床为 SM.MS,</span></span><br><span class="line">    <span class="attr">"smms"</span>: &#123;</span><br><span class="line">      <span class="attr">"token"</span>: <span class="string">""</span> <span class="comment">// 从https://sm.ms/home/apitoken获取的token</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"picgoPlugins"</span>: &#123;&#125; <span class="comment">// 为插件预留</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>用上面的配置覆盖原来的，并把那个token位置的值填上，保存，就可以了。</p><p>回到Typora，可以点击那个验证按钮，验证一下图片上传功能。</p><p>成功以后，你可以在Typora里设置插入图片时候自动上传，也可以在已经插入的图片上右键点击上传图片。图片就会自动上传到sm.ms图床了，是不是非常方便好用？</p>]]></content>
      
      
      <categories>
          
          <category> Typora </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
            <tag> Typora </tag>
            
            <tag> picgo </tag>
            
            <tag> 图床 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Verilog游戏《大富翁》</title>
      <link href="/article/d1dfbad5.html"/>
      <url>/article/d1dfbad5.html</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>本文是我在大一时数字逻辑的课程作业报告，其中我删减了一部分涉及隐私或无意义的内容，希望这篇文章能帮助到广大喜欢FPGA的朋友们。</p><h1 id="Part1-游戏介绍"><a href="#Part1-游戏介绍" class="headerlink" title="Part1.游戏介绍"></a>Part1.游戏介绍</h1><h3 id="一、-游戏背景"><a href="#一、-游戏背景" class="headerlink" title="一、 游戏背景"></a>一、 游戏背景</h3><p>大富翁，又名地产大亨，是一种多人策略图版游戏。参赛者分得游戏金钱，凭运气（掷骰子）及交易策略，买地、建楼以赚取租金。英文原名monopoly意为“垄断”，因为最后只得一个胜利者，其余均破产收场。<br>本次课程设计以《大富翁》游戏作为蓝本，以浙江大学紫金港校区作为游戏背景，设计了本款游戏：</p><p><strong>《大富翁之决战紫金港》。</strong></p><p><img src="https://i.loli.net/2020/03/20/OH4v6Wb3aEhPoZy.png" alt="image-20191229161657384.png"></p><h3 id="二、-游戏规则"><a href="#二、-游戏规则" class="headerlink" title="二、 游戏规则"></a>二、 游戏规则</h3><h4 id="1-游戏设置"><a href="#1-游戏设置" class="headerlink" title="1.游戏设置"></a>1.游戏设置</h4><p>这个游戏支持两名游戏玩家。玩家属性包括每月生活费、金钱、绩点、房屋财产。游戏开始时，每位玩家将获得一定的初始资金和初始绩点。游戏主要的目的就是争夺紫金港的地产资源，让对面破产退学或者因为没有地方自习挂科退学。</p><h4 id="2-游戏进行"><a href="#2-游戏进行" class="headerlink" title="2.游戏进行"></a>2.游戏进行</h4><ol><li>每次轮到自己时，按下按钮掷一次骰子，然后按照骰子的点数，在游戏盘上沿顺时针方向移动相应的步数。</li><li>如果停留在土地上，若这个土地没有人占领，则可以花钱买下这块土地，若这块土地已经被自己买下，则可以在上面盖一座房子，增加收入，每块土地最多可以盖一个房子。如果停留在别人的土地上则要缴纳滞留费并降低绩点。</li><li>如果停留在事件块或者红色格，则触发对应事件。</li><li>换下一个人进行游戏，直到有人胜出。</li></ol><h4 id="3-游戏盘说明"><a href="#3-游戏盘说明" class="headerlink" title="3.游戏盘说明"></a>3.游戏盘说明</h4><ol><li><p>初始：每位玩家5000￥初始资金以及3.6/5.0的初始绩点，每月生活费为2000￥</p></li><li><p>起点格：<strong>经过</strong>月初块时，可以向父母领取生活费，<strong>停留</strong>在月初块时，可以获得双倍生活费。</p></li><li><p>地产格：</p><p>​    A. 走到无人购买的区域时，可按支出1600￥买下区域，成为该区域的主人；</p><p>​    B. 走到别人的区域时，则需要根据房屋情况付出相应的代价，包括缴纳滞留费和绩点下降，土地无房屋：金钱 -2000￥，GPA -0.1；土地有房屋，金钱 -4000￥，GPA -0.2。</p><p>​    C. 走到自己的区域时，可以支出1200￥并建筑房屋。</p></li><li><p>事件：触发随机事件，包括：</p><p>​    A. 绩点变化：梦到竺可桢，绩点+0.3；一觉睡到12点，错过早八点名，绩点-0.3；</p><p>​    B. 金钱变化：双十一打折，金钱-3000￥；勤工俭学，金钱+2000￥；</p><p>​    C. 生活费变化：父母升官发财，生活费+1000￥；家庭惨遭电信诈骗，生活费-1200￥；</p></li><li><p>红色格： </p><p>​    A. 睡觉：玩家回到了温馨的寝室，睡大觉，跳过一回合。</p><p>​    B. 评奖：根据玩家当前绩点获得奖学金，奖项如下：</p><p>​        浙江大学学业三等奖学金：GPA：3.8/5.0以上 —— 2000￥；<br>​        浙江大学学业二等奖学金：GPA：4.2/5.0以上 —— 4000￥；<br>​        浙江大学学业一等奖学金：GPA：4.4/5.0以上 —— 6000￥；<br>​        国家奖学金：GPA：4.6/5.0以上，且GPA为所有玩家最高—— 8000￥；<br>​        竺可桢奖学金：GPA：5.0——20000￥；</p><p>​        注：各项奖学金不能同时获得。</p><p>​    C. 期末考试：当玩家<strong>停留</strong>在本方格时，掷一次骰子，获得 （点数-3）X0.05 绩点。</p></li></ol><h4 id="4-胜利条件"><a href="#4-胜利条件" class="headerlink" title="4.胜利条件"></a>4.胜利条件</h4><p>当一位玩家金钱为0或GPA达到1.5及以下时，另一位玩家获胜，游戏结束，播放游戏结束画面。</p><h4 id="5-操作说明"><a href="#5-操作说明" class="headerlink" title="5.操作说明"></a>5.操作说明</h4><p><img src="https://i.loli.net/2020/03/20/t8zKsSVurbG5MYf.png" alt="image-20191229160827419.png"></p><ul><li>重置：使用SW0开关重置输入。</li><li>切换输入：使用SW15切换输入，置0时使用按钮输入，置1时使用PS/2键盘输入。</li><li>掷骰子：我们称上图三个按钮从左到右为0、1、2，我们使用button0掷骰子</li><li>确认：使用button1代表“是”，使用button2代表“否”。</li><li>PS/2模式：使用小键盘的“1、2、3”代替button1、2、3。（后文描述均中button与PS/2小键盘等价）</li></ul><p>玩家1和玩家2均使用同一套按键进行游戏，交替操作。</p><p>游戏开始时，按下button1开始游戏，掷骰子使用button1。</p><p>当走到土地时，会等待确认是否购买土地，按下button2确认购买，button3放弃购买。</p><p>走到事件格时，会抽取一张事件卡显示在屏幕上，按button2确认以继续游戏。</p><p>走到红色格时，会自动触发对应事件，但不会显示在屏幕上（内存资源有限），按button2确认以继续游戏。</p><p>被购买的房子旁边会出现一个有颜色的圆点，紫色代表玩家1所有，白色代表玩家2所有。</p><h4 id="6-显示说明"><a href="#6-显示说明" class="headerlink" title="6.显示说明"></a>6.显示说明</h4><p>Arduino上的七段数码管显示的格式是：C1代表玩家1，C2代表玩家2，数码管第三位空出，第四位表示骰子点数和骰子动画。</p><p>SWORD板上七段数码管显示的格式是：GPA占用两位和一个小数点，中间空出一位，紧接着五位显示金钱（玩家不一定与Arduino的同步）。金钱上限是88888，GPA上限5.0。</p><p>VGA显示的是游戏主体界面，如果碰到橙色时间会有事件卡弹出，如果碰到红色事件则不会有任何提示。</p><p><strong>注意</strong>：无论是红色事件还是普通事件，出发后都需要按下button2确认后才能继续游戏。</p><p>#Part2.名词介绍</p><blockquote><p>###标注：这一部分是文档例行的名词介绍，是为了文档的完整性而存在的，有经验的读者可以跳过这个篇章。</p></blockquote><h3 id="一、VGA"><a href="#一、VGA" class="headerlink" title="一、VGA"></a>一、VGA</h3><p>VGA作为一种标准的显示接口得到了广泛的应用，其信号类型为模拟类型，显示卡端的接口为 15 针母插座。<br>常见的彩色显示器一般都是由CRT(阴极射线管)构成，其引出线共含 5 个信号：R、G、B(三基色信号)、HS(行同步信号)、VS(场同步信号)。每一个像素的色彩由R(红) .G(绿). B(蓝)三基色构成。显示屏一般通过光栅扫描的方式扫描一幅屏幕图像上的各个点，形成整个图片。<br>另外，VGA 时序控制模块是本设计的重要部分，最终的输出信号行、场同步信号必须严格按照VGA 时序标准产生相应的脉冲信号，如下图所示。</p><p><img src="https://i.loli.net/2020/03/20/oQbCszqvP8Spy43.png" alt="image-20191229163550133.png"></p><h3 id="二、PS-2"><a href="#二、PS-2" class="headerlink" title="二、PS/2"></a>二、PS/2</h3><p>PS/2 通信协议是一种双向同步串行通信协议。通信的两端通过 CLOCK(时钟脚)同步，并通过DATA(数据脚)交换数据。</p><p><img src="https://i.loli.net/2020/03/20/akpeB4WThRyjnz8.png" alt="image-20191229163658985.png"></p><p>PS/2 到主机的通信时序如下图所示。数据在 PS/2 时钟的下降沿读取。对于 PS/2 设备，一般来说从时钟脉冲的上升沿到一个数据转变的时间至少要有5us；数据变化到下降沿的时间至少要有 5us，并且不大于 25us，这个时序非常重要应该严格遵循。</p><p><img src="https://i.loli.net/2020/03/20/UZSzlanFOoWfd9P.png" alt="image-20191229163714256.png"></p><h1 id="Part3-开发心得与问题处理"><a href="#Part3-开发心得与问题处理" class="headerlink" title="Part3.开发心得与问题处理"></a>Part3.开发心得与问题处理</h1><h3 id="一、使用Basys3-Vivado-逻辑分析仪的组合进行调试"><a href="#一、使用Basys3-Vivado-逻辑分析仪的组合进行调试" class="headerlink" title="一、使用Basys3 + Vivado +逻辑分析仪的组合进行调试"></a>一、使用Basys3 + Vivado +逻辑分析仪的组合进行调试</h3><p>​    在这次课程设计中，因为实验室开放时间不定，调试我们的游戏就变成了一件困难的事情，于是我从Digilent官网自费购买了一块FPGA开发板：Basys3 。</p><p><img src="https://i.loli.net/2020/03/20/8ZkIFhbLSRonpwX.png" alt="image-20191229123115670"></p><p>这块板子与东四-509性能强大的SWORD当然是没什么可比性，但是价格也是很实惠（在与淘宝店家交流后，报出了王总辉老师的名字，甚至了我额外优惠），七段数码管、按钮、开关、LED灯、USB-HID、VGA、ROM/RAM灯资源都算齐全，基本上可以满足我的课程作业需求。</p><p>​    不过有一个问题，我的这款板子仅支持Vivado开发，并不支持ISE。在与我的学长们交流过后，我了解到Vivado的综合速度要远高于ISE，并且界面的友好程度也比ISE高上很多，于是我最终采用了Vivado作为本次课程作业的开发工具。</p><p>​    除了这些，还有一个东西我非常推荐，那就是无敌的逻辑分析仪。逻辑分析仪是一种分析数字系统逻辑关系的仪器，可以简单理解成一种只能显示0和1的示波器。逻辑分析仪的价格普遍比较贵，这里我推荐一个开源项目：DSLogic，有条件的可以直接去淘宝购买，动手能力强的也可以参考设计书自己制作。价格大概300左右。</p><p><img src="https://i.loli.net/2020/03/20/iqwfcYJ5OvL3dUa.png" alt="image-20191229122827566"></p><p><img src="https://i.loli.net/2020/03/20/H6x7igq2ntlFMRD.png" alt="image-20191229122955566"></p><p>在本文中，主动去编写testbench进行仿真的时候比较少，因为我们的游戏逻辑复杂，单单看简单的仿真结果是得不到很好成效的，另一个原因是我们使用了逻辑分析仪，某种意义上可以代替仿真的很多功能。</p><h3 id="二、PS-2协议键盘与USB-HID"><a href="#二、PS-2协议键盘与USB-HID" class="headerlink" title="二、PS/2协议键盘与USB-HID"></a>二、PS/2协议键盘与USB-HID</h3><p>​    在本次课程作业中，有一个能力提高设计，也就是使用所谓的PS/2键盘作为游戏输入。我在老师提供的VGAdemo中找到了PS/2驱动的代码，但是我一开始完全看不懂，于是我找了一些教程，大致理解了一下PS/2协议的内容。下面是我在网上随便找的一张PS/2接口的图片：</p><p>​    可以看到，这里面是有六个针脚的，但是实际上PS/2协议只需要4个针脚，也就是GND、VCC、PS2_CLK和PS2_DATA。</p><p>​    在本文的后半部分，已经给出了PS/2的时序图，我基本上就是按照这个时序图理解的PS/2键盘，不过在使用过程中却遇到了很多问题。</p><h4 id="1-高级键盘无法使用"><a href="#1-高级键盘无法使用" class="headerlink" title="1.高级键盘无法使用"></a>1.高级键盘无法使用</h4><p>​    首先，我自己使用的键盘是FILCO Minila 机械键盘，接到我的Basys3上，键盘输入完全无效，USB-HID旁边的busy灯长亮，这让我非常疑惑。</p><p>​    于是我查询了Basys3的USB-HID物理实现，得知USB-HID旁边的小芯片FT2232就是用来进行转码的芯片。</p><p><img src="https://i.loli.net/2020/03/20/4QLgtmRckBWJZs5.png" alt="image-20191228171410251"></p><p>从上图中可以看到，FT2232的TXD与RXD两个引脚就是FT2232将USB键盘码解码后得到的PS2_CLK与PS2_DATA</p><p>我百度了很久，我找到了原来所谓的TXD和RXD引脚就是上图中的ADBUS0与ADBUS1两个引脚。</p><p>于是我准备使用逻辑分析仪，分析一下这两个针脚的时序，看看是什么问题，但是由于Basys3上FT2232这个芯片的引脚都非常小，逻辑分析仪的钩子都太大了，没办法测。思考了一段时间后，我发现其实我可以间接测量Artix-7上的B18与A18，来获取PS2_DATA与PS2_CLK，进一步，因为B18和A18是可以自己定义接线的引脚，我就在我的测试工程中把他们接到Basys3右边的一排Pmod connector上的A14与A16两个引脚上，这样就可以很方便的使用逻辑分析仪来测量了。</p><p>​    我使用的逻辑分析仪是著名的开源项目DSLogic的基础版，原生支持PS/2时序的解码，采样了一段时间后，我发现逻辑分析仪的结果完全为空。</p><p>​    也就是意味着我的PS/2时序完全没有输出，这让我很是自闭。我又把我的键盘接回我的电脑，去同学那里借了一个普通薄膜键盘，不过这个键盘插上后逻辑分析仪的结果也是一样，我更自闭了，我认为我的使用方法完全正确，所以我怀疑是学校的PS/2模块本身就有问题。我正查着资料，突然灵机一动，打开我的设备管理器，看了一下设备情况，我发现原来我的键盘会被我的电脑识别成为多个键盘输入。</p><p><img src="https://i.loli.net/2020/03/20/LQeyx3IktGU6i9X.png" alt="image-20191229123717917"></p><p>​    这下我一下子就懂了，是我的键盘太高级了，我猜测是因为现代键盘都实现了N键无冲之类的功能，所以无法被简单识别成为单个设备（当然我懒得去考察这一猜测是否属实了），所以USB-HID在工作的时候，FT2232无法正常的识别与解码我的键盘。</p><h4 id="2-更换使用自制键盘"><a href="#2-更换使用自制键盘" class="headerlink" title="2.更换使用自制键盘"></a>2.更换使用自制键盘</h4><p>​    我在浙江大学学生E志者协会做社团工作的时候，曾经自己做过一个小键盘，当时我是使用佳达隆青轴作为轴体，使用HT82K629A作为控制芯片。拿来做这个课程作业非常合适！下面是百度找的HT82K629A的电路图：<img src="https://i.loli.net/2020/03/20/NeaxBwioQ4OLStl.png" alt="image-20191228174243712"></p><p>​    我的小键盘虽然简陋，但是却出奇的好用，接上这个小键盘，我的逻辑分析仪成功从两个引脚中读到了正确的时序图。</p><p>将这个小键盘的键盘码用DispNumber模块显示在Basys3的七段数码管上，也可以看到按下按键时键盘码正确显示，抬起按键时键盘码恢复为F0，说明我的PS/2模块是完全正常工作的。（下图使用了DSLogic的解码功能）</p><p><img src="https://i.loli.net/2020/03/20/71kQsWUKIYmXzSE.png" alt="image-20191229145638041"></p><p><img src="https://i.loli.net/2020/03/20/5ZcHGUDsYzOEXkq.png" alt="image-20191229145918962"></p><h4 id="3-移植到SWORD2-0"><a href="#3-移植到SWORD2-0" class="headerlink" title="3.移植到SWORD2.0"></a>3.移植到SWORD2.0</h4><p>我的代码移植到Nexys4-DDR这款板子上也可以正常工作，但是在SWORD板子上我却吃了瘪，后来得知SWORD的键盘码使用偶校验，更正后，我的键盘终于可以正常工作了！</p><h3 id="三、VGA模块与IP核生成"><a href="#三、VGA模块与IP核生成" class="headerlink" title="三、VGA模块与IP核生成"></a>三、VGA模块与IP核生成</h3><p>​    VGA模块是我踩坑踩的最多的一个模块。我在这次课程设计中使用的VGA模块来源于老师提供的VGAdemo。</p><p>​    首先碰到的问题是怎么去使用VGA模块。我一开始对VGA输出的Row_addr和Col_addr完全不能理解，我没想明白为什么会有这俩参数，我以为我要自己去推断每个周期我扫描到的像素点位置，结果写出来一堆乱七八糟的东西，完全不能运行。</p><p>​    在参考了几篇优秀报告后，我大概明白了，实际上这个VGA模块是先扫描到一个像素点，此时还没有把颜色涂上 ，VGA会先把这个点的坐标返回，然后根据你提供的data把这个点涂色。明白这个关键问题后，就开始了漫长的调试。</p><p>​    我一开始比较怂，没有直接综合实现，而是先写了Testbench进行仿真，然而仿真结果让我大吃一惊，我的行扫描与场扫描完全是红线。因为手上并没有VGA接口的显示器，没办法直接测试，于是我使用逻辑分析仪，测量HS与VS两个脚。HS与VS在Basys3上也就是P19和R19这两个针脚。</p><p>​    逻辑分析仪测得的时序结果非常稳定，从图中也可以看到场扫频率为60Hz，完全满足了我们的预期，于是我检查了一下仿真结果，原来是我仿真的时间太短，HS和VS还没有来得及出现。</p><p><img src="https://i.loli.net/2020/03/20/F6YmkoK8hUqjdME.png" alt="image-20191229125130221"></p><p>​    准备工作做好后，我开始生成我的ROMIP核，使用的是Block Memory Generator IP核，这里提一下，实际上除了Block Memory 还有 Distribute Memory 本质上其实就是使用FPGA的组合逻辑模拟出一些寄存器，效果并不是很好，而Block Memory则是内嵌在芯片内的高速RAM，再用这些高速RAM去充当ROM，就非常好。至于如何把BMP转成COE文件，这部分我是使用C语言完成的，代码已经放在本文最后，我在宋黎明老师开设的《图像信息处理》上已经熟练掌握了BMP的文件结构和如何使用C/C++操作BMP文件，因此就没有和其他同学那样使用Matlab进行图像处理。我们的IP核使用单口ROM核，因为我觉得单口已经足够满足需求了。</p><h4 id="1-资源问题"><a href="#1-资源问题" class="headerlink" title="1.资源问题"></a>1.资源问题</h4><p>​    烧好ROM核后，就出现了图片显示部分的中第一个问题：资源问题。从下面这份文件中我们可以知道，Basys3共有50块Block Memory，总共1800KB，而一张640x480，深度为12的coe文件大概需要52个Block Memory左右，所以我这个板子连一张背景图片都放不上去，于是我想到了插值。</p><p><img src="https://i.loli.net/2020/03/20/omEeiDLKrZqYdCS.png" alt="image-20191228195350478"></p><p>​    </p><p>总体的想法就是，不使用640x480的图片，而是改用320x240的图片，这样每张图片就只需要13个Block Memory。而在实际现实的时候，我们则将这张图片线性变换到640x480，具体的变换方法如下：</p><p>​    1.首先，我们先给定一个640x480的网格，求出一个到原图的逆线性变换，也就是求出从640x480的图片到320x240的线性变换。</p><p>​    2.然后，因为原先的网格是640x480的，变换到320x240必然会有很多点无法正好落到320x240的网格交点上，这些点应该显示出的颜色值由我们的插值得到的结果决定。</p><p>​    3.采用最近邻插值解决刚刚提出的问题。</p><p>所谓最邻近插值，也就是最naive的插值方法，即：把最近的像素点颜色原样搬过来。</p><p>假如图中的5个有坐标的点为320x240网格上的点，图中除了黄色点以为的其他点都是进行线性变换后640x480网格上的像素点，现在我们可以看到$P(x,y)$附近的四个点都没有正好落在格点上（我们先不管其他点），而他们四个距离黄色点最近，那么我在显示的时候，就把这四个点的颜色都显示成$P(x,y)$的颜色。</p><p>​    这是一种很简单很基础的插值，但是对于我们这种小图片还是很管用的，大大减少了Block Memory资源的浪费。</p><h4 id="2-同步问题"><a href="#2-同步问题" class="headerlink" title="2.同步问题"></a>2.同步问题</h4><p>我遇到的第二个问题是同步问题，我发现我显示的图片整体向右偏移了一个细条，我经过反复查阅资料和参考优秀实验报告，得出这是因为：我VGA模块输出的x，y坐标，在always语句中不会立刻计算这个xy对应的ROM地址值，他会等到下一个时钟周期（clkdiv[1]）到来的时候才会更新，ROM地址更新后，ROM的data也不会立刻更新，而是等到再过一个时钟周期，而VGA模块接受到Data后，也是要再过一个时钟周期才能更新，这就是为什么我的模块无法预期进行。</p><p>解决方案实际上是这样的：首先把根据x、y计算地址值的always模块改成always@(*)，这样他就会退化成时序逻辑，就不存在非阻塞赋值引发的延时问题了，但ROM模块必须是时序的，不过也有办法解决。我最开始给ROM的时钟是25MHz，与VGA同步，这样就一定会造成延迟，但我可以把ROM的时钟加速到VGA时钟的整数倍，比如100MHz。</p><p><img src="https://i.loli.net/2020/03/20/8dfRUk26CiI4OoV.png" alt="image-20191228214741772"></p><p>这样是可以完成对齐的，也可以解决延时问题，不过实际操作的时候我采用了50MHz的时钟频率，因为我发现理论上虽然100MHz可行，但Vivado综合会给出warning，提示我板子的Block Memory可接受最高的时钟频率是50MHz，因此就使用了clkdiv[0]作为时钟。</p><h4 id="3-曲线人物边缘问题"><a href="#3-曲线人物边缘问题" class="headerlink" title="3.曲线人物边缘问题"></a>3.曲线人物边缘问题</h4><p>我的图片显示出来后，还是存在很多问题，最典型的问题就是我的人物是一个复杂几何形状，但我烧好的ROM核里面的图片信息肯定是一个方形的，coe文件没办法携带Alpha通道，无法表示透明度，这样我的人都变成一个个方块，就非常不好。</p><p>我的解决方案也比较简单，就是选择在处理图片的时候，将方块中人物周围的不需要部分填充成为特殊颜色，在转换为coe文件后，只要读取到这种颜色编码，就选择不显示ROM中的数据，而是显示游戏背景，这样就避免了刚刚提到的问题。</p><p>不过另一个问题是，因为Photoshop生成的bmp图片是32位的，在转换为12位coe的时候就会使得很多颜色相近的颜色编码暴力变为同一种颜色编码，这个我最初在图片中埋藏的信息就不知道被转换成什么了。</p><p>所以我干脆以暴制暴，我把整个图片的色阶调低，让他所有颜色都变暗，背景颜色全部填充为0xffffffff，32位色到12位色是一个线性变换过程，不会改变端点的值，因此0xffffffff会被变换成0xffff，我只需检测0xffff就可以了，而且因为我调低了色阶，游戏人物的主体就不会被我干扰到。最后的成型效果如下：</p><p><img src="https://i.loli.net/2020/03/20/53rcMdmfwGt6DKR.png" alt="image-20191229151205953"></p><h3 id="四、底层封装与合理分工"><a href="#四、底层封装与合理分工" class="headerlink" title="四、底层封装与合理分工"></a>四、底层封装与合理分工</h3><p>我在写代码的过程中，觉得如果游戏逻辑的编写者还要去处理复杂的底层逻辑，比如VGA显示输出、七段数码管输出等等。我希望能够让游戏逻辑编写者不去思考这些问题，于是我将我们小组分为游戏逻辑编写和底层封装两部分，正好由两个人完成，两个人提前约定好API，就可以单独调试，互不干扰。</p><p>比如，在处理玩家显示位置的时候，底层部分就这样去实现：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span>(p1_location == <span class="number">5'b00000</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)<span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00001</span> &amp;&amp; x_pos &gt;= <span class="number">54</span> &amp;&amp; x_pos &lt; <span class="number">102</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">54</span>);</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00010</span> &amp;&amp; x_pos &gt;= <span class="number">187</span> &amp;&amp; x_pos &lt; <span class="number">235</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">187</span>);</span><br></pre></td></tr></table></figure><p>（这是一小部分代码举例）</p><p>在这种设计中，底层部分把人物的显示位置交给了变量p1_location接管，这个有限状态机的构造，就使得游戏逻辑的编写者只需简单操作p1_location的数值，就可以改变人物的显示位置。同样，房子的显示也是这样构造的：</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(has_house[<span class="number">1</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">96</span> &amp;&amp; x_pos &lt; <span class="number">144</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)<span class="keyword">begin</span></span><br><span class="line">house_data_addr &lt;= y_pos * <span class="number">48</span> + (x_pos - <span class="number">96</span>);</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(has_house[<span class="number">2</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">229</span> &amp;&amp; x_pos &lt; <span class="number">277</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)<span class="keyword">begin</span></span><br><span class="line">house_data_addr &lt;= y_pos * <span class="number">48</span> + (x_pos - <span class="number">229</span>);</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>不过有一点不同的是房子的状态是使用类似独热码（但不是）进行编码的，这样就可以在多个地方显示房子。</p><p>至于调试的时候，底层部分编写者就简单写一下Testbench，在里面为几个状态赋值一下，就可以测试到是否有正确显示图片，而游戏逻辑编写者，则可以仿真查看一下各个状态的情况，或者把状态输出到七段数码管和LED灯上。</p><p>从代码总量和调试时间上来看，这样分工也是很合理的，两个人最后是游戏逻辑比底层模块早完成一天。</p><h3 id="六、游戏逻辑的设计"><a href="#六、游戏逻辑的设计" class="headerlink" title="六、游戏逻辑的设计"></a>六、游戏逻辑的设计</h3><p>游戏逻辑的主体就是一个巨大的有限状态机。最顶层的状态被称为global_state，负责管理游戏的开始界面、游戏进行界面和游戏结束界面。而在游戏进行这个状态就是游戏逻辑的主要体现，游戏进行状态下设一个状态名为state的有限状态机，分管如下内容：</p><p>（配图：state状态机）</p><p>可以看出，在这个状态机中，状态与状态之间的转换是设计的最复杂部分。单纯去讲这个游戏的设计的复杂度并不能体现什么，所以我下面会挑一些我遇到的困难进行描述。</p><h4 id="1-随机数问题"><a href="#1-随机数问题" class="headerlink" title="1.随机数问题"></a>1.随机数问题</h4><p>在Verilog中，实际上是预制了随机数生成的方法，也就是使用：$random ，但是这个方法无法在Basys3上正常通过综合，这就造成了很多麻烦。我百度了一些随机数生成方法，最常见的也就是LFSR方法。</p><p><img src="https://i.loli.net/2020/03/20/Qkw9cDH1se3TIJq.png" alt="image-20191228234558989"></p><p>具体的原理上图已经很清楚了，就不过多赘述了，说说我碰到的问题，虽然LFSR模块可以给我一个随机数，但是不知为何，这个随机数在Basys3上是一个不会变化的随机数，这就导致了我的人物每次都走同样的路程，显然这是与我的初衷不符合的。在反复调试后，我依然没有让这个模块正常运转。现在我倒是可能理解了当时为什么会出现问题，很大可能是我为LFSR提供的时钟太快了（后面会详细描述）</p><p>于是我换了一种想法生成随机数，我自己写了一个计时模块，记录从游戏开始到现在经历的周期数目，然后截取低四位，模6再加1返回，作为随机数。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Random(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]random</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>]<span class="keyword">rand</span>;</span><br><span class="line">    <span class="keyword">assign</span> random =  <span class="keyword">rand</span>[<span class="number">3</span>:<span class="number">0</span>] % <span class="number">6</span> + <span class="number">1</span>; </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">rand</span> &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span> </span><br><span class="line">        <span class="keyword">rand</span> &lt;= <span class="keyword">rand</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>这个方法很简单，因为我需要随机数的地方只有掷骰子，而每次按下按键的间隔必然是不同的，所以这个随机数还是非常靠谱的。但是实际使用的时候，我所有得到的返回值都是1，也就是我rand % 6的结果都是0，但仿真结果是正常的，这就非常离谱。我调试了一天半，最后发现是时钟周期过快了，随机数模块接收的时钟周期太快了，以至于在物理实现上出现了锁存现象，后来经过试验，将时钟周期调到10ms是非常合适的。</p><p><img src="https://i.loli.net/2020/03/20/a5swQTgX3G6mDbB.png" alt="image-20191229000956417"></p><h4 id="2-掷骰子动画"><a href="#2-掷骰子动画" class="headerlink" title="2.掷骰子动画"></a>2.掷骰子动画</h4><p>我希望在掷骰子的过程中，尽可能让玩家有一些参与感，所以想用Arduino上的四个七段数码管显示一个掷骰子的过程，大概就是：七段数码管上面一直数字乱转，最后停在一个数字上静止，这个数字就是最后骰子的点数。实现这个动画花了我一点脑力，基本上就是，设置两个计数器，一个用来延时，一个用来更新显示数字，然后当更新数字的计数器归零的时候，意味着动画结束，就该显示我的骰子点数了。</p><p>想法是好的，初衷是好的，但是现实是残酷的，我这个东西一开始一直都是常数显示，随机数模块又弄了好久，最后发现的问题还是在非阻塞赋值上。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(step == <span class="number">4'b1111</span>)<span class="keyword">begin</span></span><br><span class="line">step &lt;= rand_num;</span><br><span class="line">rand_delay &lt;= <span class="number">0</span>;</span><br><span class="line">randing &lt;= <span class="number">4'b1111</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>( randing != <span class="number">0</span> )<span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(rand_delay != <span class="number">24'hffffff</span>)<span class="keyword">begin</span></span><br><span class="line">rand_delay &lt;= rand_delay + <span class="number">24'h000001</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">randing &lt;= randing - <span class="number">1</span>;</span><br><span class="line">rand_delay &lt;= <span class="number">0</span>;</span><br><span class="line">numberInArduino &lt;= &#123;<span class="number">12'b1100_0010_0000</span>,rand_num &#125;;</span><br><span class="line"><span class="keyword">if</span>(randing == <span class="number">4'b0001</span>)<span class="keyword">begin</span></span><br><span class="line">numberInArduino &lt;= &#123;<span class="number">12'b1100_0010_0000</span>, step &#125;;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>这段代码中，我所有的检测机制，比如对randing的检测，最初都是写的randing == 4‘b0000这样，但是问题在于，这是一个全部由非阻塞赋值写的always模块，我上一句虽然设置了randing归零，但是到了下面检测的时候还没有起作用，所以这里所有的语句都要提前“预判”检测。这个问题引发了不知道多少BUG，说到底还是我对Verilog不够熟悉。</p><h4 id="3-游戏性的考虑"><a href="#3-游戏性的考虑" class="headerlink" title="3.游戏性的考虑"></a>3.游戏性的考虑</h4><p>作为一个能被称为好的游戏，我认为游戏设计者必须考虑到平衡性的问题。因为游戏是《大富翁》，所以在这个游戏里面有很多触发事件。但是我最初设计的时候，六种普通事件分别是：GPA +0.3、GPA -0.3、Money +3000、Money -1500、Salary +1500、Salary -1000。</p><p>这些数据看起来好像没什么问题，但是很有问题的一点就是，金钱、GPA、薪水的期望值都是正的，也就是意味着，这个游戏在后期，越玩钱会越来越多。我曾经测试过，后期到一定程度后，即便一个人占领了全部土地，并在全部土地改好了房子，也很难让另一个玩家破产，但实际上面对这种绝对优势对方应该很快就要败北才对。从这一点考虑，无论如何游戏的金钱总期望应该是负的，这样才是一个有游戏性的游戏。所以我大幅度修改了这些事件的奖励值。</p><h4 id="4-更换性能更强大的板子：Nexys4-DDR"><a href="#4-更换性能更强大的板子：Nexys4-DDR" class="headerlink" title="4.更换性能更强大的板子：Nexys4 DDR"></a>4.更换性能更强大的板子：Nexys4 DDR</h4><p>虽然我已经对我的所有大图片都进行了最近邻插值处理，尽可能的提高空间利用率，但是到了游戏制作后期，我的图片素材占用空间仍然达到了61个Block memory，超过了Basys3能处理的50Block memory上限，这时候其实有两种办法处理，一种是干脆放弃Basys3，去509用SWORD，另一种则是使用FPGA外的存储设备，但是时间紧，任务重，我已经承担不起这个学习成本了。</p><p>最终我另辟蹊径，从我电气学院的同学那边借到了一块Nexys4 DDR板子，它的资源数有足足100 Block memory（当然价格也贵了一倍）。这块板子就成为了我后期调试DEBUG的救星。</p><p><img src="https://i.loli.net/2020/03/20/HSi2QX3I6nd4Zrx.png" alt="image-20191229115016099"></p><p>不过比较遗憾的是，这个板子的八个七段数码管全部都是并行的，而我的游戏中除了并行数码管还用了串行数码管，所以就没办法在这个板子上测试七段数码管了。所以最后几天我还是老老实实去509蹲了几天实验室，不得不说SWORD板子还是真的牛逼。</p><h1 id="Part4-改进想法"><a href="#Part4-改进想法" class="headerlink" title="Part4.改进想法"></a>Part4.改进想法</h1><h3 id="一、用双线性插值代替最近邻插值"><a href="#一、用双线性插值代替最近邻插值" class="headerlink" title="一、用双线性插值代替最近邻插值"></a>一、用双线性插值代替最近邻插值</h3><p>​    最近邻插值虽然简单好用，但是最后线性变换得到的图片清晰度实在是不敢恭维，只能说勉勉强强能看，要想在长宽各放大一倍的情况下还能得到清晰的图片，我最推荐的插值方式其实是双线性插值，但是因为实现起来比较麻烦，我真实的工程里面仍然使用的是最近邻插值。</p><p>具体操作：</p><p>​    设目标点$P$和其他四个点$Q_{11},Q_{12},Q_{21},Q_{22}$的颜色为$f(x,y),f(x_1,y_1),f(x_1,y_2),f(x_2,y_1),f(x_2,y_2)$</p><p>对目标点在$x$轴的两个投影点进行线性Lagrange插值：<br>$$<br>\displaystyle {<br>\begin{aligned}<br>    f(x,y_{1})&amp;\approx {\frac {x_{2}-x}{x_{2}-x_{1}}}f(Q_{11})+{\frac {x-x_{1}}{x_{2}-x_{1}}}f(Q_{21}),\<br>    f(x,y_{2})&amp;\approx {\frac {x_{2}-x}{x_{2}-x_{1}}}f(Q_{12})+{\frac {x-x_{1}}{x_{2}-x_{1}}}f(Q_{22}).<br>\end{aligned}}<br>$$<br>然后再对这两个点使用线性Lagrange插值，得出：<br>$$<br>{\displaystyle {\begin{aligned}f(x,y)&amp;\approx {\frac {y_{2}-y}{y_{2}-y_{1}}}f(x,y_{1})+{\frac {y-y_{1}}{y_{2}-y_{1}}}f(x,y_{2})\&amp;={\frac {y_{2}-y}{y_{2}-y_{1}}}\left({\frac {x_{2}-x}{x_{2}-x_{1}}}f(Q_{11})+{\frac {x-x_{1}}{x_{2}-x_{1}}}f(Q_{21})\right)\&amp;+{\frac {y-y_{1}}{y_{2}-y_{1}}}\left({\frac {x_{2}-x}{x_{2}-x_{1}}}f(Q_{12})+{\frac {x-x_{1}}{x_{2}-x_{1}}}f(Q_{22})\right)\&amp;={\frac {1}{(x_{2}-x_{1})(y_{2}-y_{1})}}{\big (}f(Q_{11})(x_{2}-x)(y_{2}-y)+f(Q_{21})(x-x_{1})(y_{2}-y)\&amp;+f(Q_{12})(x_{2}-x)(y-y_{1})+f(Q_{22})(x-x_{1})(y-y_{1}){\big )}\&amp;={\frac {1}{(x_{2}-x_{1})(y_{2}-y_{1})}}{\begin{bmatrix}x_{2}-x&amp;x-x_{1}\end{bmatrix}}{\begin{bmatrix}f(Q_{11})&amp;f(Q_{12})\f(Q_{21})&amp;f(Q_{22})\end{bmatrix}}{\begin{bmatrix}y_{2}-y\y-y_{1}\end{bmatrix}}.\end{aligned}}}<br>$$<br>这样我们就得到了目标点的颜色值。我一般使用双线性插值时都是对$RGB$三个通道一起进行双线性插值，实际上也可以对三个通道分别进行双线性插值，效果也不错。</p><h3 id="二、为游戏添加配乐"><a href="#二、为游戏添加配乐" class="headerlink" title="二、为游戏添加配乐"></a>二、为游戏添加配乐</h3><p>作为一款大富翁游戏，没有音乐实在是非常遗憾，但实际上这个功能的实现并不是很复杂。我们可以看到，SWORD板子上附带的那个小块Arduino实际上已经自带了一个蜂鸣器，使用这个蜂鸣器就可以简单做出配乐效果。</p><p>但是我问了一些学长学姐，据说509实验板上的蜂鸣器都是被屏蔽改造的，因为往届做实验的时候蜂鸣器会经常发声，干扰学生，于是学校就把这些蜂鸣器都屏蔽了（未经考证）</p><p>这就断了蜂鸣器这条路。不过如果真的想做配乐，也不是没有办法的。我思考了一下大概有两条路：</p><p>其一，使用SWORD板子上的3.5MM音频输出口。</p><p><img src="https://i.loli.net/2020/03/20/c4ErHGShJoQpj8z.png" alt="image-20191229120706561"></p><p>这个3.5MM接口的推力可能不是很够，这里我没有找到SWORD2.0的设计文档，不过我自己猜测应该和Nexys4-DDR的3.5MM接口构造差不多。下图是Nexys4-DDR的设计图：</p><p><img src="https://i.loli.net/2020/03/20/sUhApQK7aSczFNV.png" alt="image-20191229121209930"></p><p>看起来只是可以输出音频信号，但是推动力应该不够驱动小音箱，不过我们可以从淘宝上购买一个小功放来解决这个问题。</p><p><img src="https://i.loli.net/2020/03/20/b8zBEgnDJcloxvr.png" alt="image-20191229121845673"></p><p>不过这个改造和使用起来也不是很方便。</p><p>第二种方法就是使用板子上的Pmods扩展一个音频输出。Digilent中国官网上就有售卖这种东西，我们以PmodAMP2举例：</p><p><img src="https://i.loli.net/2020/03/20/1YUAFsi2lQ4bcMW.png" alt="image-20191229122054226"></p><p>这种方式的好处是文档齐全，而且保证能用，毕竟是官网扩展，肯定是靠谱的。</p><p><img src="https://i.loli.net/2020/03/20/wBp1CNadlmqJu3O.png" alt="image-20191229122154147"></p><p>PmodAMP2的构造非常简单，如果不想购买的话也可以直接自己焊一块出来。官方有很多这个模块的使用教程，甚至还有一些PmodAMP2配合Basys3制作的项目案例，比如节奏大师之类的。</p><p>使用PmodAMP2的时候只需要把对应的模块针脚接好就行了。</p><p><img src="https://i.loli.net/2020/03/20/KhVWqAsSZuLMJoj.png" alt="image-20191229122355972"></p><h3 id="三、实现人物选择界面"><a href="#三、实现人物选择界面" class="headerlink" title="三、实现人物选择界面"></a>三、实现人物选择界面</h3><p>在期中时交的课程设计规划中，我给出了一个人物选择界面，支持2-4人同时游戏，其实这一部分在实现难度上并不大，对于一个大富翁游戏而言，2个玩家4个玩家的区别无非就是复读一遍代码，把状态机改的更复杂一点，但是问题在于，如果添加了任务选择界面，我就需要再添加一张320x240的选择界面图片和四张192x192人物大图以及两个48x48人物小图。</p><p>在添加这些图片之前，我已经使用了61个Block Memory，加上这些图片必然会超过100个Block Memory，而Nexys4-DDR仅有100个Block Memory，所以为了方便我的调试（不想每天都蹲在509），就把这部分无关紧要的添头功能去掉了。</p><h1 id="Part5-辅助模块描述"><a href="#Part5-辅助模块描述" class="headerlink" title="Part5.辅助模块描述"></a>Part5.辅助模块描述</h1><h3 id="一、BCD转换模块"><a href="#一、BCD转换模块" class="headerlink" title="一、BCD转换模块"></a>一、BCD转换模块</h3><p>该模块十分简单，主要工作就是把传入的数据（二进制）进行处理，转换为十进制输出，该模块的作用是将人物的金钱、绩点等信息转换为十进制，然后送给七段数码管模块进行显示。代码如下图所示，输入数据为8bit或20bit的二进制数值，然后转换为相应的四位十进制数输出。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> BCD_20(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">19</span>:<span class="number">0</span>]binary,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">19</span>:<span class="number">0</span>]bcd</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d1;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d2;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d3;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d4;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d5;    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> d1 = binary % <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">assign</span> d2 = (binary / <span class="number">10</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> d3 = (binary / <span class="number">100</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> d4 = (binary / <span class="number">1000</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> d5 = (binary / <span class="number">10000</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> bcd = &#123; d5 , d4 , d3 , d2 , d1 &#125;;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="二、ROM-IP核模块"><a href="#二、ROM-IP核模块" class="headerlink" title="二、ROM IP核模块"></a>二、ROM IP核模块</h3><p>本游戏的游戏界面为静态显示，为了给玩家带来更好的游戏体验，我们从网上搜寻和绘制处理了丰富的图片素材，通过c语言处理32位，生成相应的COE文件，创建了游戏开始界面、游戏盘、游戏结束界面、人物、房屋、事件卡等图片的ROM IP核。</p><p>具体如下图所示。</p><p><img src="https://i.loli.net/2020/03/20/x15vO9wcyhLJHMn.png" alt="image-20191229165250124"></p><p>其中，backboard、start、event图片均采取了最近邻差值的方式进行处理，可以在保存图像信息的情况下尽量减少ROM占用。而house与player图片则使用了PS工具进行处理，人物、房屋边缘以外的部分均为白色，并调整主体部分的色阶。当读取到0xffff时，转而读取gameborad的图像信息，以实现图片有效覆盖的设计。</p><p>、start图片均采取了最逼近差值的方式进行处理，可以在保障图像信息的情况下更好地完成显示。而house与player图片则使用了PS工具进行处理，人物、房屋边缘以外的部分均为白色，并调整主体部分的色阶。当读取到0xffff时，转而读取gameborad的图像信息，以实现图片有效覆盖的设计。</p><h3 id="三、随机数模块"><a href="#三、随机数模块" class="headerlink" title="三、随机数模块"></a>三、随机数模块</h3><p>这个部分前文已经介绍了，这里略过。</p><h3 id="四、VGA模块"><a href="#四、VGA模块" class="headerlink" title="四、VGA模块"></a>四、VGA模块</h3><p>使用的是学校提供的VGAdemo中的VGA模块，代码附在文末。</p><h3 id="五、PS-2模块"><a href="#五、PS-2模块" class="headerlink" title="五、PS/2模块"></a>五、PS/2模块</h3><p>使用的是学校提供的SWORD说明书PPT中的PS/2模块，代码附在文末。</p><h3 id="六、DispNumber模块"><a href="#六、DispNumber模块" class="headerlink" title="六、DispNumber模块"></a>六、DispNumber模块</h3><p>在数逻实验中我们曾经自己通过ISE画图的方式设计过并行数码管显示模块，但是我觉得我当时画图得到的模块不是很好用，于是将sch生成的vf文件改造了一下，重构了部分代码，把所有的使能改成了高有效。代码附在文末</p><h3 id="七、去抖动模块"><a href="#七、去抖动模块" class="headerlink" title="七、去抖动模块"></a>七、去抖动模块</h3><p>使用的是实验课上做的pbdebounce模块，用来给按钮输入去抖动，没什么好说的，大家都做过。</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> pbdebounce(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> clk_1ms,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> button,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> pbreg</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] pbshift;</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        pbshift = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk_1ms)<span class="keyword">begin</span></span><br><span class="line">    pbshift = pbshift &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    pbshift[<span class="number">0</span>]=button;</span><br><span class="line">    <span class="keyword">if</span> (pbshift==<span class="number">8'b0</span>)</span><br><span class="line">    pbreg=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (pbshift==<span class="number">8'hff</span>)</span><br><span class="line">     pbreg=<span class="number">1</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="八、分频器模块"><a href="#八、分频器模块" class="headerlink" title="八、分频器模块"></a>八、分频器模块</h3><p>使用实验课上做的clkdiv模块，没什么好描述的，代码附在文末。</p><h3 id="九、串行数码管显示模块"><a href="#九、串行数码管显示模块" class="headerlink" title="九、串行数码管显示模块"></a>九、串行数码管显示模块</h3><p>这个模块的核心部分是并行转串行，需要一个移位寄存器，这个部分的代码我是使用的VGAdemo中的位移寄存器，译码工作则是使用的MC14495模块。代码附在文末</p><h1 id="Part6-仿真、资源分配与RTL"><a href="#Part6-仿真、资源分配与RTL" class="headerlink" title="Part6.仿真、资源分配与RTL"></a>Part6.仿真、资源分配与RTL</h1><h3 id="一、RTL、资源分配与引脚分配图"><a href="#一、RTL、资源分配与引脚分配图" class="headerlink" title="一、RTL、资源分配与引脚分配图"></a>一、RTL、资源分配与引脚分配图</h3><p>这次课程作业使用的板子是SWORD2.0，我利用的资源也是非常多的，包括arduino七段数码管、主板串行七段数码管、VGA、USB-HID等等，综合实现后的资源使用图如下：</p><p><img src="https://i.loli.net/2020/03/20/sL49kRAZv6Iy1Kx.png" alt="image-20191229174557967"></p><p>引脚分配图如下：</p><p><img src="https://i.loli.net/2020/03/20/uOib3KQtWqZCRGd.png" alt="image-20191229175054998"></p><p>Schematic图如下：</p><p><img src="https://i.loli.net/2020/03/20/UyS5g4bMkLWRwiC.png" alt="image-20191229175234475"></p><p>从上面这几张图我们可以看到，这次课程作业实际上使用的门级电路和板上资源是非常非常多的，我使用1467cells，总计8320nets，连输出输入口都有39个，实际上在期中开题报告中，我本来规划做出更多的功能，但未能完全实现主要还是受到了板子资源的制约和时间制约。</p><h3 id="二、TOP模块综合后时序仿真"><a href="#二、TOP模块综合后时序仿真" class="headerlink" title="二、TOP模块综合后时序仿真"></a>二、TOP模块综合后时序仿真</h3><p>####输入输出时序图</p><p><img src="https://i.loli.net/2020/03/20/VaPkFzGulJ7RwKS.png" alt="image-20191230134808335"></p><h4 id="游戏关键变量时序图：玩家金钱与GPA"><a href="#游戏关键变量时序图：玩家金钱与GPA" class="headerlink" title="游戏关键变量时序图：玩家金钱与GPA"></a>游戏关键变量时序图：玩家金钱与GPA</h4><p><img src="https://i.loli.net/2020/03/20/MdWhN42Zr9BHkGC.png" alt="image-20191230140254197"></p><h3 id="三、TOP模块实现后时序仿真"><a href="#三、TOP模块实现后时序仿真" class="headerlink" title="三、TOP模块实现后时序仿真"></a>三、TOP模块实现后时序仿真</h3><h4 id="输入输出时序图"><a href="#输入输出时序图" class="headerlink" title="输入输出时序图"></a>输入输出时序图</h4><p><img src="https://i.loli.net/2020/03/20/ypY72XSVUe6gmcF.png" alt="image-20191230120328942"></p><p><img src="https://i.loli.net/2020/03/20/HUO3rBhJNpS1wQv.png" alt="image-20191230120435765"></p><h4 id="游戏关键变量时序图：玩家金钱与GPA-1"><a href="#游戏关键变量时序图：玩家金钱与GPA-1" class="headerlink" title="游戏关键变量时序图：玩家金钱与GPA"></a>游戏关键变量时序图：玩家金钱与GPA</h4><p><img src="https://i.loli.net/2020/03/20/UWi1wd3z8b2g7fl.png" alt="image-20191230130254321"></p><h1 id="Part7-物理验证"><a href="#Part7-物理验证" class="headerlink" title="Part7.物理验证"></a>Part7.物理验证</h1><p>这次课程作业前期主要在Basys3上完成，后期资源不够后则改用Nexys4完成，最后再移植到SWORD2.0上。</p><p>最终的工程文件已经不能在Basys3上通过实现了（资源数不足）因此我们物理验证仅在Nexys4和SWORD2.0上开展，顺便也验证工程的可移植性。</p><p>以下综合、实现、生成比特流均在下述配置下进行，使用开发工具为Vivado 2019.1：</p><p><strong>CPU Name: Intel(R) Core(TM) i7-8650U CPU @ 1.90GHz</strong></p><table><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>Base Frequency</td><td>2.11 GHz</td></tr><tr><td>Max Turbo Frequency</td><td>4.20 GHz</td></tr><tr><td>Cache</td><td>8 MB Intel® Smart Cache</td></tr><tr><td>Cores Number</td><td>4</td></tr><tr><td>Threads</td><td>8</td></tr><tr><td>TDP(TDP-up)</td><td>25W</td></tr></tbody></table><p><strong>RAM:   16GB LPDDR3 2133MHz with Two channel memory</strong></p><p><strong>SSD:     SAMSUNG MZVLB512HAJQ-000L7</strong></p><h3 id="一、Nexys4物理验证"><a href="#一、Nexys4物理验证" class="headerlink" title="一、Nexys4物理验证"></a>一、Nexys4物理验证</h3><p>由于金钱和GPA两个部分需要在去串行的七段数码管上显示，Nexys4不具备这个硬件，所以这个部分在Nexys4的物理验证中不会给出。我在代码中注释掉这个部分。</p><p>我们来记录一下时间：</p><table><thead><tr><th>Event</th><th>Time</th></tr></thead><tbody><tr><td>Synthesis（including ROM IP cores）</td><td>00:01:22</td></tr><tr><td>Implementation</td><td>00:01:48</td></tr><tr><td>Generate Bitstream</td><td>00:00:26</td></tr></tbody></table><p>连接板子进行验证：</p><p><img src="https://i.loli.net/2020/03/20/WYGmPqltaQjn97i.png" alt="image-20200320132824054"></p><p>从上图可以看出，我们的游戏界面很好的展现了（注：屏幕左上角白斑是屏幕自身有物理损坏，并非代码问题）</p><p>进入正式的游戏界面，我们可以看到：</p><p><img src="https://i.loli.net/2020/03/20/lXU5mtxygBRjoEz.png" alt="image-20191230154523963"></p><p>我们的游戏界面也是可以正确显示的，现在再让我们看一下并行七段数码管的显示效果：</p><p><img src="https://i.loli.net/2020/03/20/QtDEB7OVlbKqxRW.png" alt="image-20191230154611173"></p><p>C1代表轮到玩家1游戏，这说明我们正确的显示了游戏顺序。下面是事件的触发截图：</p><p><img src="https://i.loli.net/2020/03/20/qwZKMsUTL1yiteD.png" alt="image-20191230154727877"></p><p>此时，轮到了玩家2游戏：</p><p><img src="https://i.loli.net/2020/03/20/RVhDrHUApmzLc9Y.png" alt="image-20191230154829149"></p><p>可以看到显示数据也是完全正确的。</p><p>至此，我们简单的物理验证成功，满足了最初的设计需求。</p><h3 id="二、SWORD2-0物理验证"><a href="#二、SWORD2-0物理验证" class="headerlink" title="二、SWORD2.0物理验证"></a>二、SWORD2.0物理验证</h3><p>首先还是一样，我们先来记录一下时间：</p><table><thead><tr><th>Event</th><th>Time</th></tr></thead><tbody><tr><td>Synthesis（including ROM IP cores）</td><td>00:01:54</td></tr><tr><td>Implementation</td><td>00:02:28</td></tr><tr><td>Generate Bitstream</td><td>00:01:06</td></tr></tbody></table><p>因为本次课程设计的主要板子是SWORD2.0，所以我们会在这个板子上验证全部的功能实现。</p><p>首先是游戏开始画面的展示：</p><p><img src="https://i.loli.net/2020/03/20/BtDAKgbQh84ZIU5.png" alt="image-20200101155424592"></p><p>进入游戏：</p><p><img src="https://i.loli.net/2020/03/20/epTRXhsyH9Z5gfW.png" alt="image-20200101155506377"></p><p>数码管显示：</p><p><img src="https://i.loli.net/2020/03/20/Rxkcr4Le3yNalvf.png" alt="image-20200101155528717"></p><p>触发事件：</p><p><img src="https://i.loli.net/2020/03/20/xYmh7XvNFZ3SA1u.png" alt="image-20200101155547032"></p><p>购买土地：</p><p><img src="https://i.loli.net/2020/03/20/iAgLG1EeTSaJvrB.png" alt="image-20200101155619122"></p><p>上图紫色和白色圆点分别代表玩家1、2持有土地</p><p>从上述内容可以看出，我们的游戏在SWORD2.0上也能很好的运行，这完成了我们的课程设计预期目的，同时也验证了我们游戏具有良好的可移植性，在不同资源数的板子上都可以正常运行。</p><h1 id="Part8-心得体会"><a href="#Part8-心得体会" class="headerlink" title="Part8.心得体会"></a>Part8.心得体会</h1><p>数逻的课程设计是我在大学这段时间碰到的最困难的课程设计，其困难的主要原因在于我对Verilog语法和对开发环境的不熟悉。硬件开发与以往我们使用高级语言进行软件开发的感觉完全不同，因为他既需要很好的逻辑思维，又需要开发者直接去与底层接触，思考每个模块在物理实现上的运作方式。这个作业前前后后做了两周多的时间，并且紧紧连着考试周，所以我做的也非常紧张。</p><p>如果这个作业不是在考试周附近完成的，我可能会做的更好，我觉得目前看来制约我作业完成程度的主要原因还是时间和其他学科的课业压力。</p><p>在本次实验过程中，我参考了很多先人前辈的作品，也翻阅了很多文档。下面是我自己的一点心得：</p><h3 id="对我有帮助的参考文档"><a href="#对我有帮助的参考文档" class="headerlink" title="对我有帮助的参考文档"></a>对我有帮助的参考文档</h3><h4 id="1-Digilent中国"><a href="#1-Digilent中国" class="headerlink" title="1.Digilent中国"></a>1.Digilent中国</h4><p>这是Digilent的中国官网，里面从开发板购买、入门，到Verilog编写、仿真、物理实现都有很详细的教程，而且有自己的开源社区，有无数FPGA爱好者在这里讨论，作为一个课程设计的编写者，这个网站的资源对我是非常非常有价值的。</p><p>我自己的板子是Basys3，Basys3的教程也是最为丰富的之一。</p><p>这些项目中，有很多精品，对课程设计会起到极大的帮助，我最开始设计课程作业的时候就是先阅读了下面这个贪吃蛇小游戏的代码，从代码中学习Verilog的编写方法和流程，逐步去学会自己设计。</p><h4 id="2-ZJUArch"><a href="#2-ZJUArch" class="headerlink" title="2.ZJUArch"></a>2.ZJUArch</h4><p>在github上有浙大的一个仓库，名为ZJUArch，里面有着很丰富的Verilog语法学习资料，适合初学者入门参考。<img src="https://i.loli.net/2020/03/20/SJGDIvB8x41jsrz.png" alt="image-20191229114046330"></p><h4 id="3-FPGA4FUN"><a href="#3-FPGA4FUN" class="headerlink" title="3.FPGA4FUN"></a>3.FPGA4FUN</h4><p><a href="https://www.fpga4fun.com/" target="_blank" rel="noopener">https://www.fpga4fun.com/</a> 是一个神奇的网站，里面专门有很多神仙教程教新人如何使用FPGA做一些有趣的东西，课程设计的VGA和PS2模块在这里讲的非常清楚。</p><p><img src="https://i.loli.net/2020/03/20/R6haZfvlqtQFDA2.png" alt="image-20191229114236200"></p><h1 id="附录：各模块代码合集"><a href="#附录：各模块代码合集" class="headerlink" title="附录：各模块代码合集"></a>附录：各模块代码合集</h1><h3 id="一、TOP模块（附有注释）"><a href="#一、TOP模块（附有注释）" class="headerlink" title="一、TOP模块（附有注释）"></a>一、TOP模块（附有注释）</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br><span class="line">1485</span><br><span class="line">1486</span><br><span class="line">1487</span><br><span class="line">1488</span><br><span class="line">1489</span><br><span class="line">1490</span><br><span class="line">1491</span><br><span class="line">1492</span><br><span class="line">1493</span><br><span class="line">1494</span><br><span class="line">1495</span><br><span class="line">1496</span><br><span class="line">1497</span><br><span class="line">1498</span><br><span class="line">1499</span><br><span class="line">1500</span><br><span class="line">1501</span><br><span class="line">1502</span><br><span class="line">1503</span><br><span class="line">1504</span><br><span class="line">1505</span><br><span class="line">1506</span><br><span class="line">1507</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Company: </span></span><br><span class="line"><span class="comment">// Engineer: </span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// Create Date: 12/06/2019 08:38:02 PM</span></span><br><span class="line"><span class="comment">// Design Name: </span></span><br><span class="line"><span class="comment">// Module Name: Top</span></span><br><span class="line"><span class="comment">// Project Name: </span></span><br><span class="line"><span class="comment">// Target Devices: </span></span><br><span class="line"><span class="comment">// Tool Versions: </span></span><br><span class="line"><span class="comment">// Description: </span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// Dependencies: </span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// Revision:</span></span><br><span class="line"><span class="comment">// Revision 0.01 - File Created</span></span><br><span class="line"><span class="comment">// Additional Comments:</span></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">//////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> Top(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">input</span> reset, <span class="comment">//restart the game</span></span><br><span class="line">    <span class="keyword">input</span> sw_input, <span class="comment">//swith the input-style : PS2/button</span></span><br><span class="line">    <span class="keyword">input</span> dice_in, <span class="comment">//roll the dice</span></span><br><span class="line">    <span class="keyword">input</span> yes_in, <span class="comment">//1 means choosing yes</span></span><br><span class="line">    <span class="keyword">input</span> no_in, <span class="comment">//1 means choosing no</span></span><br><span class="line">    <span class="keyword">input</span> ps2_clk,</span><br><span class="line">    <span class="keyword">input</span> ps2_data,</span><br><span class="line">    <span class="comment">//SWORD</span></span><br><span class="line">     <span class="keyword">output</span> S_DT,</span><br><span class="line">     <span class="keyword">output</span> S_CLK,</span><br><span class="line">     <span class="keyword">output</span> S_CLR,</span><br><span class="line">     <span class="keyword">output</span> S_EN,</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>]ArduinoAN,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>]ArduinoSegment,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] r,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] g,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] b,</span><br><span class="line">    <span class="keyword">output</span> hs,</span><br><span class="line">    <span class="keyword">output</span> vs,</span><br><span class="line">    <span class="keyword">output</span> keypad</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//Keypad</span></span><br><span class="line"><span class="keyword">assign</span> keypad = <span class="number">1'b0</span>;</span><br><span class="line"><span class="comment">//VGA out</span></span><br><span class="line"><span class="keyword">wire</span> VGA_rdn;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">16</span>:<span class="number">0</span>]x_pos;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">16</span>:<span class="number">0</span>]y_pos;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">11</span>:<span class="number">0</span>]display_data;</span><br><span class="line"><span class="comment">//input </span></span><br><span class="line"><span class="keyword">reg</span> yes;</span><br><span class="line"><span class="keyword">reg</span> no;</span><br><span class="line"><span class="keyword">reg</span> dice; </span><br><span class="line"><span class="comment">//PS2 out</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">9</span>:<span class="number">0</span>]ps2_data_cur;</span><br><span class="line"><span class="keyword">wire</span> ps2_ready;</span><br><span class="line"><span class="comment">//rom addr</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">16</span>:<span class="number">0</span>]background_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]background_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">11</span>:<span class="number">0</span>]player1_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]player1_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">11</span>:<span class="number">0</span>]player2_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]player2_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">11</span>:<span class="number">0</span>]house_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]house_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">16</span>:<span class="number">0</span>]start_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]start_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">14</span>:<span class="number">0</span>]game_over_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]game_over_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">13</span>:<span class="number">0</span>]event1_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]event1_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">13</span>:<span class="number">0</span>]event2_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]event2_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">13</span>:<span class="number">0</span>]event3_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]event3_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">13</span>:<span class="number">0</span>]event4_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]event4_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">13</span>:<span class="number">0</span>]event5_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]event5_data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">13</span>:<span class="number">0</span>]event6_data_addr;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>]event6_data;</span><br><span class="line"></span><br><span class="line"><span class="comment">//disp number</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">15</span>:<span class="number">0</span>]numberInArduino;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>]numberInSWORD;</span><br><span class="line"><span class="comment">//AntiJitter</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>]clk_div;</span><br><span class="line"><span class="keyword">wire</span> dice_AJ;</span><br><span class="line"><span class="keyword">wire</span> yes_AJ;</span><br><span class="line"><span class="keyword">wire</span> no_AJ;</span><br><span class="line"><span class="comment">//rand</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]rand_num;</span><br><span class="line">Random FuckRandom(<span class="variable">.clk</span>(clk_div[<span class="number">21</span>]),<span class="variable">.random</span>(rand_num));</span><br><span class="line">clkdiv clk_d(<span class="variable">.clk</span>(clk),<span class="variable">.rst</span>(reset),<span class="variable">.clkdiv</span>(clk_div));</span><br><span class="line">pbdebounce ccc(<span class="variable">.clk_1ms</span>(clk_div[<span class="number">16</span>]),<span class="variable">.button</span>(~dice_in),<span class="variable">.pbreg</span>(dice_AJ));</span><br><span class="line">pbdebounce ddd(<span class="variable">.clk_1ms</span>(clk_div[<span class="number">16</span>]),<span class="variable">.button</span>(~yes_in),<span class="variable">.pbreg</span>(yes_AJ));</span><br><span class="line">pbdebounce eee(<span class="variable">.clk_1ms</span>(clk_div[<span class="number">16</span>]),<span class="variable">.button</span>(~no_in),<span class="variable">.pbreg</span>(no_AJ));</span><br><span class="line"></span><br><span class="line"><span class="comment">//debug</span></span><br><span class="line"><span class="comment">//assign reset = rst;</span></span><br><span class="line"><span class="comment">//assign sw_input_AJ = sw_input;</span></span><br><span class="line"><span class="comment">//assign dice_AJ = dice;</span></span><br><span class="line"><span class="comment">//assign no_AJ = no;</span></span><br><span class="line"><span class="comment">//assign yes_AJ = yes;</span></span><br><span class="line"><span class="comment">// reg S_DT;</span></span><br><span class="line"><span class="comment">// reg  S_CLK;</span></span><br><span class="line"><span class="comment">// reg S_CLR;</span></span><br><span class="line"><span class="comment">// reg S_EN;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ROM</span></span><br><span class="line">Start start_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(start_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(start_data));</span><br><span class="line">Game_over game_over_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(game_over_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(game_over_data));</span><br><span class="line">background Background_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(background_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(background_data));<span class="comment">//ROM of background img</span></span><br><span class="line">House_rom House_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(house_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(house_data));<span class="comment">//ROM of house img</span></span><br><span class="line">Player1_rom Player1_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(player1_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(player1_data));<span class="comment">//ROM of house img</span></span><br><span class="line">Player2_rom Player2_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(player2_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(player2_data));<span class="comment">//ROM of house img</span></span><br><span class="line">event1 event1_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(event1_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(event1_data));</span><br><span class="line">event2 event2_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(event2_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(event2_data));</span><br><span class="line">event3 event3_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(event3_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(event3_data));</span><br><span class="line">event4 event4_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(event4_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(event4_data));</span><br><span class="line">event5 event5_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(event5_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(event5_data));</span><br><span class="line">event6 event6_rom(<span class="variable">.ena</span>(~reset),<span class="variable">.addra</span>(event6_data_addr),<span class="variable">.clka</span>(clk_div[<span class="number">0</span>]),<span class="variable">.douta</span>(event6_data));</span><br><span class="line"></span><br><span class="line"><span class="comment">//input and output </span></span><br><span class="line">vgac Display(<span class="variable">.d_in</span>(display_data),<span class="variable">.vga_clk</span>(clk_div[<span class="number">1</span>]),<span class="variable">.clrn</span>(~reset),<span class="variable">.row_addr</span>(y_pos[<span class="number">8</span>:<span class="number">0</span>]),<span class="variable">.col_addr</span>(x_pos[<span class="number">9</span>:<span class="number">0</span>]),<span class="variable">.r</span>(r),<span class="variable">.g</span>(g),<span class="variable">.b</span>(b),<span class="variable">.rdn</span>(VGA_rdn),<span class="variable">.hs</span>(hs),<span class="variable">.vs</span>(vs));<span class="comment">// display module</span></span><br><span class="line">ps2_keyboard KBD(<span class="variable">.clk</span>(clk), <span class="variable">.rst</span>(reset), <span class="variable">.ps2_clk</span>(ps2_clk), <span class="variable">.ps2_data</span>(ps2_data), <span class="variable">.data_out</span>(ps2_data_cur),<span class="variable">.ready</span>(ps2_ready));<span class="comment">//ps2 keyboard module</span></span><br><span class="line"></span><br><span class="line">DispNumber DispNumberInArduino(<span class="variable">.clk</span>(clk),<span class="variable">.HEXS</span>(numberInArduino),<span class="variable">.LES</span>(<span class="number">4'b1101</span>),<span class="variable">.points</span>(<span class="number">4'b0000</span>),<span class="variable">.RST</span>(reset),<span class="variable">.AN</span>(ArduinoAN),<span class="variable">.Segment</span>(ArduinoSegment));</span><br><span class="line">SEG_DRV DispNumberInSWORD(<span class="variable">.clk</span>(clk),<span class="variable">.num</span>(numberInSWORD),<span class="variable">.ena</span>(~reset),<span class="variable">.point</span>(<span class="number">8'b1000_0000</span>),<span class="variable">.S_DT</span>(S_DT),<span class="variable">.S_CLK</span>(S_CLK),<span class="variable">.S_CLR</span>(S_CLR),<span class="variable">.S_EN</span>(S_EN));</span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//GAME Properties</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>]global_state;</span><br><span class="line"><span class="comment">//the global state: 0 represents start-state; 1 represents game-going; 2 represents game-over.</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">2</span>:<span class="number">0</span>]state;</span><br><span class="line"><span class="comment">/*the state of game-going: 0 represents stand-by state for checking current player properties to tell if the game is over, to decide the next state;</span></span><br><span class="line"><span class="comment">                           1 represents that it's player1's turn to roll the dice;</span></span><br><span class="line"><span class="comment">                           2 represents that it's player2's turn to roll the dice;</span></span><br><span class="line"><span class="comment">                           3 represents executing red-square events;</span></span><br><span class="line"><span class="comment">                           4 represents random events;</span></span><br><span class="line"><span class="comment">                           5 represents buying empty land or build houses on your land;</span></span><br><span class="line"><span class="comment">                           6 represents staying on another player's land;</span></span><br><span class="line"><span class="comment">                           7 represents game over.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">reg</span> turn; <span class="comment">//1 represents it's player1's turn while 0 reprenstes palyer2</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">19</span>:<span class="number">0</span>]has_house; <span class="comment">//to tell if there are any houses on 20 lands: 0 means there are no houses while 1 means there is</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">39</span>:<span class="number">0</span>]land_owner; <span class="comment">//to store the land onwer information of 20 lands: 00 means the land doesn't belong to anyone; 01 means the land belongs to player1 while 10 means the land belongs to player2</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">23</span>:<span class="number">0</span>]move_delay; <span class="comment">//the time interval of showing the movement steps of the players</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>]step; <span class="comment">//to store the steps one player should go after rolling the dice.</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">23</span>:<span class="number">0</span>]rand_delay; <span class="comment">//the time interval of showing the rolling numbers of the dice</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>]randing; <span class="comment">//the dice number shown each time</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">23</span>:<span class="number">0</span>]gpa_delay; <span class="comment">//the time interval of showing the random gpa after one player stay on the exam square</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>]gpa_rand; <span class="comment">//the gpa of the player gets after staying ont the exam square</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>]show_event; <span class="comment">//the card of 6 random events</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Player Properties</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">19</span>:<span class="number">0</span>]p1_money;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">19</span>:<span class="number">0</span>]p2_money; <span class="comment">//in the range of 0-88888</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">19</span>:<span class="number">0</span>]p1_money_bcd;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">19</span>:<span class="number">0</span>]p2_money_bcd;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>]p1_gpa; </span><br><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>]p2_gpa; <span class="comment">//in the range of 0-50, 50 represents gpa 5.0</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>]p1_gpa_bcd;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>]p2_gpa_bcd;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">19</span>:<span class="number">0</span>]p1_salary;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">19</span>:<span class="number">0</span>]p2_salary; <span class="comment">//salary means the monthly living expenses</span></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>]p1_location;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>]p2_location;</span><br><span class="line"><span class="keyword">reg</span> p1_sleep; <span class="comment">//the sleep state of player1: if it's 1, player1 will skip his next turn.</span></span><br><span class="line"><span class="keyword">reg</span> p2_sleep; <span class="comment">//the sleep state of player1: if it's 1, player2 will skip his next turn.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//initialization</span></span><br><span class="line"><span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">    yes &lt;= <span class="number">0</span>;</span><br><span class="line">    no &lt;= <span class="number">0</span>;</span><br><span class="line">    dice &lt;= <span class="number">0</span>;</span><br><span class="line">    global_state &lt;= <span class="number">0</span>;</span><br><span class="line">    state &lt;= <span class="number">0</span>;</span><br><span class="line">    turn &lt;= <span class="number">0</span>; </span><br><span class="line">    has_house &lt;= <span class="number">20'b0</span>;</span><br><span class="line">    land_owner &lt;= <span class="number">40'b0</span>;</span><br><span class="line"></span><br><span class="line">    move_delay &lt;= <span class="number">24'b0</span>;</span><br><span class="line">    step &lt;= <span class="number">4'b1111</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    rand_delay &lt;= <span class="number">24'b0</span>;</span><br><span class="line">    randing &lt;= <span class="number">4'b0</span>;</span><br><span class="line"></span><br><span class="line">    gpa_delay =<span class="number">24'b0</span>;</span><br><span class="line">    gpa_rand &lt;= <span class="number">4'b1111</span>;</span><br><span class="line"></span><br><span class="line">    show_event &lt;= <span class="number">4'b1111</span>;</span><br><span class="line"></span><br><span class="line">    p1_money &lt;= <span class="number">20'd5000</span>;</span><br><span class="line">    p2_money &lt;= <span class="number">20'd5000</span>;</span><br><span class="line">    p1_gpa &lt;= <span class="number">8'd36</span>;</span><br><span class="line">    p2_gpa &lt;= <span class="number">8'd36</span>;</span><br><span class="line">    p1_salary &lt;= <span class="number">20'd2000</span>;</span><br><span class="line">    p2_salary &lt;= <span class="number">20'd2000</span>;</span><br><span class="line">    <span class="comment">//Every player has 3.6gpa, 5000 money and 2000 salary at the beginning of the game.</span></span><br><span class="line"></span><br><span class="line">    p1_location &lt;= <span class="number">5'b0</span>;</span><br><span class="line">    p2_location &lt;= <span class="number">5'b0</span>;</span><br><span class="line">    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">    p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//GAME</span></span><br><span class="line"><span class="keyword">always</span>@(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> reset)<span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//if reset is 1, then initialize the game again and set the global_state and state to 0</span></span><br><span class="line">        <span class="keyword">if</span>(reset == <span class="number">1</span>)<span class="keyword">begin</span> </span><br><span class="line">            global_state &lt;= <span class="number">0</span>;</span><br><span class="line">            state &lt;= <span class="number">0</span>;</span><br><span class="line">            turn &lt;= <span class="number">0</span>;</span><br><span class="line">            has_house &lt;= <span class="number">20'b0</span>;</span><br><span class="line">            land_owner &lt;= <span class="number">40'b0</span>;</span><br><span class="line"></span><br><span class="line">            move_delay &lt;= <span class="number">24'b0</span>;</span><br><span class="line">            step &lt;= <span class="number">4'b1111</span>;</span><br><span class="line"></span><br><span class="line">            rand_delay &lt;= <span class="number">24'b0</span>;</span><br><span class="line">            randing &lt;= <span class="number">4'b0</span>;</span><br><span class="line"></span><br><span class="line">            gpa_delay &lt;= <span class="number">24'b0</span>;</span><br><span class="line">            gpa_rand &lt;= <span class="number">4'b1111</span>;</span><br><span class="line"></span><br><span class="line">            show_event &lt;= <span class="number">4'b1111</span>;</span><br><span class="line"></span><br><span class="line">            p1_money &lt;= <span class="number">20'd5000</span>;</span><br><span class="line">            p2_money &lt;= <span class="number">20'd5000</span>;</span><br><span class="line">            p1_gpa &lt;= <span class="number">8'd36</span>;</span><br><span class="line">            p2_gpa &lt;= <span class="number">8'd36</span>;</span><br><span class="line">            p1_salary &lt;= <span class="number">20'd2000</span>;</span><br><span class="line">            p2_salary &lt;= <span class="number">20'd2000</span>;</span><br><span class="line">            p1_location &lt;= <span class="number">5'b0</span>;</span><br><span class="line">            p2_location &lt;= <span class="number">5'b0</span>;</span><br><span class="line">            p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">            p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//or else begin the game</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line"></span><br><span class="line">            <span class="comment">//global_state = 0, show the start picture and you need to press "yes" button to begin the game</span></span><br><span class="line">            <span class="keyword">if</span> (global_state == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (yes == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                    global_state &lt;= <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//global_state = 2, show the game over picture, if you want to start a new game, just press the "reset" button</span></span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(global_state == <span class="number">2</span>) <span class="keyword">begin</span></span><br><span class="line">                global_state &lt;= <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//global_state = 1 which represents the game-going state, you can enjoy the game</span></span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">case</span>(state)</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//state = 0, the stand-by state</span></span><br><span class="line">                    <span class="number">3'b000</span>:<span class="keyword">begin</span></span><br><span class="line">                            <span class="comment">//we control all the data in the legal range</span></span><br><span class="line">                            <span class="keyword">if</span> (p1_gpa &gt; <span class="number">8'd50</span>) <span class="keyword">begin</span></span><br><span class="line">                                    p1_gpa &lt;= <span class="number">8'd50</span>;</span><br><span class="line">                            <span class="keyword">end</span> </span><br><span class="line">                            <span class="keyword">if</span> (p2_gpa &gt; <span class="number">8'd50</span>) <span class="keyword">begin</span></span><br><span class="line">                                    p2_gpa &lt;= <span class="number">8'd50</span>;</span><br><span class="line">                            <span class="keyword">end</span> </span><br><span class="line">                            <span class="keyword">if</span> (p1_money &gt; <span class="number">20'd88888</span>) <span class="keyword">begin</span></span><br><span class="line">                                    p1_money &lt;= <span class="number">20'd88888</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">if</span> (p2_money &gt; <span class="number">20'd88888</span>) <span class="keyword">begin</span></span><br><span class="line">                                    p2_money &lt;= <span class="number">20'd88888</span>;</span><br><span class="line">                            <span class="keyword">end</span>     </span><br><span class="line"></span><br><span class="line">                            <span class="comment">//if one's gpa is lower than 1.5 or money lower than 0, then game over, and change the state to 7</span></span><br><span class="line">                            <span class="keyword">if</span> (p1_gpa &lt; <span class="number">8'd15</span> || p2_gpa &lt; <span class="number">8'd15</span> || p1_money &lt; <span class="number">0</span> || p2_money &lt; <span class="number">0</span>||p1_money == <span class="number">0</span> || p2_money == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                                    state &lt;= <span class="number">3'b111</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">//the current player roll the dice to change the state</span></span><br><span class="line">                            <span class="keyword">if</span>(dice == <span class="number">1'b1</span>)<span class="keyword">begin</span></span><br><span class="line">                                    state &lt;= (turn == <span class="number">1'b0</span>) ? <span class="number">3'b001</span> : <span class="number">3'b010</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//state = 1, player1 moves</span></span><br><span class="line">                    <span class="number">3'b001</span>:<span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">//calculate the time inteval</span></span><br><span class="line">                            <span class="keyword">if</span>(step == <span class="number">4'b1111</span>)<span class="keyword">begin</span></span><br><span class="line">                                    step &lt;= rand_num;</span><br><span class="line">                                    rand_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                    randing &lt;= <span class="number">4'b1111</span>;</span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>( randing != <span class="number">0</span> )<span class="keyword">begin</span></span><br><span class="line">                                    <span class="keyword">if</span>(rand_delay != <span class="number">24'hffffff</span>)<span class="keyword">begin</span></span><br><span class="line">                                        rand_delay &lt;= rand_delay + <span class="number">24'h000001</span>;</span><br><span class="line">                                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                        randing &lt;= randing - <span class="number">1</span>;</span><br><span class="line">                                        rand_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                        numberInArduino &lt;= &#123;<span class="number">12'b1100_0001_0000</span>, rand_num &#125;;</span><br><span class="line">                                        <span class="keyword">if</span>(randing == <span class="number">4'b0001</span>)<span class="keyword">begin</span></span><br><span class="line">                                            numberInArduino &lt;= &#123;<span class="number">12'b1100_0001_0000</span>, step &#125;;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                            </span><br><span class="line">                            <span class="comment">//player1 moves</span></span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(move_delay != <span class="number">24'hffffff</span>)  <span class="keyword">begin</span></span><br><span class="line">                                    move_delay &lt;= move_delay + <span class="number">24'h000001</span>;</span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> <span class="comment">//step and p1_location don't refresh in time, so when it comes to judgement, the data should +1.</span></span><br><span class="line">                                    move_delay &lt;= <span class="number">24'h0</span>;</span><br><span class="line">                                    p1_location &lt;= (p1_location + <span class="number">1</span>) % <span class="number">20</span>;</span><br><span class="line">                                    step &lt;= step - <span class="number">1</span>;</span><br><span class="line">                                    <span class="comment">//if player1 come by the origin square, he gets the monthly living expenses</span></span><br><span class="line">                                    <span class="keyword">if</span>(p1_location == <span class="number">5'd19</span> )<span class="keyword">begin</span></span><br><span class="line">                                        p1_money &lt;= p1_money + p1_salary;</span><br><span class="line">                                    <span class="keyword">end</span> </span><br><span class="line">                                    <span class="comment">//when step = 1, the player1 stops and then change game state according to his current position</span></span><br><span class="line">                                    <span class="keyword">if</span>( step == <span class="number">4'b0001</span>)<span class="keyword">begin</span></span><br><span class="line">                                        step &lt;=<span class="number">4'b1111</span>;</span><br><span class="line">                                        <span class="comment">//player1 stays on a red squre</span></span><br><span class="line">                                        <span class="keyword">if</span>(p1_location % <span class="number">5</span> == <span class="number">4</span>)<span class="keyword">begin</span></span><br><span class="line">                                            state &lt;= <span class="number">3'b011</span>; </span><br><span class="line">                                        <span class="comment">//player1 stays on an event square     </span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">3</span> ||p1_location == <span class="number">5</span> || p1_location == <span class="number">8</span> || p1_location == <span class="number">10</span> || p1_location == <span class="number">13</span> ||p1_location == <span class="number">15</span>) <span class="keyword">begin</span></span><br><span class="line">                                            state &lt;= <span class="number">3'b100</span>;     </span><br><span class="line">                                        <span class="comment">//player1 stays on a land square</span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(land_owner[<span class="number">2</span> * ((p1_location + <span class="number">1</span>) % <span class="number">20</span>) + <span class="number">1</span>] == <span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                                            <span class="keyword">if</span> (has_house[(p1_location + <span class="number">1</span>) % <span class="number">20</span>] != <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b101</span>;    </span><br><span class="line">                                            <span class="comment">//decide the next turn by checking the sleep state of both players</span></span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>; <span class="comment">//judge if the game ends or not</span></span><br><span class="line">                                            <span class="keyword">end</span></span><br><span class="line">                                        <span class="comment">//player1 stays on player2's land</span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                            state &lt;= <span class="number">3'b110</span>;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//state = 2, player2 moves</span></span><br><span class="line">                    <span class="number">3'b010</span>:<span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">//calculate the time inteval</span></span><br><span class="line">                            <span class="keyword">if</span>(step == <span class="number">4'b1111</span>)<span class="keyword">begin</span></span><br><span class="line">                                    step &lt;= rand_num;</span><br><span class="line">                                    rand_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                    randing &lt;= <span class="number">4'b1111</span>;</span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>( randing != <span class="number">0</span> )<span class="keyword">begin</span></span><br><span class="line">                                    <span class="keyword">if</span>(rand_delay != <span class="number">24'hffffff</span>)<span class="keyword">begin</span></span><br><span class="line">                                        rand_delay &lt;= rand_delay + <span class="number">24'h000001</span>;</span><br><span class="line">                                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                        randing &lt;= randing - <span class="number">1</span>;</span><br><span class="line">                                        rand_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                        numberInArduino &lt;= &#123;<span class="number">12'b1100_0010_0000</span>,rand_num &#125;;</span><br><span class="line">                                        <span class="keyword">if</span>(randing == <span class="number">4'b0001</span>)<span class="keyword">begin</span></span><br><span class="line">                                            numberInArduino &lt;= &#123;<span class="number">12'b1100_0010_0000</span>, step &#125;;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">//player2 moves</span></span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(move_delay != <span class="number">24'hffffff</span>)  <span class="keyword">begin</span><span class="comment">// p2 move</span></span><br><span class="line">                                    move_delay &lt;= move_delay + <span class="number">24'h000001</span>;</span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> <span class="comment">//step and p2_location don't refresh in time, so when it comes to judgement, the data should +1.</span></span><br><span class="line">                                    move_delay &lt;= <span class="number">24'h0</span>;</span><br><span class="line">                                    p2_location &lt;= (p2_location + <span class="number">1</span>) % <span class="number">20</span>;</span><br><span class="line">                                    step &lt;= step - <span class="number">1</span>;</span><br><span class="line">                                    <span class="comment">//if player2 come by the origin square, he gets the monthly living expenses</span></span><br><span class="line">                                    <span class="keyword">if</span>(p2_location == <span class="number">5'd19</span> )<span class="keyword">begin</span></span><br><span class="line">                                        p2_money &lt;= p2_money + p2_salary;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="comment">//when step = 1, the player2 stops and then change game state according to his current position</span></span><br><span class="line">                                    <span class="keyword">if</span>( step == <span class="number">4'b0001</span>)<span class="keyword">begin</span></span><br><span class="line">                                        step &lt;= <span class="number">4'b1111</span>;</span><br><span class="line">                                        <span class="comment">//player2 stays on a red squre</span></span><br><span class="line">                                        <span class="keyword">if</span>(p2_location % <span class="number">5</span> == <span class="number">4</span>)<span class="keyword">begin</span></span><br><span class="line">                                            state &lt;= <span class="number">3'b011</span>;</span><br><span class="line">                                        <span class="comment">//player2 stays on an event square  </span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">3</span> || p2_location == <span class="number">5</span> || p2_location == <span class="number">8</span> || p2_location == <span class="number">10</span> || p2_location == <span class="number">13</span> ||p2_location == <span class="number">15</span>) <span class="keyword">begin</span></span><br><span class="line">                                            state &lt;= <span class="number">3'b100</span>; </span><br><span class="line">                                        <span class="comment">//player2 stays on a land square</span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(land_owner[<span class="number">2</span> * ((p2_location + <span class="number">1</span>) % <span class="number">20</span>)] == <span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                                            <span class="keyword">if</span> (has_house[(p2_location + <span class="number">1</span>) % <span class="number">20</span>] != <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b101</span>; </span><br><span class="line">                                            <span class="comment">//decide the next turn by checking the sleep state of both players</span></span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>; <span class="comment">//judge if the game ends or not</span></span><br><span class="line">                                            <span class="keyword">end</span></span><br><span class="line">                                        <span class="comment">//player2 stays on player1's land</span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                            state &lt;= <span class="number">3'b110</span>; </span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">//state = 3, executing the event of the red square</span></span><br><span class="line">                    <span class="number">3'b011</span>:<span class="keyword">begin</span></span><br><span class="line">                            <span class="comment">//checking the turn</span></span><br><span class="line">                            <span class="comment">//it's player1's turn</span></span><br><span class="line">                            <span class="keyword">if</span>(turn==<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                                    <span class="keyword">case</span>(p1_location)</span><br><span class="line">                                        <span class="comment">//if position = 0, the palyer gets twice his living expenses (because the pass-by state didn't count)</span></span><br><span class="line">                                        <span class="number">5'd0</span>:  p1_money &lt;= p1_money + <span class="number">2</span> * p1_salary;</span><br><span class="line">                                        <span class="comment">//if position = 5, change the player's sleep state to 1</span></span><br><span class="line">                                        <span class="number">5'd5</span>:  p1_sleep &lt;= <span class="number">1'b1</span>;</span><br><span class="line">                                        <span class="comment">//if position = 10, the player gets scholarship according to his current gpa</span></span><br><span class="line">                                        <span class="number">5'd10</span>: <span class="keyword">begin</span> </span><br><span class="line">                                                <span class="keyword">if</span>(p1_gpa &gt;= <span class="number">8'd36</span> &amp;&amp; p1_gpa &lt; <span class="number">8'd42</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    p1_money &lt;= p1_money + <span class="number">2000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p1_gpa &gt;= <span class="number">8'd42</span> &amp;&amp; p1_gpa &lt; <span class="number">8'd44</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    p1_money &lt;= p1_money + <span class="number">4000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p1_gpa &gt;= <span class="number">8'd44</span> &amp;&amp; p1_gpa &lt; <span class="number">8'd50</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    p1_money &lt;= p1_money + <span class="number">6000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p1_gpa &gt;= <span class="number">8'd46</span> &amp;&amp; p1_gpa &lt; <span class="number">8'd50</span> &amp;&amp; p1_gpa &gt; p2_gpa) <span class="keyword">begin</span></span><br><span class="line">                                                    p1_money &lt;= p1_money + <span class="number">8000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p1_gpa == <span class="number">8'd50</span> ) <span class="keyword">begin</span></span><br><span class="line">                                                    <span class="keyword">if</span> (p1_money &lt; <span class="number">70000</span>) <span class="keyword">begin</span></span><br><span class="line">                                                        p1_money &lt;= p1_money + <span class="number">20000</span>;</span><br><span class="line">                                                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                        p1_money &lt;= <span class="number">88888</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                        <span class="comment">//if position = 15, the player begins his final exam, roll the dice to get his random grade</span></span><br><span class="line">                                        <span class="number">5'd15</span>: </span><br><span class="line">                                            <span class="comment">//to show the rolling numbers</span></span><br><span class="line">                                            <span class="keyword">if</span>(gpa_rand == <span class="number">4'b1111</span>)<span class="keyword">begin</span></span><br><span class="line">                                                gpa_rand &lt;= rand_num;</span><br><span class="line">                                                gpa_delay &lt;= <span class="number">0</span>; </span><br><span class="line">                                                randing &lt;= <span class="number">4'b1111</span>;</span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>( randing != <span class="number">0</span> )<span class="keyword">begin</span></span><br><span class="line">                                                <span class="keyword">if</span>(gpa_delay != <span class="number">24'hffffff</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    gpa_delay &lt;= gpa_delay + <span class="number">24'h000001</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                    randing &lt;= randing - <span class="number">1</span>;</span><br><span class="line">                                                    gpa_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    numberInArduino &lt;=&#123;<span class="number">12'b1100_0001_0000</span>,rand_num&#125;;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(gpa_rand != <span class="number">4'b1110</span>) <span class="keyword">begin</span></span><br><span class="line">                                                numberInArduino &lt;=&#123;<span class="number">12'b1100_0001_0000</span>, gpa_rand&#125;;</span><br><span class="line">                                                p1_gpa &lt;= p1_gpa - <span class="number">3</span> + gpa_rand;</span><br><span class="line">                                                gpa_rand &lt;= <span class="number">4'b1110</span>;</span><br><span class="line">                                                gpa_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                            <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">default</span>: state &lt;= <span class="number">3'b000</span>; <span class="comment">//change to stand-by state</span></span><br><span class="line">                                    <span class="keyword">endcase</span>                   </span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                    <span class="comment">//it's player2's turn</span></span><br><span class="line">                                    <span class="keyword">case</span>(p2_location)</span><br><span class="line">                                        <span class="comment">//if position = 0, the palyer gets twice his living expenses (because the pass-by state didn't count)</span></span><br><span class="line">                                        <span class="number">5'b0</span>:  p2_money &lt;= p2_money + <span class="number">2</span> * p2_salary;</span><br><span class="line">                                        <span class="comment">//if position = 5, change the player's sleep state to 1</span></span><br><span class="line">                                        <span class="number">5'd5</span>:  p2_sleep &lt;= <span class="number">1'b1</span>;</span><br><span class="line">                                        <span class="comment">//if position = 10, the player gets scholarship according to his current gpa</span></span><br><span class="line">                                        <span class="number">5'd10</span>: <span class="keyword">if</span>(p2_gpa &gt;= <span class="number">8'd36</span> &amp;&amp; p2_gpa &lt; <span class="number">8'd42</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    p2_money &lt;= p2_money + <span class="number">2000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p2_gpa &gt;= <span class="number">8'd42</span> &amp;&amp; p2_gpa &lt; <span class="number">8'd44</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    p2_money &lt;= p2_money + <span class="number">4000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p2_gpa &gt;= <span class="number">8'd44</span> &amp;&amp; p2_gpa &lt; <span class="number">8'd50</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    p2_money &lt;= p2_money + <span class="number">6000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p2_gpa &gt;= <span class="number">8'd46</span> &amp;&amp; p2_gpa &lt; <span class="number">8'd50</span> &amp;&amp; p2_gpa &gt; p1_gpa) <span class="keyword">begin</span></span><br><span class="line">                                                    p2_money &lt;= p2_money + <span class="number">8000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (p2_gpa == <span class="number">8'd50</span> ) <span class="keyword">begin</span></span><br><span class="line">                                                    <span class="keyword">if</span> (p2_money &lt; <span class="number">70000</span>) <span class="keyword">begin</span></span><br><span class="line">                                                        p2_money &lt;= p2_money + <span class="number">20000</span>;</span><br><span class="line">                                                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                        p2_money &lt;= <span class="number">88888</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                        <span class="comment">//if position = 15, the player begins his final exam, roll the dice to get his random grade</span></span><br><span class="line">                                        <span class="number">5'd15</span>:</span><br><span class="line">                                                <span class="comment">//to show the rolling numbers</span></span><br><span class="line">                                                <span class="keyword">if</span>(gpa_rand == <span class="number">4'b1111</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    gpa_rand &lt;= rand_num;</span><br><span class="line">                                                    gpa_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    randing &lt;= <span class="number">4'b1111</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>( randing != <span class="number">0</span> )<span class="keyword">begin</span></span><br><span class="line">                                                    <span class="keyword">if</span>(gpa_delay != <span class="number">24'hffffff</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        gpa_delay &lt;= gpa_delay + <span class="number">24'h000001</span>;</span><br><span class="line">                                                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                        randing &lt;= randing - <span class="number">1</span>;</span><br><span class="line">                                                        gpa_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                                        numberInArduino &lt;=&#123;<span class="number">12'b1100_0010_0000</span>,rand_num&#125;;</span><br><span class="line">                                                    <span class="keyword">end</span>    </span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(gpa_rand != <span class="number">4'b1110</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    numberInArduino &lt;=&#123;<span class="number">12'b1100_0010_0000</span>, gpa_rand&#125;;</span><br><span class="line">                                                    p2_gpa &lt;= p2_gpa - <span class="number">3</span> + gpa_rand;</span><br><span class="line">                                                    gpa_rand &lt;= <span class="number">4'b1110</span>;</span><br><span class="line">                                                    gpa_delay &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                        <span class="keyword">default</span>: state &lt;= <span class="number">3'b000</span>;<span class="comment">//change to stand-by state</span></span><br><span class="line">                                    <span class="keyword">endcase</span></span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">//set gpa_rand to its default and decide the next turn by checking the sleep state of both players</span></span><br><span class="line">                            <span class="keyword">if</span>((gpa_rand == <span class="number">4'b1110</span>  || gpa_rand == <span class="number">4'b1111</span> ) &amp;&amp; yes == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                    gpa_rand &lt;= <span class="number">4'b1111</span>;</span><br><span class="line">                                    turn &lt;= ~turn;</span><br><span class="line">                                    <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                        turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                        p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                        turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                        p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    state &lt;= <span class="number">3'b000</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">//state = 4, executing the random event</span></span><br><span class="line">                    <span class="number">3'b100</span>:<span class="keyword">begin</span></span><br><span class="line">                            <span class="comment">//get the random event</span></span><br><span class="line">                            <span class="keyword">if</span>(show_event == <span class="number">4'b1111</span>)<span class="keyword">begin</span></span><br><span class="line">                                show_event &lt;= rand_num;</span><br><span class="line">                                <span class="keyword">if</span>(turn == <span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                                    <span class="keyword">case</span>(rand_num)</span><br><span class="line">                                        <span class="number">4'b0001</span>:p1_gpa &lt;= p1_gpa + <span class="number">3</span>;</span><br><span class="line">                                        <span class="number">4'b0010</span>:p1_gpa &lt;= p1_gpa - <span class="number">3</span>;</span><br><span class="line">                                        <span class="number">4'b0011</span>:<span class="keyword">if</span>(p1_money &gt; <span class="number">3000</span> )<span class="keyword">begin</span></span><br><span class="line">                                                    p1_money &lt;= p1_money - <span class="number">3000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                    p1_money &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span> </span><br><span class="line">                                        <span class="number">4'b0100</span>:p1_money &lt;= p1_money + <span class="number">2000</span>;</span><br><span class="line">                                        <span class="number">4'b0101</span>:p1_salary &lt;= p1_salary + <span class="number">1000</span>;</span><br><span class="line">                                        <span class="number">4'b0110</span>:<span class="keyword">if</span>(p1_salary &gt; <span class="number">1200</span> )<span class="keyword">begin</span></span><br><span class="line">                                                    p1_salary &lt;= p1_salary - <span class="number">1200</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                    p1_salary &lt;= <span class="number">0</span>; </span><br><span class="line">                                                <span class="keyword">end</span> </span><br><span class="line">                                    <span class="keyword">default</span>: show_event &lt;= <span class="number">4'b1111</span>;  </span><br><span class="line">                                    <span class="keyword">endcase</span></span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    <span class="keyword">case</span>(rand_num)</span><br><span class="line">                                        <span class="number">4'b0001</span>:p2_gpa &lt;= p2_gpa + <span class="number">3</span>;</span><br><span class="line">                                        <span class="number">4'b0010</span>:p2_gpa &lt;= p2_gpa - <span class="number">3</span>;</span><br><span class="line">                                        <span class="number">4'b0011</span>:<span class="keyword">if</span>(p2_money &gt; <span class="number">3000</span> )<span class="keyword">begin</span></span><br><span class="line">                                                    p2_money &lt;= p2_money - <span class="number">3000</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                    p2_money &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span> </span><br><span class="line">                                        <span class="number">4'b0100</span>:p2_money &lt;= p2_money + <span class="number">2000</span>;</span><br><span class="line">                                        <span class="number">4'b0101</span>:p2_salary &lt;= p2_salary + <span class="number">1000</span>;</span><br><span class="line">                                        <span class="number">4'b0110</span>:<span class="keyword">if</span>(p2_salary &gt; <span class="number">1200</span> )<span class="keyword">begin</span></span><br><span class="line">                                                    p2_salary &lt;= p2_salary - <span class="number">1200</span>;</span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                    p2_salary &lt;= <span class="number">0</span>; </span><br><span class="line">                                                <span class="keyword">end</span>  </span><br><span class="line">                                    <span class="keyword">default</span>: show_event &lt;= <span class="number">4'b1111</span>;  </span><br><span class="line">                                    <span class="keyword">endcase</span></span><br><span class="line">                                <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line">                            <span class="comment">//press "yes" and decide the next turn by checking the sleep state of both players</span></span><br><span class="line">                            <span class="keyword">if</span> (yes == <span class="number">1</span>)<span class="keyword">begin</span> </span><br><span class="line">                                show_event &lt;= <span class="number">4'b1111</span>;</span><br><span class="line">                                turn &lt;= ~turn;</span><br><span class="line">                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">end</span></span><br><span class="line">                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                        turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                        p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                <span class="keyword">end</span></span><br><span class="line">                                state &lt;= <span class="number">3'b000</span>;</span><br><span class="line">                            <span class="keyword">end</span>    </span><br><span class="line">                        <span class="keyword">end</span> </span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">//state = 5, the player can buy an empty land or build houses on his land to charge higher toll</span></span><br><span class="line">                    <span class="number">3'b101</span>:<span class="keyword">begin</span></span><br><span class="line">                            <span class="keyword">if</span>(turn == <span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                                        <span class="comment">//if the land doesn't belong to anyone yet, the player can choose to buy the land or not</span></span><br><span class="line">                                        <span class="keyword">if</span> (land_owner[<span class="number">2</span> * p1_location] == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                                            <span class="keyword">if</span> (p1_money &lt; <span class="number">1600</span>) <span class="keyword">begin</span> <span class="comment">//if the player's money is less than 1600, then he cannot afford the land</span></span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;=<span class="number">0</span>;</span><br><span class="line">                                                        p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>;</span><br><span class="line">                                            <span class="comment">//press "yes" to buy the land and change the land state</span></span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (yes == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                land_owner[<span class="number">2</span> * p1_location] &lt;= <span class="number">1</span>;</span><br><span class="line">                                                land_owner[<span class="number">2</span> * p1_location + <span class="number">1</span>] &lt;= <span class="number">0</span>;</span><br><span class="line">                                                </span><br><span class="line">                                                p1_money &lt;= p1_money - <span class="number">1600</span>;</span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                        p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>; </span><br><span class="line">                                            <span class="comment">//press "no" and decide the next turn by checking the sleep state of both players   </span></span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (no ==<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>;                                 </span><br><span class="line">                                            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                                        <span class="comment">//if the land belongs to the player, the player can choose to build the house or not</span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                            <span class="keyword">if</span> (p1_money &lt; <span class="number">1200</span>) <span class="keyword">begin</span> <span class="comment">//if the player's money is less than 1200, then he cannot afford the house</span></span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>; </span><br><span class="line">                                            <span class="comment">//press "yes" to build the house and change the house state</span></span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (yes == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                has_house[p1_location] &lt;= <span class="number">1</span>;</span><br><span class="line">                                                p1_money &lt;= p1_money - <span class="number">1200</span>;</span><br><span class="line">                                                </span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>; </span><br><span class="line">                                            <span class="comment">//press "no" and decide the next turn by checking the sleep state of both players      </span></span><br><span class="line">                                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (no ==<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                turn &lt;= ~turn;</span><br><span class="line">                                                <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                        p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                <span class="keyword">end</span></span><br><span class="line">                                                state &lt;= <span class="number">3'b000</span>;                                 </span><br><span class="line">                                            <span class="keyword">end</span>                        </span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                        <span class="comment">//if the land doesn't belong to anyone yet, the player can choose to buy the land or not</span></span><br><span class="line">                                        <span class="keyword">if</span> (land_owner[<span class="number">2</span> * p2_location + <span class="number">1</span>] == <span class="number">0</span>) <span class="keyword">begin</span></span><br><span class="line">                                                <span class="keyword">if</span> (p2_money &lt; <span class="number">1600</span>) <span class="keyword">begin</span><span class="comment">//if the player's money is less than 1600, then he cannot afford the land</span></span><br><span class="line">                                                    turn &lt;= ~turn;</span><br><span class="line">                                                    <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                        p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                            turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                            p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    state &lt;= <span class="number">3'b000</span>; </span><br><span class="line">                                                <span class="comment">//press "yes" to buy the land and change the land state</span></span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (yes == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    land_owner[<span class="number">2</span> * p2_location] &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    land_owner[<span class="number">2</span> * p2_location + <span class="number">1</span>] &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p2_money &lt;= p2_money - <span class="number">1600</span>;</span><br><span class="line">                                                    turn &lt;= ~turn;</span><br><span class="line">                                                    <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                        p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                            turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                            p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    state &lt;= <span class="number">3'b000</span>;  </span><br><span class="line">                                                <span class="comment">//press "no" and decide the next turn by checking the sleep state of both players     </span></span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (no ==<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= ~turn;</span><br><span class="line">                                                    <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                        p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                            turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                            p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    state &lt;= <span class="number">3'b000</span>;</span><br><span class="line">                                                <span class="keyword">end</span>   </span><br><span class="line"></span><br><span class="line">                                        <span class="comment">//if the land belongs to the player, the player can choose to build the house or not                             </span></span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                                <span class="keyword">if</span> (p2_money &lt; <span class="number">1200</span>) <span class="keyword">begin</span> <span class="comment">//if the player's money is less than 1200, then he cannot afford the house</span></span><br><span class="line">                                                    turn &lt;= ~turn;</span><br><span class="line">                                                    <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                        p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                            turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                            p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    state &lt;= <span class="number">3'b000</span>; </span><br><span class="line">                                                <span class="comment">//press "yes" to build the house and change the house state</span></span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (yes == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    has_house[p2_location] &lt;= <span class="number">1</span>;</span><br><span class="line">                                                    p2_money &lt;= p2_money - <span class="number">1200</span>;</span><br><span class="line">                                                    </span><br><span class="line">                                                    turn &lt;= ~turn;</span><br><span class="line">                                                    <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                        p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                            turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                            p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    state &lt;= <span class="number">3'b000</span>; </span><br><span class="line">                                                <span class="comment">//press "no" and decide the next turn by checking the sleep state of both players     </span></span><br><span class="line">                                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (no ==<span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                                    turn &lt;= ~turn;</span><br><span class="line">                                                    <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                        turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                                        p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                                            turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                                            p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                                                    <span class="keyword">end</span></span><br><span class="line">                                                    state &lt;= <span class="number">3'b000</span>;                                 </span><br><span class="line">                                                <span class="keyword">end</span>                        </span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">end</span>                   </span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">//state = 6, the palyer stays on another player's land and needs to pay the toll</span></span><br><span class="line">                    <span class="number">3'b110</span>:<span class="keyword">begin</span></span><br><span class="line">                            <span class="comment">//check the turn to decide which player pays to another</span></span><br><span class="line">                            <span class="keyword">if</span>(turn == <span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                                    <span class="comment">//if there is a house, the price is higher</span></span><br><span class="line">                                    <span class="keyword">if</span> (has_house[p1_location] == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                        <span class="keyword">if</span> (p1_money &lt; <span class="number">4000</span> ) <span class="keyword">begin</span></span><br><span class="line">                                            p1_money &lt;= <span class="number">0</span>;</span><br><span class="line">                                            p2_money &lt;= p2_money + <span class="number">4000</span>;</span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                            p1_money &lt;= p1_money - <span class="number">4000</span>;</span><br><span class="line">                                            p2_money &lt;= p2_money + <span class="number">4000</span>;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                        <span class="keyword">if</span> (p1_gpa &lt; <span class="number">2</span>) <span class="keyword">begin</span></span><br><span class="line">                                            p1_gpa &lt;= <span class="number">0</span>;</span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">                                            p1_gpa &lt;= p1_gpa - <span class="number">2</span>;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="comment">//if there is no house, the price is lower</span></span><br><span class="line">                                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                        <span class="keyword">if</span> (p1_money &lt; <span class="number">2000</span> ) <span class="keyword">begin</span></span><br><span class="line">                                            p1_money &lt;= <span class="number">0</span>;</span><br><span class="line">                                            p2_money &lt;= p2_money + <span class="number">2000</span>; </span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                            p1_money &lt;= p1_money - <span class="number">2000</span>; </span><br><span class="line">                                            p2_money &lt;= p2_money + <span class="number">2000</span>; </span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                                        <span class="keyword">if</span> (p1_gpa &lt; <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                            p1_gpa &lt;= <span class="number">0</span>;</span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">                                            p1_gpa &lt;= p1_gpa - <span class="number">1</span>;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                    <span class="comment">//if there is a house, the price is higher</span></span><br><span class="line">                                    <span class="keyword">if</span> (has_house[p2_location] == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                        <span class="keyword">if</span> (p2_money &lt; <span class="number">4000</span> ) <span class="keyword">begin</span></span><br><span class="line">                                            p2_money &lt;= <span class="number">0</span>;</span><br><span class="line">                                            p1_money &lt;= p1_money + <span class="number">4000</span>; </span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                            p2_money &lt;= p2_money - <span class="number">4000</span>; </span><br><span class="line">                                            p1_money &lt;= p1_money + <span class="number">4000</span>; </span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                                        <span class="keyword">if</span> (p2_gpa &lt; <span class="number">2</span>) <span class="keyword">begin</span></span><br><span class="line">                                            p2_gpa &lt;= <span class="number">0</span>;</span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">                                            p2_gpa &lt;= p2_gpa - <span class="number">2</span>;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="comment">//if there is no house, the price is lower</span></span><br><span class="line">                                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                        <span class="keyword">if</span> (p2_money &lt; <span class="number">2000</span> ) <span class="keyword">begin</span></span><br><span class="line">                                            p2_money &lt;= <span class="number">0</span>;</span><br><span class="line">                                            p1_money &lt;= p1_money + <span class="number">2000</span>; </span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                            p2_money &lt;= p2_money - <span class="number">2000</span>; </span><br><span class="line">                                            p1_money &lt;= p1_money + <span class="number">2000</span>; </span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                        <span class="keyword">if</span> (p2_gpa &lt; <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">                                            p2_gpa &lt;= <span class="number">0</span>;</span><br><span class="line">                                        <span class="keyword">end</span> <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">                                            p2_gpa &lt;= p2_gpa - <span class="number">1</span>;</span><br><span class="line">                                        <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">//decide the next turn by checking the sleep state of both players</span></span><br><span class="line">                            turn &lt;= ~turn;</span><br><span class="line">                            <span class="keyword">if</span>(p1_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                turn &lt;= <span class="number">0</span>;</span><br><span class="line">                                p1_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                            <span class="keyword">if</span>(p2_sleep == <span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                                    turn &lt;= <span class="number">1</span>;</span><br><span class="line">                                    p2_sleep &lt;= <span class="number">0</span>;</span><br><span class="line">                            <span class="keyword">end</span></span><br><span class="line">                            state &lt;= <span class="number">3'b000</span>;</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">//state = 7, change the global_state to 2 and game over</span></span><br><span class="line">                    <span class="number">3'b111</span>:<span class="keyword">begin</span></span><br><span class="line">                        numberInArduino &lt;=<span class="number">16'hffff</span>;</span><br><span class="line">                        global_state &lt;= <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">end</span>     </span><br><span class="line">                    <span class="keyword">default</span>: state &lt;= <span class="number">3'b000</span>;</span><br><span class="line">                    <span class="keyword">endcase</span> </span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//Disp number in SWORD</span></span><br><span class="line">BCD_8 BCD1_gpa(<span class="variable">.binary</span>(p1_gpa),<span class="variable">.bcd</span>(p1_gpa_bcd));</span><br><span class="line">BCD_8 BCD2_gpa(<span class="variable">.binary</span>(p2_gpa),<span class="variable">.bcd</span>(p2_gpa_bcd));</span><br><span class="line">BCD_20 BCD1_money(<span class="variable">.binary</span>(p1_money),<span class="variable">.bcd</span>(p1_money_bcd));</span><br><span class="line">BCD_20 BCD2_money(<span class="variable">.binary</span>(p2_money),<span class="variable">.bcd</span>(p2_money_bcd));</span><br><span class="line"><span class="keyword">assign</span> numberInSWORD = (turn == <span class="number">0</span>) ? &#123;p1_gpa_bcd,<span class="number">4'b0</span>,p1_money_bcd&#125; : &#123;p2_gpa_bcd,<span class="number">4'b0</span>,p2_money_bcd&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//handle ps2 code</span></span><br><span class="line"><span class="keyword">always</span>@(*)<span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (sw_input == <span class="number">1</span>) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (ps2_data_cur[<span class="number">8</span>] == <span class="number">0</span> ) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (ps2_data_cur[<span class="number">7</span>:<span class="number">0</span>] == <span class="number">8'h69</span>) <span class="keyword">begin</span></span><br><span class="line">                dice &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (ps2_data_cur[<span class="number">7</span>:<span class="number">0</span>] == <span class="number">8'h72</span>) <span class="keyword">begin</span></span><br><span class="line">                yes &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (ps2_data_cur[<span class="number">7</span>:<span class="number">0</span>] == <span class="number">8'h7a</span>) <span class="keyword">begin</span></span><br><span class="line">                no &lt;= <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (ps2_data_cur[<span class="number">7</span>:<span class="number">0</span>] == <span class="number">8'h1C</span>) <span class="keyword">begin</span></span><br><span class="line">                dice &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (ps2_data_cur[<span class="number">7</span>:<span class="number">0</span>] == <span class="number">8'h1B</span>) <span class="keyword">begin</span></span><br><span class="line">                yes &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (ps2_data_cur[<span class="number">7</span>:<span class="number">0</span>] == <span class="number">8'h23</span>) <span class="keyword">begin</span></span><br><span class="line">                no &lt;= <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    yes &lt;= <span class="number">0</span>;</span><br><span class="line">                    no &lt;= <span class="number">0</span>;</span><br><span class="line">                    dice &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// case(ps2_data_cur[7:0])</span></span><br><span class="line">            <span class="comment">//     8'h69:dice &lt;= 1;</span></span><br><span class="line">            <span class="comment">//     8'h72:yes &lt;= 1;</span></span><br><span class="line">            <span class="comment">//     8'h7a:no &lt;= 1;</span></span><br><span class="line">            <span class="comment">//     default:begin</span></span><br><span class="line">            <span class="comment">//         yes &lt;= 0;</span></span><br><span class="line">            <span class="comment">//         no &lt;= 0;</span></span><br><span class="line">            <span class="comment">//         dice &lt;= 0;</span></span><br><span class="line">            <span class="comment">//     end</span></span><br><span class="line">            <span class="comment">// endcase</span></span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            yes &lt;= <span class="number">0</span>;</span><br><span class="line">            no &lt;= <span class="number">0</span>;</span><br><span class="line">            dice &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        yes &lt;= yes_AJ;</span><br><span class="line">        no &lt;= no_AJ;</span><br><span class="line">        dice &lt;= dice_AJ;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ROM address </span></span><br><span class="line"><span class="keyword">always</span>@(*) <span class="keyword">begin</span> </span><br><span class="line">    game_over_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    house_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    player1_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    player2_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    event1_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    event2_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    event3_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    event4_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    event5_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">    event6_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    background_data_addr &lt;= (y_pos / <span class="number">2</span> ) * <span class="number">10'd320</span> + (x_pos/<span class="number">2</span>);</span><br><span class="line">    start_data_addr &lt;= (y_pos / <span class="number">2</span> ) * <span class="number">10'd320</span> + (x_pos/<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (global_state == <span class="number">2</span> &amp;&amp; x_pos &gt;= <span class="number">140</span> &amp;&amp; x_pos &lt; <span class="number">500</span> &amp;&amp; y_pos &gt;= <span class="number">210</span> &amp;&amp; y_pos &lt; <span class="number">270</span>) <span class="keyword">begin</span></span><br><span class="line">        game_over_data_addr &lt;= (y_pos - <span class="number">210</span>) * <span class="number">360</span> + (x_pos - <span class="number">140</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (show_event!=<span class="number">4'b1111</span> &amp;&amp; x_pos &gt;= <span class="number">200</span> &amp;&amp; x_pos &lt; <span class="number">440</span> &amp;&amp; y_pos &gt;= <span class="number">150</span> &amp;&amp; y_pos &lt; <span class="number">330</span>) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">case</span> (show_event)</span><br><span class="line">            <span class="number">4'b0001</span>:<span class="keyword">begin</span></span><br><span class="line">                event1_data_addr &lt;= (y_pos - <span class="number">150</span>)/<span class="number">2</span> * <span class="number">120</span> + (x_pos - <span class="number">200</span>)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">4'b0010</span>:<span class="keyword">begin</span></span><br><span class="line">                event2_data_addr &lt;= (y_pos - <span class="number">150</span>)/<span class="number">2</span> * <span class="number">120</span> + (x_pos - <span class="number">200</span>)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">4'b0011</span>:<span class="keyword">begin</span></span><br><span class="line">                event3_data_addr &lt;= (y_pos - <span class="number">150</span>)/<span class="number">2</span> * <span class="number">120</span> + (x_pos - <span class="number">200</span>)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">4'b0100</span>:<span class="keyword">begin</span></span><br><span class="line">                event4_data_addr &lt;= (y_pos - <span class="number">150</span>)/<span class="number">2</span> * <span class="number">120</span> + (x_pos - <span class="number">200</span>)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">4'b0101</span>:<span class="keyword">begin</span></span><br><span class="line">                event5_data_addr &lt;= (y_pos - <span class="number">150</span>)/<span class="number">2</span> * <span class="number">120</span> + (x_pos - <span class="number">200</span>)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">4'b0110</span>:<span class="keyword">begin</span></span><br><span class="line">                event6_data_addr &lt;= (y_pos - <span class="number">150</span>)/<span class="number">2</span> * <span class="number">120</span> + (x_pos - <span class="number">200</span>)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">                    event1_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">                    event2_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">                    event3_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">                    event4_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">                    event5_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">                    event6_data_addr &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">1</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">96</span> &amp;&amp; x_pos &lt; <span class="number">144</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= y_pos * <span class="number">48</span> + (x_pos - <span class="number">96</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">2</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">229</span> &amp;&amp; x_pos &lt; <span class="number">277</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= y_pos * <span class="number">48</span> + (x_pos - <span class="number">229</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">3</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">362</span> &amp;&amp; x_pos &lt; <span class="number">410</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= y_pos * <span class="number">48</span> + (x_pos - <span class="number">362</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">7</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">589</span> &amp;&amp; x_pos &lt; <span class="number">637</span> &amp;&amp; y_pos &gt;= <span class="number">165</span> &amp;&amp; y_pos &lt; <span class="number">213</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= (y_pos - <span class="number">165</span>) * <span class="number">48</span> + (x_pos - <span class="number">589</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">8</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">589</span> &amp;&amp; x_pos &lt; <span class="number">637</span> &amp;&amp; y_pos &gt;= <span class="number">259</span> &amp;&amp; y_pos &lt; <span class="number">307</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= (y_pos - <span class="number">259</span>) * <span class="number">48</span> + (x_pos - <span class="number">589</span>);</span><br><span class="line">    <span class="keyword">end</span>    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">12</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">362</span> &amp;&amp; x_pos &lt; <span class="number">410</span> &amp;&amp; y_pos &gt;= <span class="number">428</span> &amp;&amp; y_pos &lt; <span class="number">476</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= (y_pos - <span class="number">428</span>) * <span class="number">48</span> + (x_pos - <span class="number">362</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">13</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">229</span> &amp;&amp; x_pos &lt; <span class="number">277</span> &amp;&amp;  y_pos &gt;= <span class="number">428</span> &amp;&amp; y_pos &lt; <span class="number">476</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= (y_pos - <span class="number">428</span>) * <span class="number">48</span> + (x_pos - <span class="number">229</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">17</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">3</span> &amp;&amp; x_pos &lt; <span class="number">51</span> &amp;&amp; y_pos &gt;= <span class="number">259</span> &amp;&amp; y_pos &lt; <span class="number">307</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= (y_pos - <span class="number">259</span>) * <span class="number">48</span> + (x_pos - <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">18</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">3</span> &amp;&amp; x_pos &lt; <span class="number">51</span> &amp;&amp; y_pos &gt;= <span class="number">165</span> &amp;&amp; y_pos &lt; <span class="number">213</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= (y_pos - <span class="number">165</span>) * <span class="number">48</span> + (x_pos - <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(has_house[<span class="number">19</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">3</span> &amp;&amp; x_pos &lt; <span class="number">51</span> &amp;&amp; y_pos &gt;= <span class="number">71</span> &amp;&amp; y_pos &lt; <span class="number">119</span>)<span class="keyword">begin</span></span><br><span class="line">        house_data_addr &lt;= (y_pos - <span class="number">71</span>) * <span class="number">48</span> + (x_pos - <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">                </span><br><span class="line">    <span class="keyword">if</span>(p1_location == <span class="number">5'b00000</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00001</span> &amp;&amp; x_pos &gt;= <span class="number">54</span> &amp;&amp; x_pos &lt; <span class="number">102</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">54</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00010</span> &amp;&amp; x_pos &gt;= <span class="number">187</span> &amp;&amp; x_pos &lt; <span class="number">235</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">187</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00011</span> &amp;&amp; x_pos &gt;= <span class="number">320</span> &amp;&amp; x_pos &lt; <span class="number">368</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">320</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00100</span> &amp;&amp; x_pos &gt;= <span class="number">453</span> &amp;&amp; x_pos &lt; <span class="number">501</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">453</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00101</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00110</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">48</span> &amp;&amp; y_pos &lt; <span class="number">96</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">48</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00111</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">142</span> &amp;&amp; y_pos &lt; <span class="number">190</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">142</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01000</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">236</span> &amp;&amp; y_pos &lt; <span class="number">284</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">236</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01001</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">330</span> &amp;&amp; y_pos &lt; <span class="number">378</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">330</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01010</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01011</span> &amp;&amp; x_pos &gt;= <span class="number">453</span> &amp;&amp; x_pos &lt; <span class="number">501</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">453</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01100</span> &amp;&amp; x_pos &gt;= <span class="number">320</span> &amp;&amp; x_pos &lt; <span class="number">368</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">320</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01101</span> &amp;&amp; x_pos &gt;= <span class="number">187</span> &amp;&amp; x_pos &lt; <span class="number">235</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">187</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01110</span> &amp;&amp; x_pos &gt;= <span class="number">54</span> &amp;&amp; x_pos &lt; <span class="number">102</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">54</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01111</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10000</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">330</span> &amp;&amp; y_pos &lt; <span class="number">378</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">330</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10001</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">236</span> &amp;&amp; y_pos &lt; <span class="number">284</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">236</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10010</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">142</span> &amp;&amp; y_pos &lt; <span class="number">190</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">142</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10011</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">48</span> &amp;&amp; y_pos &lt; <span class="number">96</span>) <span class="keyword">begin</span></span><br><span class="line">        player1_data_addr &lt;= (y_pos - <span class="number">48</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span>            </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(p2_location == <span class="number">5'b00000</span> &amp;&amp; x_pos &gt;= <span class="number">6</span> &amp;&amp; x_pos &lt; <span class="number">54</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">6</span>);    </span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00001</span> &amp;&amp; x_pos &gt;= <span class="number">139</span> &amp;&amp; x_pos &lt; <span class="number">187</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">139</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00010</span> &amp;&amp; x_pos &gt;= <span class="number">272</span> &amp;&amp; x_pos &lt; <span class="number">320</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">320</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00011</span> &amp;&amp; x_pos &gt;= <span class="number">405</span> &amp;&amp; x_pos &lt; <span class="number">453</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">405</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00100</span> &amp;&amp; x_pos &gt;= <span class="number">538</span> &amp;&amp; x_pos &lt; <span class="number">586</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">538</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00101</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">0</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00110</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">94</span> &amp;&amp; y_pos &lt; <span class="number">142</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">94</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00111</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">188</span> &amp;&amp; y_pos &lt; <span class="number">236</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">188</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01000</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">282</span> &amp;&amp; y_pos &lt; <span class="number">330</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">282</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01001</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">376</span> &amp;&amp; y_pos &lt; <span class="number">424</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">376</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01010</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">586</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01011</span> &amp;&amp; x_pos &gt;= <span class="number">538</span> &amp;&amp; x_pos &lt; <span class="number">586</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">538</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01100</span> &amp;&amp; x_pos &gt;= <span class="number">405</span> &amp;&amp; x_pos &lt; <span class="number">453</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">405</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01101</span> &amp;&amp; x_pos &gt;= <span class="number">272</span> &amp;&amp; x_pos &lt; <span class="number">320</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">272</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01110</span> &amp;&amp; x_pos &gt;= <span class="number">139</span> &amp;&amp; x_pos &lt; <span class="number">187</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">139</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01111</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">424</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10000</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">376</span> &amp;&amp; y_pos &lt; <span class="number">424</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">376</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10001</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">282</span> &amp;&amp; y_pos &lt; <span class="number">330</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">282</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10010</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">188</span> &amp;&amp; y_pos &lt; <span class="number">236</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">188</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10011</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">94</span> &amp;&amp; y_pos &lt; <span class="number">142</span>) <span class="keyword">begin</span></span><br><span class="line">            player2_data_addr &lt;= (y_pos - <span class="number">94</span>) * <span class="number">48</span>+(x_pos - <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span>   </span><br><span class="line">    </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//choose display data</span></span><br><span class="line"><span class="keyword">always</span>@(*) <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!VGA_rdn &amp;&amp; (x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">640</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">480</span>) ) <span class="keyword">begin</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">case</span>(global_state)</span><br><span class="line">            <span class="number">3'b000</span>:<span class="keyword">begin</span>    </span><br><span class="line">                display_data &lt;= start_data;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="number">3'b001</span>:<span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span>(p1_location == <span class="number">5'b00000</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00001</span> &amp;&amp; x_pos &gt;= <span class="number">54</span> &amp;&amp; x_pos &lt; <span class="number">102</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00010</span> &amp;&amp; x_pos &gt;= <span class="number">187</span> &amp;&amp; x_pos &lt; <span class="number">235</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00011</span> &amp;&amp; x_pos &gt;= <span class="number">320</span> &amp;&amp; x_pos &lt; <span class="number">368</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00100</span> &amp;&amp; x_pos &gt;= <span class="number">453</span> &amp;&amp; x_pos &lt; <span class="number">501</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00101</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span>                         </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00110</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">48</span> &amp;&amp; y_pos &lt; <span class="number">96</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b00111</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">142</span> &amp;&amp; y_pos &lt; <span class="number">190</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01000</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">236</span> &amp;&amp; y_pos &lt; <span class="number">284</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01001</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">330</span> &amp;&amp; y_pos &lt; <span class="number">378</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01010</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01011</span> &amp;&amp; x_pos &gt;= <span class="number">453</span> &amp;&amp; x_pos &lt; <span class="number">501</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01100</span> &amp;&amp; x_pos &gt;= <span class="number">320</span> &amp;&amp; x_pos &lt; <span class="number">368</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01101</span> &amp;&amp; x_pos &gt;= <span class="number">187</span> &amp;&amp; x_pos &lt; <span class="number">235</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01110</span> &amp;&amp; x_pos &gt;= <span class="number">54</span> &amp;&amp; x_pos &lt; <span class="number">102</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span>                                                                                                                                                                                          </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b01111</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10000</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">330</span> &amp;&amp; y_pos &lt; <span class="number">378</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10001</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">236</span> &amp;&amp; y_pos &lt; <span class="number">284</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10010</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">142</span> &amp;&amp; y_pos &lt; <span class="number">190</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p1_location == <span class="number">5'b10011</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">48</span> &amp;&amp; y_pos &lt; <span class="number">96</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player1_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player1_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                                </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00000</span> &amp;&amp; x_pos &gt;= <span class="number">6</span> &amp;&amp; x_pos &lt; <span class="number">54</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00001</span> &amp;&amp; x_pos &gt;= <span class="number">139</span> &amp;&amp; x_pos &lt; <span class="number">187</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00010</span> &amp;&amp; x_pos &gt;= <span class="number">272</span> &amp;&amp; x_pos &lt; <span class="number">320</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00011</span> &amp;&amp; x_pos &gt;= <span class="number">405</span> &amp;&amp; x_pos &lt; <span class="number">453</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00100</span> &amp;&amp; x_pos &gt;= <span class="number">538</span> &amp;&amp; x_pos &lt; <span class="number">586</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00101</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span>                       </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00110</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">94</span> &amp;&amp; y_pos &lt; <span class="number">142</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b00111</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">188</span> &amp;&amp; y_pos &lt; <span class="number">236</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01000</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">282</span> &amp;&amp; y_pos &lt; <span class="number">330</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01001</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">376</span> &amp;&amp; y_pos &lt; <span class="number">424</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01010</span> &amp;&amp; x_pos &gt;= <span class="number">586</span> &amp;&amp; x_pos &lt; <span class="number">634</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01011</span> &amp;&amp; x_pos &gt;= <span class="number">538</span> &amp;&amp; x_pos &lt; <span class="number">586</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01100</span> &amp;&amp; x_pos &gt;= <span class="number">405</span> &amp;&amp; x_pos &lt; <span class="number">453</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01101</span> &amp;&amp; x_pos &gt;= <span class="number">272</span> &amp;&amp; x_pos &lt; <span class="number">320</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01110</span> &amp;&amp; x_pos &gt;= <span class="number">139</span> &amp;&amp; x_pos &lt; <span class="number">187</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span>                                                                                                                                                                                        </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b01111</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">424</span> &amp;&amp; y_pos &lt; <span class="number">472</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10000</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">376</span> &amp;&amp; y_pos &lt; <span class="number">424</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10001</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">282</span> &amp;&amp; y_pos &lt; <span class="number">330</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10010</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">188</span> &amp;&amp; y_pos &lt; <span class="number">236</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(p2_location == <span class="number">5'b10011</span> &amp;&amp; x_pos &gt;= <span class="number">0</span> &amp;&amp; x_pos &lt; <span class="number">48</span> &amp;&amp; y_pos &gt;= <span class="number">94</span> &amp;&amp; y_pos &lt; <span class="number">142</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(player2_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= player2_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span>  </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">1</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">96</span> &amp;&amp; x_pos &lt; <span class="number">144</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)                <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span>                        </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">2</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">229</span> &amp;&amp; x_pos &lt; <span class="number">277</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)      <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">3</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">362</span> &amp;&amp; x_pos &lt; <span class="number">410</span> &amp;&amp; y_pos &gt;= <span class="number">0</span> &amp;&amp; y_pos &lt; <span class="number">48</span>)      <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">7</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">589</span> &amp;&amp; x_pos &lt; <span class="number">637</span> &amp;&amp; y_pos &gt;= <span class="number">165</span> &amp;&amp; y_pos &lt; <span class="number">213</span>)   <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">8</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">589</span> &amp;&amp; x_pos &lt; <span class="number">637</span> &amp;&amp; y_pos &gt;= <span class="number">259</span> &amp;&amp; y_pos &lt; <span class="number">307</span>)   <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">12</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">362</span> &amp;&amp; x_pos &lt; <span class="number">410</span> &amp;&amp; y_pos &gt;= <span class="number">428</span> &amp;&amp; y_pos &lt; <span class="number">476</span>)   <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">13</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">229</span> &amp;&amp; x_pos &lt; <span class="number">277</span> &amp;&amp;  y_pos &gt;= <span class="number">428</span> &amp;&amp; y_pos &lt; <span class="number">476</span>)  <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">17</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">3</span> &amp;&amp; x_pos &lt; <span class="number">51</span> &amp;&amp; y_pos &gt;= <span class="number">259</span> &amp;&amp; y_pos &lt; <span class="number">307</span>)      <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">18</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">3</span> &amp;&amp; x_pos &lt; <span class="number">51</span> &amp;&amp; y_pos &gt;= <span class="number">165</span> &amp;&amp; y_pos &lt; <span class="number">213</span>)      <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span>(has_house[<span class="number">19</span>] == <span class="number">1</span> &amp;&amp; x_pos &gt;= <span class="number">3</span> &amp;&amp; x_pos &lt; <span class="number">51</span> &amp;&amp; y_pos &gt;= <span class="number">71</span> &amp;&amp; y_pos &lt; <span class="number">119</span>)       <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">if</span>(house_data != <span class="number">12'hfff</span>)<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= house_data;</span><br><span class="line">                                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">                                    display_data &lt;= background_data;</span><br><span class="line">                                <span class="keyword">end</span> </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">2</span>]||land_owner[<span class="number">3</span>])&amp;&amp;( (x_pos - <span class="number">120</span>)*(x_pos - <span class="number">120</span>) + (y_pos - <span class="number">58</span>)*(y_pos - <span class="number">58</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">2</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;</span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">4</span>]||land_owner[<span class="number">5</span>])&amp;&amp;( (x_pos - <span class="number">253</span>)*(x_pos - <span class="number">253</span>) + (y_pos - <span class="number">58</span>)*(y_pos - <span class="number">58</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">4</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;                                </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">6</span>]||land_owner[<span class="number">7</span>])&amp;&amp;( (x_pos - <span class="number">373</span>)*(x_pos - <span class="number">373</span>) + (y_pos - <span class="number">58</span>)*(y_pos - <span class="number">58</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">6</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;</span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">14</span>]||land_owner[<span class="number">15</span>])&amp;&amp;( (x_pos - <span class="number">576</span>)*(x_pos - <span class="number">576</span>) + (y_pos - <span class="number">189</span>)*(y_pos - <span class="number">189</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">14</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;</span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">16</span>]||land_owner[<span class="number">17</span>])&amp;&amp;( (x_pos - <span class="number">576</span>)*(x_pos - <span class="number">576</span>) + (y_pos - <span class="number">283</span>)*(y_pos - <span class="number">283</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">16</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;                        </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">24</span>]||land_owner[<span class="number">25</span>])&amp;&amp;( (x_pos - <span class="number">373</span>)*(x_pos - <span class="number">373</span>) + (y_pos - <span class="number">414</span>)*(y_pos - <span class="number">414</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">24</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;                        </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">26</span>]||land_owner[<span class="number">27</span>])&amp;&amp;( (x_pos - <span class="number">253</span>)*(x_pos - <span class="number">253</span>) + (y_pos - <span class="number">414</span>)*(y_pos - <span class="number">414</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">26</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;                               </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">34</span>]||land_owner[<span class="number">35</span>])&amp;&amp;( (x_pos - <span class="number">64</span>)*(x_pos - <span class="number">64</span>) + (y_pos - <span class="number">283</span>)*(y_pos - <span class="number">283</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">34</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;</span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">36</span>]||land_owner[<span class="number">37</span>])&amp;&amp;( (x_pos - <span class="number">64</span>)*(x_pos - <span class="number">64</span>) + (y_pos - <span class="number">189</span>)*(y_pos - <span class="number">189</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">36</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;          </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> ((land_owner[<span class="number">38</span>]||land_owner[<span class="number">39</span>])&amp;&amp;( (x_pos - <span class="number">64</span>)*(x_pos - <span class="number">64</span>) + (y_pos - <span class="number">95</span>)*(y_pos - <span class="number">95</span>) &lt; <span class="number">30</span>))<span class="keyword">begin</span></span><br><span class="line">                                    display_data &lt;= land_owner[<span class="number">38</span>]==<span class="number">1</span> ? <span class="number">12'hf0f</span> : <span class="number">12'hfff</span>;   </span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (show_event!=<span class="number">4'b1111</span> &amp;&amp; x_pos &gt;= <span class="number">200</span> &amp;&amp; x_pos &lt; <span class="number">440</span> &amp;&amp; y_pos &gt;= <span class="number">150</span> &amp;&amp; y_pos &lt; <span class="number">330</span>) <span class="keyword">begin</span></span><br><span class="line">                                <span class="keyword">case</span> (show_event)</span><br><span class="line">                                    <span class="number">4'b0001</span>:<span class="keyword">begin</span></span><br><span class="line">                                            display_data &lt;= event1_data;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="number">4'b0010</span>:<span class="keyword">begin</span></span><br><span class="line">                                            display_data &lt;= event2_data;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="number">4'b0011</span>:<span class="keyword">begin</span></span><br><span class="line">                                            display_data &lt;= event3_data;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="number">4'b0100</span>:<span class="keyword">begin</span></span><br><span class="line">                                            display_data &lt;= event4_data;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="number">4'b0101</span>:<span class="keyword">begin</span></span><br><span class="line">                                            display_data &lt;= event5_data;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="number">4'b0110</span>:<span class="keyword">begin</span></span><br><span class="line">                                            display_data &lt;= event6_data;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                    <span class="keyword">default</span>: <span class="keyword">begin</span></span><br><span class="line">                                            display_data &lt;= background_data;</span><br><span class="line">                                    <span class="keyword">end</span></span><br><span class="line">                                <span class="keyword">endcase</span></span><br><span class="line">                    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                                display_data &lt;= background_data;</span><br><span class="line">                    <span class="keyword">end</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">end</span>    </span><br><span class="line">            <span class="number">3'b010</span>:<span class="keyword">begin</span>    </span><br><span class="line">                <span class="keyword">if</span> (x_pos &gt;= <span class="number">140</span> &amp;&amp; x_pos &lt; <span class="number">500</span> &amp;&amp; y_pos &gt;= <span class="number">210</span> &amp;&amp; y_pos &lt; <span class="number">270</span>) <span class="keyword">begin</span></span><br><span class="line">                    display_data &lt;= game_over_data;</span><br><span class="line">                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    display_data &lt;= <span class="number">12'b0</span>;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">default</span>:display_data &lt;= <span class="number">12'b0</span>;</span><br><span class="line">        <span class="keyword">endcase</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        display_data &lt;= <span class="number">12'b0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><p>###二、VGA模块</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> vgac (vga_clk,clrn,d_in,row_addr,col_addr,rdn,r,g,b,hs,vs); <span class="comment">// vgac</span></span><br><span class="line">   <span class="keyword">input</span>     [<span class="number">11</span>:<span class="number">0</span>] d_in;     <span class="comment">// bbbb_gggg_rrrr, pixel</span></span><br><span class="line">   <span class="keyword">input</span>            vga_clk;  <span class="comment">// 25MHz</span></span><br><span class="line">   <span class="keyword">input</span>            clrn;</span><br><span class="line">   <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">8</span>:<span class="number">0</span>] row_addr; <span class="comment">// pixel ram row address, 480 (512) lines</span></span><br><span class="line">   <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] col_addr; <span class="comment">// pixel ram col address, 640 (1024) pixels</span></span><br><span class="line">   <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] r,g,b; <span class="comment">// red, green, blue colors</span></span><br><span class="line">   <span class="keyword">output</span> <span class="keyword">reg</span>       rdn;      <span class="comment">// read pixel RAM (active_low)</span></span><br><span class="line">   <span class="keyword">output</span> <span class="keyword">reg</span>       hs,vs;    <span class="comment">// horizontal and vertical synchronization</span></span><br><span class="line">   <span class="comment">// h_count: VGA horizontal counter (0-799)</span></span><br><span class="line">   <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] h_count; <span class="comment">// VGA horizontal counter (0-799): pixels</span></span><br><span class="line">   <span class="keyword">always</span> @ (<span class="keyword">posedge</span> vga_clk) <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">if</span> (!clrn) <span class="keyword">begin</span></span><br><span class="line">           h_count &lt;= <span class="number">10'h0</span>;</span><br><span class="line">       <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (h_count == <span class="number">10'd799</span>) <span class="keyword">begin</span></span><br><span class="line">           h_count &lt;= <span class="number">10'h0</span>;</span><br><span class="line">       <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">           h_count &lt;= h_count + <span class="number">10'h1</span>;</span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">   <span class="comment">// v_count: VGA vertical counter (0-524)</span></span><br><span class="line">   <span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] v_count; <span class="comment">// VGA vertical   counter (0-524): lines</span></span><br><span class="line">   <span class="keyword">always</span> @ (<span class="keyword">posedge</span> vga_clk <span class="keyword">or</span> <span class="keyword">negedge</span> clrn) <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">if</span> (!clrn) <span class="keyword">begin</span></span><br><span class="line">           v_count &lt;= <span class="number">10'h0</span>;</span><br><span class="line">       <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> (h_count == <span class="number">10'd799</span>) <span class="keyword">begin</span></span><br><span class="line">           <span class="keyword">if</span> (v_count == <span class="number">10'd524</span>) <span class="keyword">begin</span></span><br><span class="line">               v_count &lt;= <span class="number">10'h0</span>;</span><br><span class="line">           <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">               v_count &lt;= v_count + <span class="number">10'h1</span>;</span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">    <span class="comment">// signals, will be latched for outputs</span></span><br><span class="line">    <span class="keyword">wire</span>  [<span class="number">9</span>:<span class="number">0</span>] row    =  v_count - <span class="number">10'd35</span>;     <span class="comment">// pixel ram row addr </span></span><br><span class="line">    <span class="keyword">wire</span>  [<span class="number">9</span>:<span class="number">0</span>] col    =  h_count - <span class="number">10'd143</span>;    <span class="comment">// pixel ram col addr </span></span><br><span class="line">    <span class="keyword">wire</span>        h_sync = (h_count &gt; <span class="number">10'd95</span>);    <span class="comment">//  96 -&gt; 799</span></span><br><span class="line">    <span class="keyword">wire</span>        v_sync = (v_count &gt; <span class="number">10'd1</span>);     <span class="comment">//   2 -&gt; 524</span></span><br><span class="line">    <span class="keyword">wire</span>        read   = (h_count &gt; <span class="number">10'd142</span>) &amp;&amp; <span class="comment">// 143 -&gt; 782</span></span><br><span class="line">                         (h_count &lt; <span class="number">10'd783</span>) &amp;&amp; <span class="comment">//        640 pixels</span></span><br><span class="line">                         (v_count &gt; <span class="number">10'd34</span>)  &amp;&amp; <span class="comment">//  35 -&gt; 514</span></span><br><span class="line">                         (v_count &lt; <span class="number">10'd515</span>);   <span class="comment">//        480 lines</span></span><br><span class="line">    <span class="comment">// vga signals</span></span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> vga_clk) <span class="keyword">begin</span></span><br><span class="line">        row_addr &lt;=  row[<span class="number">8</span>:<span class="number">0</span>]; <span class="comment">// pixel ram row address</span></span><br><span class="line">        col_addr &lt;=  col;      <span class="comment">// pixel ram col address</span></span><br><span class="line">        rdn      &lt;= ~read;     <span class="comment">// read pixel (active low)</span></span><br><span class="line">        hs       &lt;=  h_sync;   <span class="comment">// horizontal synchronization</span></span><br><span class="line">        vs       &lt;=  v_sync;   <span class="comment">// vertical   synchronization</span></span><br><span class="line">        r        &lt;=  rdn ? <span class="number">4'h0</span> : d_in[<span class="number">3</span>:<span class="number">0</span>]; <span class="comment">// 3-bit red</span></span><br><span class="line">        g        &lt;=  rdn ? <span class="number">4'h0</span> : d_in[<span class="number">7</span>:<span class="number">4</span>]; <span class="comment">// 3-bit green</span></span><br><span class="line">        b        &lt;=  rdn ? <span class="number">4'h0</span> : d_in[<span class="number">11</span>:<span class="number">8</span>]; <span class="comment">// 2-bit blue</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="三、PS-2模块"><a href="#三、PS-2模块" class="headerlink" title="三、PS/2模块"></a>三、PS/2模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> ps2_keyboard(<span class="keyword">input</span> clk,</span><br><span class="line">                <span class="keyword">input</span> rst,</span><br><span class="line">                <span class="keyword">input</span> ps2_clk,</span><br><span class="line">                <span class="keyword">input</span> ps2_data,</span><br><span class="line">                <span class="keyword">output</span> [<span class="number">9</span>:<span class="number">0</span>] data_out,</span><br><span class="line">                <span class="keyword">output</span> ready);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"> <span class="keyword">reg</span> ps2_clk_flag0, ps2_clk_flag1, ps2_clk_flag2;</span><br><span class="line"><span class="keyword">wire</span> negedge_ps2_clk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst)<span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(rst)<span class="keyword">begin</span></span><br><span class="line">ps2_clk_flag0 &lt;= <span class="number">1'b0</span>;</span><br><span class="line">ps2_clk_flag1 &lt;= <span class="number">1'b0</span>;</span><br><span class="line">ps2_clk_flag2 &lt;= <span class="number">1'b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">ps2_clk_flag0 &lt;= ps2_clk;</span><br><span class="line">ps2_clk_flag1 &lt;= ps2_clk_flag0;</span><br><span class="line">ps2_clk_flag2 &lt;= ps2_clk_flag1;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> negedge_ps2_clk = !ps2_clk_flag1 &amp; ps2_clk_flag2;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] num;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst)<span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(rst)</span><br><span class="line">num &lt;= <span class="number">4'd0</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(num==<span class="number">4'd11</span>)</span><br><span class="line">num &lt;= <span class="number">4'd0</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(negedge_ps2_clk)</span><br><span class="line">num &lt;= num + <span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> negedge_ps2_clk_shift;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">negedge_ps2_clk_shift &lt;= negedge_ps2_clk;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] temp_data;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst) <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span> (rst) <span class="keyword">begin</span></span><br><span class="line">temp_data &lt;= <span class="number">8'd0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (negedge_ps2_clk_shift) <span class="keyword">begin</span>    <span class="comment">// receive data</span></span><br><span class="line"><span class="keyword">case</span>(num)</span><br><span class="line"><span class="number">4'd2</span>: temp_data[<span class="number">0</span>] &lt;= ps2_data;</span><br><span class="line"><span class="number">4'd3</span>: temp_data[<span class="number">1</span>] &lt;= ps2_data;</span><br><span class="line"><span class="number">4'd4</span>: temp_data[<span class="number">2</span>] &lt;= ps2_data;</span><br><span class="line"><span class="number">4'd5</span>: temp_data[<span class="number">3</span>] &lt;= ps2_data;</span><br><span class="line"><span class="number">4'd6</span>: temp_data[<span class="number">4</span>] &lt;= ps2_data;</span><br><span class="line"><span class="number">4'd7</span>: temp_data[<span class="number">5</span>] &lt;= ps2_data;</span><br><span class="line"><span class="number">4'd8</span>: temp_data[<span class="number">6</span>] &lt;= ps2_data;</span><br><span class="line"><span class="number">4'd9</span>: temp_data[<span class="number">7</span>] &lt;= ps2_data;</span><br><span class="line"><span class="keyword">default</span>: temp_data &lt;= temp_data;</span><br><span class="line"><span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">temp_data &lt;= temp_data;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">reg</span> data_break, data_done, data_expand;</span><br><span class="line"><span class="keyword">reg</span> [<span class="number">9</span>:<span class="number">0</span>] data;</span><br><span class="line"><span class="keyword">always</span> @(<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst) <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span> (rst) <span class="keyword">begin</span></span><br><span class="line">data_break &lt;= <span class="number">1'b0</span>;</span><br><span class="line">data &lt;= <span class="number">10'b0</span>;</span><br><span class="line">data_done &lt;= <span class="number">1'b0</span>;</span><br><span class="line">data_expand &lt;= <span class="number">1'b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (num == <span class="number">4'd11</span>) <span class="keyword">begin</span></span><br><span class="line"><span class="keyword">if</span>(temp_data == <span class="number">8'hE0</span>)</span><br><span class="line">data_expand &lt;= <span class="number">1'b1</span>;<span class="comment">// keyboard expand</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (temp_data == <span class="number">8'hF0</span>)</span><br><span class="line">data_break &lt;= <span class="number">1'b1</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">data &lt;= &#123;data_expand, data_break, temp_data&#125;;</span><br><span class="line">data_done &lt;= <span class="number">1'b1</span>;</span><br><span class="line">data_expand &lt;= <span class="number">1'b0</span>;</span><br><span class="line">data_break &lt;= <span class="number">1'b0</span>;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span> </span><br><span class="line"><span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">data &lt;= data;</span><br><span class="line">data_done &lt;= <span class="number">1'b0</span>;</span><br><span class="line">data_expand &lt;= data_expand;</span><br><span class="line">data_break &lt;= data_break;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> data_out = data;</span><br><span class="line"><span class="keyword">assign</span> ready = data_done;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="四、DispNumber模块"><a href="#四、DispNumber模块" class="headerlink" title="四、DispNumber模块"></a>四、DispNumber模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyMC14495 begin</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> MyMC14495(D0,</span><br><span class="line">                 D1,</span><br><span class="line">                 D2,</span><br><span class="line">                 D3,</span><br><span class="line">                 LE,</span><br><span class="line">                 point,</span><br><span class="line">                 a,</span><br><span class="line">                 b,</span><br><span class="line">                 c,</span><br><span class="line">                 d,</span><br><span class="line">                 e,</span><br><span class="line">                 f,</span><br><span class="line">                 g,</span><br><span class="line">                 p);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">input</span> D0;</span><br><span class="line">    <span class="keyword">input</span> D1;</span><br><span class="line">    <span class="keyword">input</span> D2;</span><br><span class="line">    <span class="keyword">input</span> D3;</span><br><span class="line">    <span class="keyword">input</span> LE;</span><br><span class="line">    <span class="keyword">input</span> point;</span><br><span class="line">    <span class="keyword">output</span> a;</span><br><span class="line">    <span class="keyword">output</span> b;</span><br><span class="line">    <span class="keyword">output</span> c;</span><br><span class="line">    <span class="keyword">output</span> d;</span><br><span class="line">    <span class="keyword">output</span> e;</span><br><span class="line">    <span class="keyword">output</span> f;</span><br><span class="line">    <span class="keyword">output</span> g;</span><br><span class="line">    <span class="keyword">output</span> p;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">wire</span> XLXN_16;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_17;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_18;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_19;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_20;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_21;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_22;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_31;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_32;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_34;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_35;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_36;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_38;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_41;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_42;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_45;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_48;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_49;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_51;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_53;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_64;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_193;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_241;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_245;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_254;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_261;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_262;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_267;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_274;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_277;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_278;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_279;</span><br><span class="line">    </span><br><span class="line">    AND4  AD0 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_31));</span><br><span class="line">    AND4  AD1 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_32));</span><br><span class="line">    AND3  AD2 (<span class="variable">.I0</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_64));</span><br><span class="line">    AND3  AD3 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_34));</span><br><span class="line">    AND3  AD4 (<span class="variable">.I0</span>(D1),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_35));</span><br><span class="line">    AND3  AD5 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_36));</span><br><span class="line">    AND3  AD6 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_38));</span><br><span class="line">    AND3  AD7 (<span class="variable">.I0</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I1</span>(D2),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_193));</span><br><span class="line">    AND2  AD8 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_245));</span><br><span class="line">    AND4  AD9 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_41));</span><br><span class="line">    AND3  AD10 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_42));</span><br><span class="line">    AND3  AD11 (<span class="variable">.I0</span>(D1),</span><br><span class="line">    <span class="variable">.I1</span>(D2),</span><br><span class="line">    <span class="variable">.I2</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_45));</span><br><span class="line">    AND4  AD12 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_241));</span><br><span class="line">    AND3  AD13 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_48));</span><br><span class="line">    AND3  AD14 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D2),</span><br><span class="line">    <span class="variable">.I2</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_49));</span><br><span class="line">    AND3  AD15 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_254));</span><br><span class="line">    AND4  AD16 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_51));</span><br><span class="line">    AND4  AD17 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_53));</span><br><span class="line">    AND4  AD18 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_262));</span><br><span class="line">    AND4  AD19 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_267));</span><br><span class="line">    AND4  AD20 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_261));</span><br><span class="line">    OR2  XLXI_1 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_16),</span><br><span class="line">    <span class="variable">.O</span>(g));</span><br><span class="line">    OR2  XLXI_2 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_17),</span><br><span class="line">    <span class="variable">.O</span>(f));</span><br><span class="line">    OR2  XLXI_3 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_18),</span><br><span class="line">    <span class="variable">.O</span>(e));</span><br><span class="line">    OR2  XLXI_4 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_19),</span><br><span class="line">    <span class="variable">.O</span>(d));</span><br><span class="line">    OR2  XLXI_5 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_20),</span><br><span class="line">    <span class="variable">.O</span>(c));</span><br><span class="line">    OR2  XLXI_6 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_21),</span><br><span class="line">    <span class="variable">.O</span>(b));</span><br><span class="line">    OR2  XLXI_8 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_22),</span><br><span class="line">    <span class="variable">.O</span>(a));</span><br><span class="line">    OR3  XLXI_15 (<span class="variable">.I0</span>(XLXN_31),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_32),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_64),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_16));</span><br><span class="line">    OR3  XLXI_16 (<span class="variable">.I0</span>(XLXN_38),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_193),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_245),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_18));</span><br><span class="line">    OR3  XLXI_17 (<span class="variable">.I0</span>(XLXN_45),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_241),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_49),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_20));</span><br><span class="line">    OR4  XLXI_18 (<span class="variable">.I0</span>(XLXN_34),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_35),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_36),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_262),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_17));</span><br><span class="line">    OR4  XLXI_19 (<span class="variable">.I0</span>(XLXN_41),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_42),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_267),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_261),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_19));</span><br><span class="line">    OR4  XLXI_20 (<span class="variable">.I0</span>(XLXN_48),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_49),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_254),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_51),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_21));</span><br><span class="line">    OR4  XLXI_21 (<span class="variable">.I0</span>(XLXN_53),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_262),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_267),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_261),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_22));</span><br><span class="line">    INV  XLXI_23 (<span class="variable">.I</span>(point),</span><br><span class="line">    <span class="variable">.O</span>(p));</span><br><span class="line">    INV  XLXI_91 (<span class="variable">.I</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_274));</span><br><span class="line">    INV  XLXI_92 (<span class="variable">.I</span>(D2),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_277));</span><br><span class="line">    INV  XLXI_102 (<span class="variable">.I</span>(D1),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_278));</span><br><span class="line">    INV  XLXI_103 (<span class="variable">.I</span>(D0),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_279));</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line">    <span class="comment">//MyMC14495 end</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//MUX 4 TO 1 4bit begin</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> Mux4to1b4_DispNumber(I0,</span><br><span class="line">   I1,</span><br><span class="line">   I2,</span><br><span class="line">   I3,</span><br><span class="line">   S,</span><br><span class="line">   O);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] I0;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] I1;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] I2;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] I3;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] S;</span><br><span class="line">   <span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">3</span>:<span class="number">0</span>] O;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">always</span> @(*)<span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">case</span>(&#123;S[<span class="number">1</span>],S[<span class="number">0</span>]&#125;)</span><br><span class="line">            <span class="number">2'b00</span> : O = I0;</span><br><span class="line">            <span class="number">2'b01</span> : O = I1; </span><br><span class="line">            <span class="number">2'b10</span> : O = I2;</span><br><span class="line">            <span class="number">2'b11</span> : O = I3;</span><br><span class="line">           <span class="keyword">default</span>: O = I0;</span><br><span class="line">      <span class="keyword">endcase</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">   </span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"><span class="comment">//MUX 4 TO 1 4bit end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//MUX 4 TO 1 begin</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> Mux4to1(I0,</span><br><span class="line">   I1,</span><br><span class="line">   I2,</span><br><span class="line">   I3,</span><br><span class="line">   S,</span><br><span class="line">   O);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">input</span> I0;</span><br><span class="line">   <span class="keyword">input</span> I1;</span><br><span class="line">   <span class="keyword">input</span> I2;</span><br><span class="line">   <span class="keyword">input</span> I3;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] S;</span><br><span class="line">   <span class="keyword">output</span> <span class="keyword">reg</span> O;</span><br><span class="line">   <span class="keyword">always</span> @(*)<span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">case</span>(&#123;S[<span class="number">1</span>],S[<span class="number">0</span>]&#125;)</span><br><span class="line">            <span class="number">2'b00</span> : O &lt;= I0;</span><br><span class="line">            <span class="number">2'b01</span> : O &lt;= I1;</span><br><span class="line">            <span class="number">2'b10</span> : O &lt;= I2;</span><br><span class="line">            <span class="number">2'b11</span> : O &lt;= I3;</span><br><span class="line">            <span class="keyword">default</span>:O &lt;= I0;</span><br><span class="line">         <span class="keyword">endcase</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"><span class="comment">//MUX 4 TO 1 end</span></span><br><span class="line">            </span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> clkdiv_DispNumber(<span class="keyword">input</span> <span class="keyword">wire</span> clk,</span><br><span class="line">      <span class="keyword">input</span> <span class="keyword">wire</span> rst,</span><br><span class="line">      <span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] clkdiv</span><br><span class="line">      );</span><br><span class="line">      <span class="comment">//clock divider</span></span><br><span class="line">      <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">         <span class="keyword">if</span> (rst) clkdiv &lt;= <span class="number">0</span>;</span><br><span class="line">         <span class="keyword">else</span> clkdiv     &lt;= clkdiv + <span class="number">1'b1</span>;</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span>  100 ps / 10 ps</span></span><br><span class="line"><span class="keyword">module</span> INV4(O0, O1, O2, O3, I0, I1, I2, I3);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">output</span> O0;</span><br><span class="line"><span class="keyword">output</span> O1;</span><br><span class="line"><span class="keyword">output</span> O2;</span><br><span class="line"><span class="keyword">output</span> O3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">input</span>  I0;</span><br><span class="line"><span class="keyword">input</span>  I1;</span><br><span class="line"><span class="keyword">input</span>  I2;</span><br><span class="line"><span class="keyword">input</span>  I3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> O0 = !I0;</span><br><span class="line"><span class="keyword">assign</span> O1 = !I1;</span><br><span class="line"><span class="keyword">assign</span> O2 = !I2;</span><br><span class="line"><span class="keyword">assign</span> O3 = !I3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span>  100 ps / 10 ps</span></span><br><span class="line"><span class="keyword">module</span> D2_4E (D0, D1, D2, D3, A0, A1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">output</span> D0;</span><br><span class="line"><span class="keyword">output</span> D1;</span><br><span class="line"><span class="keyword">output</span> D2;</span><br><span class="line"><span class="keyword">output</span> D3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">input</span>  A0;</span><br><span class="line"><span class="keyword">input</span>  A1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">reg</span> D0;</span><br><span class="line"><span class="keyword">reg</span> D1;</span><br><span class="line"><span class="keyword">reg</span> D2;</span><br><span class="line"><span class="keyword">reg</span> D3;</span><br><span class="line"></span><br><span class="line"><span class="keyword">always</span> @(*)<span class="keyword">begin</span></span><br><span class="line"><span class="keyword">case</span>(&#123;A1,A0&#125;)</span><br><span class="line">   <span class="number">2'b00</span> : &#123;D3,D2,D1,D0&#125;  &lt;= <span class="number">4'b0001</span>;</span><br><span class="line">   <span class="number">2'b01</span> : &#123;D3,D2,D1,D0&#125;  &lt;= <span class="number">4'b0010</span>;</span><br><span class="line">   <span class="number">2'b10</span> : &#123;D3,D2,D1,D0&#125;  &lt;= <span class="number">4'b0100</span>;</span><br><span class="line">   <span class="number">2'b11</span> : &#123;D3,D2,D1,D0&#125;  &lt;= <span class="number">4'b1000</span>;</span><br><span class="line">   <span class="keyword">default</span>: &#123;D3,D2,D1,D0&#125; &lt;= <span class="number">4'b0000</span>;</span><br><span class="line"><span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> DisplaySync(Hexs,</span><br><span class="line">LES,</span><br><span class="line">point,</span><br><span class="line">Scan,</span><br><span class="line">AN,</span><br><span class="line">Hex,</span><br><span class="line">LE,</span><br><span class="line">p);</span><br><span class="line"></span><br><span class="line"><span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] Hexs;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] LES;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] point;</span><br><span class="line"><span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] Scan;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] AN;</span><br><span class="line"><span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] Hex;</span><br><span class="line"><span class="keyword">output</span> LE;</span><br><span class="line"><span class="keyword">output</span> p;</span><br><span class="line"></span><br><span class="line"><span class="keyword">wire</span> D0,D1,D2,D3;</span><br><span class="line"></span><br><span class="line">Mux4to1b4_DispNumber  Mux4to1b4_1 (<span class="variable">.I0</span>(Hexs[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.I1</span>(Hexs[<span class="number">7</span>:<span class="number">4</span>]),</span><br><span class="line"><span class="variable">.I2</span>(Hexs[<span class="number">11</span>:<span class="number">8</span>]),</span><br><span class="line"><span class="variable">.I3</span>(Hexs[<span class="number">15</span>:<span class="number">12</span>]),</span><br><span class="line"><span class="variable">.S</span>(Scan[<span class="number">1</span>:<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.O</span>(Hex[<span class="number">3</span>:<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">Mux4to1  Mux4to1_1 (<span class="variable">.I0</span>(point[<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.I1</span>(point[<span class="number">1</span>]),</span><br><span class="line"><span class="variable">.I2</span>(point[<span class="number">2</span>]),</span><br><span class="line"><span class="variable">.I3</span>(point[<span class="number">3</span>]),</span><br><span class="line"><span class="variable">.S</span>(Scan[<span class="number">1</span>:<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.O</span>(p));</span><br><span class="line"></span><br><span class="line">Mux4to1  Mux4to1_2 (<span class="variable">.I0</span>(LES[<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.I1</span>(LES[<span class="number">1</span>]),</span><br><span class="line"><span class="variable">.I2</span>(LES[<span class="number">2</span>]),</span><br><span class="line"><span class="variable">.I3</span>(LES[<span class="number">3</span>]),</span><br><span class="line"><span class="variable">.S</span>(Scan[<span class="number">1</span>:<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.O</span>(LE));</span><br><span class="line"></span><br><span class="line">D2_4E D2_4E_1 (<span class="variable">.A0</span>(Scan[<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.A1</span>(Scan[<span class="number">1</span>]),</span><br><span class="line"><span class="variable">.D0</span>(D0),</span><br><span class="line"><span class="variable">.D1</span>(D1),</span><br><span class="line"><span class="variable">.D2</span>(D2),</span><br><span class="line"><span class="variable">.D3</span>(D3));</span><br><span class="line"></span><br><span class="line">INV4  INV4_1 (<span class="variable">.I0</span>(D0),</span><br><span class="line"><span class="variable">.I1</span>(D1),</span><br><span class="line"><span class="variable">.I2</span>(D2),</span><br><span class="line"><span class="variable">.I3</span>(D3),</span><br><span class="line"><span class="variable">.O0</span>(AN[<span class="number">0</span>]),</span><br><span class="line"><span class="variable">.O1</span>(AN[<span class="number">1</span>]),</span><br><span class="line"><span class="variable">.O2</span>(AN[<span class="number">2</span>]),</span><br><span class="line"><span class="variable">.O3</span>(AN[<span class="number">3</span>]));</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> DispNumber(clk,</span><br><span class="line">   HEXS,</span><br><span class="line">   LES,</span><br><span class="line">   points,</span><br><span class="line">   RST,</span><br><span class="line">   AN,</span><br><span class="line">   Segment</span><br><span class="line">   );</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">input</span> clk;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] HEXS;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] LES;</span><br><span class="line">   <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] points;</span><br><span class="line">   <span class="keyword">input</span> RST;</span><br><span class="line">   <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] AN;</span><br><span class="line">   <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] Segment;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] clkdiv;</span><br><span class="line">   <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] Hex;</span><br><span class="line">   <span class="keyword">wire</span> LE;</span><br><span class="line">   <span class="keyword">wire</span> p;</span><br><span class="line">   </span><br><span class="line">   DisplaySync DSync_1 (<span class="variable">.Hexs</span>(HEXS[<span class="number">15</span>:<span class="number">0</span>]),</span><br><span class="line">   <span class="variable">.LES</span>(~LES[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line">   <span class="variable">.point</span>(points[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line">   <span class="variable">.Scan</span>(clkdiv[<span class="number">18</span>:<span class="number">17</span>]),</span><br><span class="line">   <span class="variable">.AN</span>(AN[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line">   <span class="variable">.Hex</span>(Hex[<span class="number">3</span>:<span class="number">0</span>]),</span><br><span class="line">   <span class="variable">.LE</span>(LE),</span><br><span class="line">   <span class="variable">.p</span>(p));</span><br><span class="line">   </span><br><span class="line">   MyMC14495  MyMC14495_1 (<span class="variable">.D0</span>(Hex[<span class="number">0</span>]),</span><br><span class="line">   <span class="variable">.D1</span>(Hex[<span class="number">1</span>]),</span><br><span class="line">   <span class="variable">.D2</span>(Hex[<span class="number">2</span>]),</span><br><span class="line">   <span class="variable">.D3</span>(Hex[<span class="number">3</span>]),</span><br><span class="line">   <span class="variable">.LE</span>(LE),</span><br><span class="line">   <span class="variable">.point</span>(p),</span><br><span class="line">   <span class="variable">.a</span>(Segment[<span class="number">0</span>]),</span><br><span class="line">   <span class="variable">.b</span>(Segment[<span class="number">1</span>]),</span><br><span class="line">   <span class="variable">.c</span>(Segment[<span class="number">2</span>]),</span><br><span class="line">   <span class="variable">.d</span>(Segment[<span class="number">3</span>]),</span><br><span class="line">   <span class="variable">.e</span>(Segment[<span class="number">4</span>]),</span><br><span class="line">   <span class="variable">.f</span>(Segment[<span class="number">5</span>]),</span><br><span class="line">   <span class="variable">.g</span>(Segment[<span class="number">6</span>]),</span><br><span class="line">   <span class="variable">.p</span>(Segment[<span class="number">7</span>]));</span><br><span class="line">   </span><br><span class="line">   clkdiv_DispNumber  clkdiv_1 (<span class="variable">.clk</span>(clk),</span><br><span class="line">   <span class="variable">.rst</span>(RST),</span><br><span class="line">   <span class="variable">.clkdiv</span>(clkdiv[<span class="number">31</span>:<span class="number">0</span>]));</span><br><span class="line">   </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="五、串行数码管驱动"><a href="#五、串行数码管驱动" class="headerlink" title="五、串行数码管驱动"></a>五、串行数码管驱动</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> SEG_DRV(</span><br><span class="line">               <span class="keyword">input</span> clk,</span><br><span class="line">               <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>]num,</span><br><span class="line">               <span class="keyword">input</span> ena,</span><br><span class="line">               <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>]point,</span><br><span class="line">               <span class="keyword">output</span> S_DT,</span><br><span class="line">               <span class="keyword">output</span> S_CLK,</span><br><span class="line">               <span class="keyword">output</span> S_CLR,</span><br><span class="line">               <span class="keyword">output</span> S_EN</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line"><span class="keyword">wire</span> [<span class="number">63</span>:<span class="number">0</span>]dto;</span><br><span class="line"></span><br><span class="line">MC14495 m1(<span class="variable">.D0</span>(num[<span class="number">0</span>]),<span class="variable">.D1</span>(num[<span class="number">1</span>]),<span class="variable">.D2</span>(num[<span class="number">2</span>]),<span class="variable">.D3</span>(num[<span class="number">3</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">0</span>]),<span class="variable">.a</span>(dto[<span class="number">0</span>]),<span class="variable">.b</span>(dto[<span class="number">1</span>]),<span class="variable">.c</span>(dto[<span class="number">2</span>]),<span class="variable">.d</span>(dto[<span class="number">3</span>]),<span class="variable">.e</span>(dto[<span class="number">4</span>]),<span class="variable">.f</span>(dto[<span class="number">5</span>]),<span class="variable">.g</span>(dto[<span class="number">6</span>]),<span class="variable">.p</span>(dto[<span class="number">7</span>]));</span><br><span class="line">MC14495 m2(<span class="variable">.D0</span>(num[<span class="number">4</span>]),<span class="variable">.D1</span>(num[<span class="number">5</span>]),<span class="variable">.D2</span>(num[<span class="number">6</span>]),<span class="variable">.D3</span>(num[<span class="number">7</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">1</span>]),<span class="variable">.a</span>(dto[<span class="number">8</span>]),<span class="variable">.b</span>(dto[<span class="number">9</span>]),<span class="variable">.c</span>(dto[<span class="number">10</span>]),<span class="variable">.d</span>(dto[<span class="number">11</span>]),<span class="variable">.e</span>(dto[<span class="number">12</span>]),<span class="variable">.f</span>(dto[<span class="number">13</span>]),<span class="variable">.g</span>(dto[<span class="number">14</span>]),<span class="variable">.p</span>(dto[<span class="number">15</span>]));</span><br><span class="line">MC14495 m3(<span class="variable">.D0</span>(num[<span class="number">8</span>]),<span class="variable">.D1</span>(num[<span class="number">9</span>]),<span class="variable">.D2</span>(num[<span class="number">10</span>]),<span class="variable">.D3</span>(num[<span class="number">11</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">2</span>]),<span class="variable">.a</span>(dto[<span class="number">16</span>]),<span class="variable">.b</span>(dto[<span class="number">17</span>]),<span class="variable">.c</span>(dto[<span class="number">18</span>]),<span class="variable">.d</span>(dto[<span class="number">19</span>]),<span class="variable">.e</span>(dto[<span class="number">20</span>]),<span class="variable">.f</span>(dto[<span class="number">21</span>]),<span class="variable">.g</span>(dto[<span class="number">22</span>]),<span class="variable">.p</span>(dto[<span class="number">23</span>]));</span><br><span class="line">MC14495 m4(<span class="variable">.D0</span>(num[<span class="number">12</span>]),<span class="variable">.D1</span>(num[<span class="number">13</span>]),<span class="variable">.D2</span>(num[<span class="number">14</span>]),<span class="variable">.D3</span>(num[<span class="number">15</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">3</span>]),<span class="variable">.a</span>(dto[<span class="number">24</span>]),<span class="variable">.b</span>(dto[<span class="number">25</span>]),<span class="variable">.c</span>(dto[<span class="number">26</span>]),<span class="variable">.d</span>(dto[<span class="number">27</span>]),<span class="variable">.e</span>(dto[<span class="number">28</span>]),<span class="variable">.f</span>(dto[<span class="number">29</span>]),<span class="variable">.g</span>(dto[<span class="number">30</span>]),<span class="variable">.p</span>(dto[<span class="number">31</span>]));</span><br><span class="line">MC14495 m5(<span class="variable">.D0</span>(num[<span class="number">16</span>]),<span class="variable">.D1</span>(num[<span class="number">17</span>]),<span class="variable">.D2</span>(num[<span class="number">18</span>]),<span class="variable">.D3</span>(num[<span class="number">19</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">4</span>]),<span class="variable">.a</span>(dto[<span class="number">32</span>]),<span class="variable">.b</span>(dto[<span class="number">33</span>]),<span class="variable">.c</span>(dto[<span class="number">34</span>]),<span class="variable">.d</span>(dto[<span class="number">35</span>]),<span class="variable">.e</span>(dto[<span class="number">36</span>]),<span class="variable">.f</span>(dto[<span class="number">37</span>]),<span class="variable">.g</span>(dto[<span class="number">38</span>]),<span class="variable">.p</span>(dto[<span class="number">39</span>]));</span><br><span class="line">MC14495 m6(<span class="variable">.D0</span>(num[<span class="number">20</span>]),<span class="variable">.D1</span>(num[<span class="number">21</span>]),<span class="variable">.D2</span>(num[<span class="number">22</span>]),<span class="variable">.D3</span>(num[<span class="number">23</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">5</span>]),<span class="variable">.a</span>(dto[<span class="number">40</span>]),<span class="variable">.b</span>(dto[<span class="number">41</span>]),<span class="variable">.c</span>(dto[<span class="number">42</span>]),<span class="variable">.d</span>(dto[<span class="number">43</span>]),<span class="variable">.e</span>(dto[<span class="number">44</span>]),<span class="variable">.f</span>(dto[<span class="number">45</span>]),<span class="variable">.g</span>(dto[<span class="number">46</span>]),<span class="variable">.p</span>(dto[<span class="number">47</span>]));</span><br><span class="line">MC14495 m7(<span class="variable">.D0</span>(num[<span class="number">24</span>]),<span class="variable">.D1</span>(num[<span class="number">25</span>]),<span class="variable">.D2</span>(num[<span class="number">26</span>]),<span class="variable">.D3</span>(num[<span class="number">27</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">6</span>]),<span class="variable">.a</span>(dto[<span class="number">48</span>]),<span class="variable">.b</span>(dto[<span class="number">49</span>]),<span class="variable">.c</span>(dto[<span class="number">50</span>]),<span class="variable">.d</span>(dto[<span class="number">51</span>]),<span class="variable">.e</span>(dto[<span class="number">52</span>]),<span class="variable">.f</span>(dto[<span class="number">53</span>]),<span class="variable">.g</span>(dto[<span class="number">54</span>]),<span class="variable">.p</span>(dto[<span class="number">55</span>]));</span><br><span class="line">MC14495 m8(<span class="variable">.D0</span>(num[<span class="number">28</span>]),<span class="variable">.D1</span>(num[<span class="number">29</span>]),<span class="variable">.D2</span>(num[<span class="number">30</span>]),<span class="variable">.D3</span>(num[<span class="number">31</span>]),<span class="variable">.LE</span>(~ena),<span class="variable">.point</span>(point[<span class="number">7</span>]),<span class="variable">.a</span>(dto[<span class="number">56</span>]),<span class="variable">.b</span>(dto[<span class="number">57</span>]),<span class="variable">.c</span>(dto[<span class="number">58</span>]),<span class="variable">.d</span>(dto[<span class="number">59</span>]),<span class="variable">.e</span>(dto[<span class="number">60</span>]),<span class="variable">.f</span>(dto[<span class="number">61</span>]),<span class="variable">.g</span>(dto[<span class="number">62</span>]),<span class="variable">.p</span>(dto[<span class="number">63</span>]));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SEG_P2S m9(<span class="variable">.clk</span>(clk),<span class="variable">.data_in</span>(dto),<span class="variable">.ena</span>(ena),<span class="variable">.S_DT</span>(S_DT),<span class="variable">.S_CLK</span>(S_CLK),<span class="variable">.S_CLR</span>(S_CLR),<span class="variable">.S_EN</span>(S_EN));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="六、并行转串行模块"><a href="#六、并行转串行模块" class="headerlink" title="六、并行转串行模块"></a>六、并行转串行模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> SEG_P2S(clk,</span><br><span class="line">               data_in,</span><br><span class="line">               ena,</span><br><span class="line">               S_DT,</span><br><span class="line">               S_CLK,</span><br><span class="line">               S_CLR,</span><br><span class="line">               S_EN);</span><br><span class="line">    <span class="keyword">parameter</span> WIDTH = <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">parameter</span> DELAY = <span class="number">12</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">input</span> clk;</span><br><span class="line">    <span class="keyword">input</span> ena;</span><br><span class="line">    <span class="keyword">input</span> [WIDTH-<span class="number">1</span>:<span class="number">0</span>] data_in;</span><br><span class="line">    <span class="keyword">output</span> S_DT;</span><br><span class="line">    <span class="keyword">output</span> S_CLK;</span><br><span class="line">    <span class="keyword">output</span> S_CLR;</span><br><span class="line">    <span class="keyword">output</span> S_EN;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">wire</span> s_clk,s_data;</span><br><span class="line">    <span class="keyword">reg</span> out_ena;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> S_CLK = s_clk;</span><br><span class="line">    <span class="keyword">assign</span> S_DT  = s_data;</span><br><span class="line">    <span class="keyword">assign</span> S_EN  = out_ena;</span><br><span class="line">    <span class="keyword">assign</span> S_CLR = <span class="number">1'b1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span> [WIDTH:<span class="number">0</span>] shift;</span><br><span class="line">    <span class="keyword">reg</span> [DELAY-<span class="number">1</span>:<span class="number">0</span>] counter = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">wire</span> s_clk_Ena;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> s_clk_Ena = |shift[WIDTH-<span class="number">1</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> s_clk     = ~clk &amp;&amp; s_clk_Ena;</span><br><span class="line">    <span class="keyword">assign</span> s_data    = shift[WIDTH];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">negedge</span> ena)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>(ena == <span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">            shift &lt;= <span class="number">0</span>;</span><br><span class="line">            counter &lt;= <span class="number">0</span>;</span><br><span class="line">            out_ena &lt;= <span class="number">1'b1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s_clk_Ena)</span><br><span class="line">            shift &lt;= &#123;shift[WIDTH - <span class="number">1</span>:<span class="number">0</span>], <span class="number">1'b0</span>&#125;;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (&amp;counter) <span class="keyword">begin</span></span><br><span class="line">                shift &lt;= &#123;data_in, <span class="number">1'b1</span>&#125;;</span><br><span class="line">                out_ena    &lt;= <span class="number">1'b0</span>;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                out_ena      &lt;= <span class="number">1'b1</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            </span><br><span class="line">            counter &lt;= counter + <span class="number">1'b1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="七、MC14495模块"><a href="#七、MC14495模块" class="headerlink" title="七、MC14495模块"></a>七、MC14495模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyMC14495 begin</span></span><br><span class="line"><span class="meta">`<span class="meta-keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span>   MC14495(D0,</span><br><span class="line">                 D1,</span><br><span class="line">                 D2,</span><br><span class="line">                 D3,</span><br><span class="line">                 LE,</span><br><span class="line">                 point,</span><br><span class="line">                 a,</span><br><span class="line">                 b,</span><br><span class="line">                 c,</span><br><span class="line">                 d,</span><br><span class="line">                 e,</span><br><span class="line">                 f,</span><br><span class="line">                 g,</span><br><span class="line">                 p);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">input</span> D0;</span><br><span class="line">    <span class="keyword">input</span> D1;</span><br><span class="line">    <span class="keyword">input</span> D2;</span><br><span class="line">    <span class="keyword">input</span> D3;</span><br><span class="line">    <span class="keyword">input</span> LE;</span><br><span class="line">    <span class="keyword">input</span> point;</span><br><span class="line">    <span class="keyword">output</span> a;</span><br><span class="line">    <span class="keyword">output</span> b;</span><br><span class="line">    <span class="keyword">output</span> c;</span><br><span class="line">    <span class="keyword">output</span> d;</span><br><span class="line">    <span class="keyword">output</span> e;</span><br><span class="line">    <span class="keyword">output</span> f;</span><br><span class="line">    <span class="keyword">output</span> g;</span><br><span class="line">    <span class="keyword">output</span> p;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">wire</span> XLXN_16;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_17;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_18;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_19;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_20;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_21;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_22;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_31;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_32;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_34;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_35;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_36;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_38;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_41;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_42;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_45;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_48;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_49;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_51;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_53;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_64;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_193;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_241;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_245;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_254;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_261;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_262;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_267;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_274;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_277;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_278;</span><br><span class="line">    <span class="keyword">wire</span> XLXN_279;</span><br><span class="line">    </span><br><span class="line">    AND4  AD0 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_31));</span><br><span class="line">    AND4  AD1 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_32));</span><br><span class="line">    AND3  AD2 (<span class="variable">.I0</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_64));</span><br><span class="line">    AND3  AD3 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_34));</span><br><span class="line">    AND3  AD4 (<span class="variable">.I0</span>(D1),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_35));</span><br><span class="line">    AND3  AD5 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_36));</span><br><span class="line">    AND3  AD6 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_38));</span><br><span class="line">    AND3  AD7 (<span class="variable">.I0</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I1</span>(D2),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_193));</span><br><span class="line">    AND2  AD8 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_245));</span><br><span class="line">    AND4  AD9 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_41));</span><br><span class="line">    AND3  AD10 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_42));</span><br><span class="line">    AND3  AD11 (<span class="variable">.I0</span>(D1),</span><br><span class="line">    <span class="variable">.I1</span>(D2),</span><br><span class="line">    <span class="variable">.I2</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_45));</span><br><span class="line">    AND4  AD12 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_241));</span><br><span class="line">    AND3  AD13 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_48));</span><br><span class="line">    AND3  AD14 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D2),</span><br><span class="line">    <span class="variable">.I2</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_49));</span><br><span class="line">    AND3  AD15 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_254));</span><br><span class="line">    AND4  AD16 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_51));</span><br><span class="line">    AND4  AD17 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(D1),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_53));</span><br><span class="line">    AND4  AD18 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_262));</span><br><span class="line">    AND4  AD19 (<span class="variable">.I0</span>(XLXN_279),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I2</span>(D2),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_267));</span><br><span class="line">    AND4  AD20 (<span class="variable">.I0</span>(D0),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_277),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_278),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_274),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_261));</span><br><span class="line">    OR2  XLXI_1 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_16),</span><br><span class="line">    <span class="variable">.O</span>(g));</span><br><span class="line">    OR2  XLXI_2 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_17),</span><br><span class="line">    <span class="variable">.O</span>(f));</span><br><span class="line">    OR2  XLXI_3 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_18),</span><br><span class="line">    <span class="variable">.O</span>(e));</span><br><span class="line">    OR2  XLXI_4 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_19),</span><br><span class="line">    <span class="variable">.O</span>(d));</span><br><span class="line">    OR2  XLXI_5 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_20),</span><br><span class="line">    <span class="variable">.O</span>(c));</span><br><span class="line">    OR2  XLXI_6 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_21),</span><br><span class="line">    <span class="variable">.O</span>(b));</span><br><span class="line">    OR2  XLXI_8 (<span class="variable">.I0</span>(LE),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_22),</span><br><span class="line">    <span class="variable">.O</span>(a));</span><br><span class="line">    OR3  XLXI_15 (<span class="variable">.I0</span>(XLXN_31),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_32),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_64),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_16));</span><br><span class="line">    OR3  XLXI_16 (<span class="variable">.I0</span>(XLXN_38),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_193),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_245),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_18));</span><br><span class="line">    OR3  XLXI_17 (<span class="variable">.I0</span>(XLXN_45),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_241),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_49),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_20));</span><br><span class="line">    OR4  XLXI_18 (<span class="variable">.I0</span>(XLXN_34),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_35),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_36),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_262),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_17));</span><br><span class="line">    OR4  XLXI_19 (<span class="variable">.I0</span>(XLXN_41),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_42),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_267),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_261),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_19));</span><br><span class="line">    OR4  XLXI_20 (<span class="variable">.I0</span>(XLXN_48),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_49),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_254),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_51),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_21));</span><br><span class="line">    OR4  XLXI_21 (<span class="variable">.I0</span>(XLXN_53),</span><br><span class="line">    <span class="variable">.I1</span>(XLXN_262),</span><br><span class="line">    <span class="variable">.I2</span>(XLXN_267),</span><br><span class="line">    <span class="variable">.I3</span>(XLXN_261),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_22));</span><br><span class="line">    INV  XLXI_23 (<span class="variable">.I</span>(point),</span><br><span class="line">    <span class="variable">.O</span>(p));</span><br><span class="line">    INV  XLXI_91 (<span class="variable">.I</span>(D3),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_274));</span><br><span class="line">    INV  XLXI_92 (<span class="variable">.I</span>(D2),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_277));</span><br><span class="line">    INV  XLXI_102 (<span class="variable">.I</span>(D1),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_278));</span><br><span class="line">    INV  XLXI_103 (<span class="variable">.I</span>(D0),</span><br><span class="line">    <span class="variable">.O</span>(XLXN_279));</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line">    <span class="comment">//MyMC14495 end</span></span><br></pre></td></tr></table></figure><h3 id="八、去抖动模块"><a href="#八、去抖动模块" class="headerlink" title="八、去抖动模块"></a>八、去抖动模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> pbdebounce(</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> clk_1ms,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> button,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span> pbreg</span><br><span class="line">        );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] pbshift;</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        pbshift = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk_1ms)<span class="keyword">begin</span></span><br><span class="line">    pbshift = pbshift &lt;&lt; <span class="number">1</span>;</span><br><span class="line">    pbshift[<span class="number">0</span>]=button;</span><br><span class="line">    <span class="keyword">if</span> (pbshift==<span class="number">8'b0</span>)</span><br><span class="line">    pbreg=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (pbshift==<span class="number">8'hff</span>)</span><br><span class="line">     pbreg=<span class="number">1</span>;</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="九、分频器模块"><a href="#九、分频器模块" class="headerlink" title="九、分频器模块"></a>九、分频器模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> clkdiv(<span class="keyword">input</span> <span class="keyword">wire</span> clk,</span><br><span class="line">    <span class="keyword">input</span> <span class="keyword">wire</span> rst,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] clkdiv</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">//clock divider</span></span><br><span class="line">      <span class="keyword">always</span> @ (<span class="keyword">posedge</span> clk <span class="keyword">or</span> <span class="keyword">posedge</span> rst) <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> (rst) clkdiv &lt;= <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">else</span> clkdiv &lt;= clkdiv + <span class="number">1'b1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="十、随机数模块"><a href="#十、随机数模块" class="headerlink" title="十、随机数模块"></a>十、随机数模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> Random(</span><br><span class="line">    <span class="keyword">input</span> clk,</span><br><span class="line">    <span class="keyword">output</span> <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>]random</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>]<span class="keyword">rand</span>;</span><br><span class="line">    <span class="keyword">assign</span> random =  <span class="keyword">rand</span>[<span class="number">3</span>:<span class="number">0</span>] % <span class="number">6</span> + <span class="number">1</span>; </span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">rand</span> &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span> </span><br><span class="line">        <span class="keyword">rand</span> &lt;= <span class="keyword">rand</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="十一、BCD模块"><a href="#十一、BCD模块" class="headerlink" title="十一、BCD模块"></a>十一、BCD模块</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> BCD_20(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">19</span>:<span class="number">0</span>]binary,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">19</span>:<span class="number">0</span>]bcd</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d1;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d2;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d3;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d4;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d5;    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> d1 = binary % <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">assign</span> d2 = (binary / <span class="number">10</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> d3 = (binary / <span class="number">100</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> d4 = (binary / <span class="number">1000</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> d5 = (binary / <span class="number">10000</span>) % <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> bcd = &#123; d5 , d4 , d3 , d2 , d1 &#125;;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> BCD_8(</span><br><span class="line">    <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>]binary,</span><br><span class="line">    <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>]bcd</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d1;    </span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] d2;    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assign</span> d1 = binary % <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">assign</span> d2 = binary / <span class="number">10</span>; </span><br><span class="line">    <span class="keyword">assign</span> bcd = &#123; d2 , d1 &#125;;</span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure><h3 id="十二、XDC引脚文件"><a href="#十二、XDC引脚文件" class="headerlink" title="十二、XDC引脚文件"></a>十二、XDC引脚文件</h3><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">set_property PACKAGE_PIN AC18 [get_ports clk]</span><br><span class="line">set_property IOSTANDARD LVCMOS18 [get_ports clk]</span><br><span class="line">    </span><br><span class="line">set_property PACKAGE_PIN AA10 [get_ports &#123;reset&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS15 [get_ports &#123;reset&#125;]</span><br><span class="line">set_property PACKAGE_PIN V18 [get_ports &#123;dice_in&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS18 [get_ports &#123;dice_in&#125;]</span><br><span class="line">set_property PACKAGE_PIN V19 [get_ports &#123;yes_in&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS18 [get_ports &#123;yes_in&#125;]</span><br><span class="line">set_property PACKAGE_PIN V14 [get_ports &#123;no_in&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS18 [get_ports &#123;no_in&#125;]</span><br><span class="line">set_property PACKAGE_PIN AF10 [get_ports &#123;sw_input&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS15 [get_ports &#123;sw_input&#125;]</span><br><span class="line">set_property PACKAGE_PIN W16 [get_ports keypad]</span><br><span class="line">set_property IOSTANDARD LVCMOS18 [get_ports keypad]</span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN N18 [get_ports ps2_data]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports ps2_data]</span><br><span class="line">set_property PULLUP true [get_ports ps2_data]</span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN M19 [get_ports ps2_clk]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports ps2_clk]</span><br><span class="line">set_property PULLUP true [get_ports ps2_clk]</span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN T20 [get_ports &#123;b[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;b[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;b[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN R20 [get_ports &#123;b[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;b[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;b[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN T22 [get_ports &#123;b[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;b[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;b[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN T23 [get_ports &#123;b[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;b[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;b[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN R22 [get_ports &#123;g[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;g[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;g[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN R23 [get_ports &#123;g[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;g[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;g[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN T24 [get_ports &#123;g[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;g[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;g[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN T25 [get_ports &#123;g[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;g[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;g[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN N21 [get_ports &#123;r[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;r[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;r[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN N22 [get_ports &#123;r[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;r[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;r[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN R21 [get_ports &#123;r[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;r[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;r[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN P21 [get_ports &#123;r[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;r[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property SLEW FAST [get_ports &#123;r[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN M22 [get_ports hs]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports hs]</span><br><span class="line">set_property SLEW FAST [get_ports hs]</span><br><span class="line">set_property PACKAGE_PIN M21 [get_ports vs]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports vs]</span><br><span class="line">set_property SLEW FAST [get_ports vs]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN AB22 [get_ports &#123;ArduinoSegment[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AD24 [get_ports &#123;ArduinoSegment[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AD23 [get_ports &#123;ArduinoSegment[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN Y21 [get_ports &#123;ArduinoSegment[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN W20 [get_ports &#123;ArduinoSegment[<span class="number">4</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">4</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AC24 [get_ports &#123;ArduinoSegment[<span class="number">5</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">5</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AC23 [get_ports &#123;ArduinoSegment[<span class="number">6</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">6</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AA22 [get_ports &#123;ArduinoSegment[<span class="number">7</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoSegment[<span class="number">7</span>]&#125;]</span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN AD21 [get_ports &#123;ArduinoAN[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoAN[<span class="number">0</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AC21 [get_ports &#123;ArduinoAN[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoAN[<span class="number">1</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AB21 [get_ports &#123;ArduinoAN[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoAN[<span class="number">2</span>]&#125;]</span><br><span class="line">set_property PACKAGE_PIN AC22 [get_ports &#123;ArduinoAN[<span class="number">3</span>]&#125;]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports &#123;ArduinoAN[<span class="number">3</span>]&#125;]</span><br><span class="line"></span><br><span class="line">set_property PACKAGE_PIN M24 [get_ports S_CLK]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports S_CLK]</span><br><span class="line">set_property PACKAGE_PIN M20 [get_ports S_CLR]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports S_CLR]</span><br><span class="line">set_property PACKAGE_PIN L24 [get_ports S_DT]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports S_DT]</span><br><span class="line">set_property PACKAGE_PIN R18 [get_ports S_EN]</span><br><span class="line">set_property IOSTANDARD LVCMOS33 [get_ports S_EN]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Verilog </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Verilog </tag>
            
            <tag> 数字逻辑 </tag>
            
            <tag> FPGA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MIPS-32汇编学习</title>
      <link href="/article/81c0826.html"/>
      <url>/article/81c0826.html</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>MIPS是一种很流行的Risc处理器，但现在已经是2020年了，我还是觉得学习MIPS-32汇编是一种浪费时间的行为，我更想多拿时间去学一学IA32、IA64。但是ZJU机组就是教的这种汇编，所以我也没办法。本文的主要内容均取自《Computer Organization and Design: the Hardware/Software Interface Third Edition》，话说这书都出到第5版了，ZJU还在用第3版，无力吐槽。</p><h1 id="MIPS-32指令格式"><a href="#MIPS-32指令格式" class="headerlink" title="MIPS-32指令格式"></a>MIPS-32指令格式</h1><p>MIPS-32的指令长度都是32位，分为三种格式：</p><p><strong>R型（算数指令）</strong></p><table><thead><tr><th>op</th><th>rs</th><th>rt</th><th>rd</th><th>shamt</th><th>funct</th></tr></thead><tbody><tr><td>6</td><td>5</td><td>5</td><td>5</td><td>5</td><td>6</td></tr><tr><td>操作码</td><td>第一个操作数</td><td>第二个操作数</td><td>目的寄存器</td><td>偏移量</td><td>函数</td></tr></tbody></table><p><strong>I型（立即数、分支、传输指令）</strong></p><table><thead><tr><th>op</th><th>rs</th><th>rt</th><th>constant or address</th></tr></thead><tbody><tr><td>6</td><td>5</td><td>5</td><td>16</td></tr><tr><td>操作码</td><td>操作数</td><td>目的寄存器</td><td>立即数（常数）或地址</td></tr></tbody></table><p><strong>J型（跳转指令）</strong></p><table><thead><tr><th>op</th><th>address</th></tr></thead><tbody><tr><td>6</td><td>26</td></tr><tr><td>操作码</td><td>指令地址</td></tr></tbody></table><p>指令格式由第一个字段op的值来区分。</p><h1 id="MIPS-32寄存器"><a href="#MIPS-32寄存器" class="headerlink" title="MIPS-32寄存器"></a>MIPS-32寄存器</h1><p>MIPS-32一共有32个寄存器，下面是MIPS-32的寄存器规范：</p><table><thead><tr><th>名称</th><th>寄存器号</th><th>用途</th></tr></thead><tbody><tr><td>$zero</td><td>0</td><td>常数0</td></tr><tr><td>$at</td><td>1</td><td>编译器保留，实现伪指令</td></tr><tr><td>$v0~$v1</td><td>2 ~ 3</td><td>结果值和表达式求值</td></tr><tr><td>$a0~$a3</td><td>4 ~ 7</td><td>参数</td></tr><tr><td>$t0~$t7</td><td>8 ~ 15</td><td>临时变量</td></tr><tr><td>$s0~$s7</td><td>16 ~ 23</td><td>需要保存的</td></tr><tr><td>$t8~$t9</td><td>24 ~ 25</td><td>也是临时变量</td></tr><tr><td>$k0~$k1</td><td>26 ~ 27</td><td>异常处理</td></tr><tr><td>$gp</td><td>28</td><td>全局指针</td></tr><tr><td>$sp</td><td>29</td><td>栈指针</td></tr><tr><td>$fp</td><td>30</td><td>帧指针</td></tr><tr><td>$ra</td><td>31</td><td>返回地址</td></tr></tbody></table><h1 id="MIPS-32汇编语言"><a href="#MIPS-32汇编语言" class="headerlink" title="MIPS-32汇编语言"></a>MIPS-32汇编语言</h1><p>在本书第二章中，一共介绍了24条指令，下面是这些指令的含义：</p><table><thead><tr><th>类别</th><th>格式</th><th>指令</th><th>示例</th><th>语义</th></tr></thead><tbody><tr><td><strong>算数运算</strong></td><td>R</td><td>加</td><td>add $s1, $s2, $s3</td><td>$s1 = $s2+ $s3</td></tr><tr><td><strong>算数运算</strong></td><td>R</td><td>减</td><td>sub $s1, $s2, $s3</td><td>$s1 = $s2 - $s3</td></tr><tr><td><strong>算数运算</strong></td><td>I</td><td>立即数加</td><td>addi $s1, $s2, 100</td><td>$s1 = $s2 + 100</td></tr><tr><td><strong>数据传输</strong></td><td>I</td><td>取字</td><td>lw $s1, 100( $s2)</td><td>$s1 = Memory[$s2 + 100]</td></tr><tr><td><strong>数据传输</strong></td><td>I</td><td>存字</td><td>sw $s1, 100( $s2)</td><td>Memory[$s2 + 100] = $s1</td></tr><tr><td><strong>数据传输</strong></td><td>I</td><td>取半字</td><td>lh $s1, 100( $s2)</td><td>$s1 = Memory[$s2 + 100]</td></tr><tr><td><strong>数据传输</strong></td><td>I</td><td>存半字</td><td>sh $s1, 100( $s2)</td><td>Memory[$s2 + 100] = $s1</td></tr><tr><td><strong>数据传输</strong></td><td>I</td><td>取字节</td><td>lb $s1, 100( $s2)</td><td>$s1 = Memory[$s2 + 100]</td></tr><tr><td><strong>数据传输</strong></td><td>I</td><td>存字节</td><td>sb $s1, 100( $s2)</td><td>Memory[$s2 + 100] = $s1</td></tr><tr><td><strong>数据传输</strong></td><td>I</td><td>立即数高位取</td><td>lui $s1, 100</td><td>$s1 = 100 * 2^16</td></tr><tr><td><strong>逻辑指令</strong></td><td>R</td><td>与</td><td>and $s1, $s2, $s3</td><td>$s1 = $s2 &amp; $s3</td></tr><tr><td><strong>逻辑指令</strong></td><td>R</td><td>或</td><td>or $s1, $s2, $s3</td><td>$s1 = $s2 | $s3</td></tr><tr><td><strong>逻辑指令</strong></td><td>R</td><td>或非</td><td>nor $s1, $s2, $s3</td><td>$s1 = ~($s2 | $s3)</td></tr><tr><td><strong>逻辑指令</strong></td><td>I</td><td>立即数与</td><td>andi $s1, $s2, 100</td><td>$s1 = $s2 &amp; 100</td></tr><tr><td><strong>逻辑指令</strong></td><td>I</td><td>立即数或</td><td>ori $s1, $s2, 100</td><td>$s1 = $s2 | 100</td></tr><tr><td><strong>逻辑指令</strong></td><td>R</td><td>逻辑左移</td><td>sll $s1, $s2, 10</td><td>$s1 = $s2 &lt;&lt; 10</td></tr><tr><td><strong>逻辑指令</strong></td><td>R</td><td>逻辑右移</td><td>srl $s1, $s2, 10</td><td>$s1 = $s2 &gt;&gt; 10</td></tr><tr><td><strong>条件分支</strong></td><td>I</td><td>相等转移</td><td>beq $s1, $s2, 25</td><td>如果相等，go to 25</td></tr><tr><td><strong>条件分支</strong></td><td>I</td><td>不等转移</td><td>bne $s1, $s2, 25</td><td>如果不等， go to 25</td></tr><tr><td><strong>条件分支</strong></td><td>R</td><td>小于置位</td><td>slt $s1, $s2, $s3</td><td>小于 把 $s1置1 不然把 $s1置0</td></tr><tr><td><strong>条件分支</strong></td><td>I</td><td>立即数小于置位</td><td>slti $s1, $s2, 100</td><td>小于 把 $s1置1 不然把 $s1置0</td></tr><tr><td><strong>无条件跳转</strong></td><td>J</td><td>跳转</td><td>j 2500</td><td>go to 10000</td></tr><tr><td><strong>无条件跳转</strong></td><td>R</td><td>跳转寄存器</td><td>jr $ra</td><td>go to $ra</td></tr><tr><td><strong>无条件跳转</strong></td><td>J</td><td>跳转并连接</td><td>jal 2500</td><td>$ra = PC + 4; go to 10000</td></tr></tbody></table><h1 id="MIPS-32伪指令"><a href="#MIPS-32伪指令" class="headerlink" title="MIPS-32伪指令"></a>MIPS-32伪指令</h1><p>MIPS编译器除了MIPS支持MIPS体系结构下的指令外，还支持一些伪指令，下面是目前我学到的：</p><table><thead><tr><th>伪指令</th><th>名称</th><th>格式</th></tr></thead><tbody><tr><td>传送</td><td>move</td><td>R</td></tr><tr><td>乘</td><td>mult</td><td>R</td></tr><tr><td>立即数乘</td><td>multi</td><td>I</td></tr><tr><td>立即数取</td><td>li</td><td>I</td></tr><tr><td>小于转移</td><td>blt</td><td>I</td></tr><tr><td>小于等于转移</td><td>ble</td><td>I</td></tr><tr><td>大于转移</td><td>bgt</td><td>I</td></tr><tr><td>大于等于转移</td><td>bge</td><td>I</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 汇编 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MIPS </tag>
            
            <tag> 汇编 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arch Kde 安装Deepin-QQ</title>
      <link href="/article/e1a9c211.html"/>
      <url>/article/e1a9c211.html</url>
      
        <content type="html"><![CDATA[<h1 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h1><p>Arch是真的好用！用了这么多Linux发行版，Arch是最能满足需求的，强烈推荐各位体验！不过话说在前面，Arch的坑也是真的很多，要踩好久才能适应。</p><h1 id="KDE下的QQ问题"><a href="#KDE下的QQ问题" class="headerlink" title="KDE下的QQ问题"></a>KDE下的QQ问题</h1><p>QQ是一个很重要的应用，但是无奈腾讯官方的Linux-QQ体验真的是太差了，不过好在有Wine这一神器，以及deepin公司的大力支持，我们可以在Arch上正常使用QQ。安装deepin-QQ：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -S deepin.com.qq.im</span><br></pre></td></tr></table></figure><p>如果你是GNOME，这时候应该已经可以运行QQ了，但是由于我的桌面系统是KDE，不是GNOME，所以对Deepinqq的支持不好，无法正常打开。</p><p>网络上的解决方案多数是装一个gnome-settings-daemon，然后设置他开机运行，但是这样的话，就会使得其他的软件缩放失效（也可能是我的主题原因），我搜索了很长时间，最后自己发现了一种解决方案：使用xsettingsd代替gnome-settings-daemon。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -S xsettingsd</span><br></pre></td></tr></table></figure><p>xsettingsd有自己的github，里面有他的详细设置，他是一个轻量化的工具，Archwiki上也有一些信息，具体可以自己查查。只要不修改xsettingsd的DPI就不会影响其他的程序的缩放。</p><p>安装好他后，可以考虑把他设置为开机启动，或者右键deepinqq的快捷方式，找到deepinqq的运行脚本“run.sh”</p><p>在脚本开始加上：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsettingsd    (或者xsettingsd&amp;)</span><br></pre></td></tr></table></figure><p>就可以正常运行QQ了，但是QQ的缩放还不是正常的，我们需要手动运行一下xsettingsd，在终端输入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xsettingsd</span><br></pre></td></tr></table></figure><p>然后Ctrl+Alt+T开一个新的终端，输入：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">env WINEPREFIX=<span class="string">"<span class="variable">$HOME</span>/.deepinwine/Deepin-QQ"</span> /usr/bin/deepin-wine winecfg</span><br></pre></td></tr></table></figure><p>就打开了winecfg</p><p>调节graphics下的Dpi数值 96对应100% 144对应150% 192对应200%</p><p>按照自己的需求调整就可以了。</p><p>至此，你就可以在Arch上快乐享受QQ了！</p>]]></content>
      
      
      <categories>
          
          <category> Arch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arch </tag>
            
            <tag> Deepin-QQ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
